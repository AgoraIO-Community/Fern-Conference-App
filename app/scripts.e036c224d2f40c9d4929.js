!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("AgoraRTC",[],t):"object"==typeof exports?exports.AgoraRTC=t():e.AgoraRTC=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=18)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(19),o=n(8),a=n(2),s=n(4),d=0,u="free",c=[],l=!1;setInterval(function(){l&&f.info("console log upload")},9e5);var f=function(){var e,t,n,f,p,h=["DEBUG","INFO","WARNING","ERROR","NONE"],g=0;return e=function(){var e=arguments[0],t=arguments;if(t[0]=(0,r.getTimestamp)()+" Agora-SDK ["+(h[e]||"DEFAULT")+"]:",function(e,t){if(l)try{t=Array.prototype.slice.call(t);var n="";t.forEach(function(e){"object"===(void 0===e?"undefined":i(e))&&(e=JSON.stringify(e)),n=n+e+" "});var r={payload:n,log_level:e};"uploading"===u?c.push(r):function e(t){u="uploading",function(e,t,n){try{(0,o.post)(a.LOG_UPLOAD_SERVER,{sdk_version:a.VERSION,process_id:(0,s.getProcessId)(),log_item_id:d++,log_level:e.log_level,payload_str:e.payload},function(e){"OK"===e?t&&t():n&&n()},function(e){n&&n()},{withCredentials:!0})}catch(e){n&&n()}}(t,function(){0!==c.length?e(c.shift()):u="free"},function(){0!==c.length?e(c.shift()):u="free"})}(r)}catch(e){}}(e,t),!(e<g))switch(e){case 0:case 1:console.log.apply(console,t);break;case 2:console.warn.apply(console,t);break;case 3:console.error.apply(console,t);break;default:return void console.log.apply(console,t)}},t=function(){for(var t=[0],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},n=function(){for(var t=[1],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},f=function(){for(var t=[2],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},p=function(){for(var t=[3],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,enableLogUpload:function(){l=!0},disableLogUpload:function(){l=!1},setLogLevel:function(e){e>4?e=4:e<0&&(e=0),g=e},log:e,debug:t,info:n,warning:f,error:p}}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){var t={};return t.type=e.type,t};t.EventDispatcher=function(){var e={dispatcher:{}};return e.dispatcher.eventListeners={},e.addEventListener=function(t,n){void 0===e.dispatcher.eventListeners[t]&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},e.hasListeners=function(t){return!(!e.dispatcher.eventListeners[t]||!e.dispatcher.eventListeners[t].length)},e.on=e.addEventListener,e.removeEventListener=function(t,n){var i;-1!==(i=e.dispatcher.eventListeners[t].indexOf(n))&&e.dispatcher.eventListeners[t].splice(i,1)},e.dispatchEvent=function(t){var n;for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&"function"==typeof e.dispatcher.eventListeners[t.type][n]&&e.dispatcher.eventListeners[t.type][n](t)},e.dispatchSocketEvent=function(t){var n;for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&"function"==typeof e.dispatcher.eventListeners[t.type][n]&&e.dispatcher.eventListeners[t.type][n](t.msg)},e},t.StreamEvent=function(e){var t=i(e);return t.stream=e.stream,t.reason=e.reason,t.msg=e.msg,t},t.ClientEvent=function(e){var t=i(e);return t.uid=e.uid,t.attr=e.attr,t.stream=e.stream,t},t.MediaEvent=function(e){var t=i(e);return t.msg=e.msg,t},t.LiveStreamingEvent=function(e){var t=i(e);return t.url=e.url,t.reason=e.reason,t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BUILD="v2.5.0-beta-0-gb3ebe40",t.VERSION="2.5.0",t.WEBCS_DOMAIN=["ap-web-1.agora.io","ap-web-2.agoraio.cn"],t.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-3.agora.io","ap-web-4.agoraio.cn"],t.EVENT_REPORT_DOMAIN="webcollector-1.agora.io",t.EVENT_REPORT_BACKUP_DOMAIN="webcollector-2.agora.io",t.WEBCS_BACKUP_CONNECT_TIMEOUT=6e3,t.HTTP_CONNECT_TIMEOUT=5e3,t.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90],"120p_1":[160,120],"120p_3":[120,120],"120p_4":[212,120],"180p_1":[320,180],"180p_3":[180,180],"180p_4":[240,180],"240p_1":[320,240],"240p_3":[240,240],"240p_4":[424,240],"360p_1":[640,360],"360p_3":[360,360],"360p_4":[640,360],"360p_6":[360,360],"360p_7":[480,360],"360p_8":[480,360],"360p_9":[640,360],"360p_10":[640,360],"360p_11":[640,360],"480p_1":[640,480],"480p_2":[640,480],"480p_3":[480,480],"480p_4":[640,480],"480p_6":[480,480],"480p_8":[848,480],"480p_9":[848,480],"480p_10":[640,480],"720p_1":[1280,720],"720p_2":[1280,720],"720p_3":[1280,720],"720p_5":[960,720],"720p_6":[960,720],"1080p_1":[1920,1080],"1080p_2":[1920,1080],"1080p_3":[1920,1080],"1080p_5":[1920,1080],"1440p_1":[2560,1440],"1440p_2":[2560,1440],"4k_1":[3840,2160],"4k_3":[3840,2160]},t.LOG_UPLOAD_SERVER="https://logservice.agora.io/upload"},function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var r,o=(i(r={FAILED:"FAILED",INVALID_KEY:"INVALID_KEY",INVALID_CLIENT_MODE:"INVALID_CLIENT_MODE",INVALID_CLIENT_CODEC:"INVALID_CLIENT_CODEC",CLIENT_MODE_CODEC_MISMATCH:"CLIENT_MODE_CODEC_MISMATCH",WEB_API_NOT_SUPPORTED:"WEB_API_NOT_SUPPORTED",INVALID_PARAMETER:"INVALID_PARAMETER",INVALID_OPERATION:"INVALID_OPERATION"},"INVALID_PARAMETER","INVALID_PARAMETER"),i(r,"INVALID_LOCAL_STREAM","INVALID_LOCAL_STREAM"),i(r,"INVALID_REMOTE_STREAM","INVALID_REMOTE_STREAM"),i(r,"INVALID_DYNAMIC_KEY","INVALID_DYNAMIC_KEY"),i(r,"DYNAMIC_KEY_TIMEOUT","DYNAMIC_KEY_TIMEOUT"),i(r,"NO_VOCS_AVAILABLE","NO_VOCS_AVAILABLE"),i(r,"NO_VOS_AVAILABLE","ERR_NO_VOS_AVAILABLE"),i(r,"JOIN_CHANNEL_TIMEOUT","ERR_JOIN_CHANNEL_TIMEOUT"),i(r,"NO_AVAILABLE_CHANNEL","NO_AVAILABLE_CHANNEL"),i(r,"LOOKUP_CHANNEL_TIMEOUT","LOOKUP_CHANNEL_TIMEOUT"),i(r,"LOOKUP_CHANNEL_REJECTED","LOOKUP_CHANNEL_REJECTED"),i(r,"OPEN_CHANNEL_TIMEOUT","OPEN_CHANNEL_TIMEOUT"),i(r,"OPEN_CHANNEL_REJECTED","OPEN_CHANNEL_REJECTED"),i(r,"REQUEST_DEFERRED","REQUEST_DEFERRED"),i(r,"STREAM_ALREADY_PUBLISHED","STREAM_ALREADY_PUBLISHED"),i(r,"STREAM_NOT_YET_PUBLISHED","STREAM_NOT_YET_PUBLISHED"),i(r,"JOIN_TOO_FREQUENT","JOIN_TOO_FREQUENT"),i(r,"SOCKET_ERROR","SOCKET_ERROR"),i(r,"SOCKET_DISCONNECTED","SOCKET_DISCONNECTED"),i(r,"PEERCONNECTION_FAILED","PEERCONNECTION_FAILED"),i(r,"CONNECT_GATEWAY_ERROR","CONNECT_GATEWAY_ERROR"),i(r,"SERVICE_NOT_AVAILABLE","SERVICE_NOT_AVAILABLE"),i(r,"JOIN_CHANNEL_FAILED","JOIN_CHANNEL_FAILED"),i(r,"PUBLISH_STREAM_FAILED","PUBLISH_STREAM_FAILED"),i(r,"UNPUBLISH_STREAM_FAILED","UNPUBLISH_STREAM_FAILED"),i(r,"SUBSCRIBE_STREAM_FAILED","SUBSCRIBE_STREAM_FAILED"),i(r,"UNSUBSCRIBE_STREAM_FAILED","UNSUBSCRIBE_STREAM_FAILED"),i(r,"NO_SUCH_REMOTE_STREAM","NO_SUCH_REMOTE_STREAM"),i(r,"ERR_FAILED","1"),i(r,"ERR_INVALID_VENDOR_KEY","101"),i(r,"ERR_INVALID_CHANNEL_NAME","102"),i(r,"WARN_NO_AVAILABLE_CHANNEL","103"),i(r,"WARN_LOOKUP_CHANNEL_TIMEOUT","104"),i(r,"WARN_LOOKUP_CHANNEL_REJECTED","105"),i(r,"WARN_OPEN_CHANNEL_TIMEOUT","106"),i(r,"WARN_OPEN_CHANNEL_REJECTED","107"),i(r,"WARN_REQUEST_DEFERRED","108"),i(r,"ERR_DYNAMIC_KEY_TIMEOUT","109"),i(r,"ERR_INVALID_DYNAMIC_KEY","110"),i(r,"ERR_NO_VOCS_AVAILABLE","2000"),i(r,"ERR_NO_VOS_AVAILABLE","2001"),i(r,"ERR_JOIN_CHANNEL_TIMEOUT","2002"),i(r,"IOS_NOT_SUPPORT","IOS_NOT_SUPPORT"),i(r,"WECHAT_NOT_SUPPORT","WECHAT_NOT_SUPPORT"),i(r,"SHARING_SCREEN_NOT_SUPPORT","SHARING_SCREEN_NOT_SUPPORT"),i(r,"STILL_ON_PUBLISHING","STILL_ON_PUBLISHING"),i(r,"LOW_STREAM_ALREADY_PUBLISHED","LOW_STREAM_ALREADY_PUBLISHED"),i(r,"LOW_STREAM_NOT_YET_PUBLISHED","LOW_STREAM_ALREADY_PUBLISHED"),i(r,"HIGH_STREAM_NOT_VIDEO_TRACE","HIGH_STREAM_NOT_VIDEO_TRACE"),i(r,"NOT_FIND_DEVICE_BY_LABEL","NOT_FIND_DEVICE_BY_LABEL"),i(r,"ENABLE_DUALSTREAM_FAILED","ENABLE_DUALSTREAM_FAILED"),i(r,"DISABLE_DUALSTREAM_FAILED","DISABLE_DUALSTREAM_FAILED"),i(r,"PLAYER_NOT_FOUND","PLAYER_NOT_FOUND"),i(r,"ELECTRON_NOT_SUPPORT_SHARING_SCREEN","ELECTRON_NOT_SUPPORT_SHARING_SCREEN"),i(r,"BAD_ENVIRONMENT","BAD_ENVIRONMENT"),r);t.default=o,t.APErrorCode={101100:"NO_FLAG_SET",101101:"FLAG_SET_BUT_EMPTY",101102:"INVALID_FALG_SET",101203:"NO_SERVICE_AVIABLE",0:"OK_CODE",5:"INVALID_VENDOR_KEY",7:"INVALID_CHANNEL_NAME",8:"INTERNAL_ERROR",9:"NO_AUTHORIZED",10:"DYNAMIC_KEY_TIMEOUT",11:"NO_ACTIVE_STATUS",13:"DYNAMIC_KEY_EXPIRED",14:"STATIC_USE_DYANMIC_KEY",15:"DYNAMIC_USE_STATIC_KEY"},t.GatewayErrorCode={2000:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT",2003:"WARN_REPEAT_JOIN",2004:"ERR_JOIN_BY_MULTI_IP",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED"},t.JOIN_GS_TRYNEXT_LIST=["ERR_NO_VOCS_AVAILABLE","ERR_NO_VOS_AVAILABLE","ERR_JOIN_CHANNEL_TIMEOUT","WARN_LOOKUP_CHANNEL_TIMEOUT","WARN_OPEN_CHANNEL_TIMEOUT","ERR_VOM_SERVICE_UNAVAILABLE","ERR_TOO_MANY_USERS","ERR_MASTER_VOCS_UNAVAILABLE","ERR_INTERNAL_ERROR"],t.JOIN_CS_RETRY_LIST=["NO_SERVICE_AVIABLE"]},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getProcessId=t.SUBSCRIBE=t.PUBLISH=t.JOIN_GATEWAY=t.JOIN_CHOOSE_SERVER=t.SESSION_INIT=t.report=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(2)),o=i(n(0)),a=n(8),s=i(n(11)),d={type:null,sid:null,lts:null,succ:null,cname:null,uid:null,peerid:null,cid:null,elaps:null,extend:null,vid:0},u=null,c=function(){return u||(u="process-"+(0,s.default)(),o.default.info("processId: "+u)),u},l=function(){var e={list:{}};return e.url=(0,a.shouldUseHttps)()?"https://"+r.EVENT_REPORT_DOMAIN+":6443/events/report":"http://"+r.EVENT_REPORT_DOMAIN+":6080/events/report",e.urlBackup=(0,a.shouldUseHttps)()?"https://"+r.EVENT_REPORT_BACKUP_DOMAIN+":6443/events/report":"http://"+r.EVENT_REPORT_BACKUP_DOMAIN+":6080/events/report",e.setProxyServer=function(t){t&&(e.url=(0,a.shouldUseHttps)()?"https://"+t+"/rs/?h="+r.EVENT_REPORT_DOMAIN+"&p=6443&d=events/report":"http://"+t+"/rs/?h="+r.EVENT_REPORT_DOMAIN+"&p=6080&d=events/report",e.urlBackup=(0,a.shouldUseHttps)()?"https://"+t+"/rs/?h="+r.EVENT_REPORT_BACKUP_DOMAIN+"&p=6443&d=events/report":"http://"+t+"/rs/?h="+r.EVENT_REPORT_BACKUP_DOMAIN+"&p=6080&d=events/report",o.default.debug("reportProxyServerURL: "+e.url),o.default.debug("reportProxyServerBackupURL: "+e.urlBackup))},e.sessionInit=function(t,n){n.sid=t;var i=Object.assign({},d),o=Object.assign(i,n);e.list[t]||(o.startTime=+new Date);var a=Object.assign({},o);delete o.appid,delete o.mode,e.list[t]=o,a.extend=null,a.ver=r.VERSION,a.build=r.BUILD,a.type="session_init",a.browser=navigator.userAgent,a.lts=+new Date,a.elaps=a.lts-a.startTime,a.process=c(),e.send(a)},e.joinChooseServer=function(t,n,i){var r;(r=i?Object.assign(e.list[t],n):Object.assign({},e.list[t],n)).type="join_choose_server";var o=+new Date;r.ev_elaps=o-r.lts,r.elaps=o-r.startTime,r.lts=o,r.serverList=JSON.stringify(r.serverList),e.send(r)},e.joinGateway=function(t,n){var i=Object.assign(e.list[t],n);i.type="join_gateway";var r=+new Date;i.ev_elaps=r-i.lts,i.elaps=r-i.startTime,i.lts=r,e.send(i)},e.publish=function(t,n){var i=Object.assign({},e.list[t],n);i.type="publish";var r=+new Date;i.ev_elaps=r-i.lts,i.elaps=r-i.startTime,i.lts=r,e.send(i)},e.subscribe=function(t,n){var i=Object.assign({},e.list[t],n);i.type="subscribe";var r=+new Date;i.ev_elaps=r-i.lts,i.elaps=r-i.startTime,i.lts=r,e.send(i)},e.firstRemoteFrame=function(t,n){var i=Object.assign({},e.list[t],n);i.type="first_remote_frame",i.lts=+new Date,i.elaps=i.lts-i.startTime,e.send(i)},e.streamSwitch=function(t,n){var i=Object.assign({},e.list[t],n);i.type="stream_switch",i.isdual=n.isdual,i.lts=+new Date,i.elaps=i.lts-i.startTime,e.send(i)},e.audioSendingStopped=function(t,n){var i=Object.assign({},e.list[t],n);i.type="audio_sending_stopped",i.lts=+new Date,i.elaps=i.lts-i.startTime,e.send(i)},e.videoSendingStopped=function(t,n){var i=Object.assign({},e.list[t],n);i.type="video_sending_stopped",i.lts=+new Date,i.elaps=i.lts-i.startTime,e.send(i)},e.send=function(t){try{(0,a.post)(e.url,t,null,function(n){(0,a.post)(e.urlBackup,t,null,function(e){},{timeout:1e4})},{timeout:1e4})}catch(e){}},e}();t.report=l,t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.JOIN_GATEWAY="join_gateway",t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.getProcessId=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return r().os},r=function(){var e=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];"Chrome"===n[1]&&null!=(e=t.match(/(OPR(?=\/))\/?(\d+)/i))&&(n=e),"Safari"===n[1]&&null!=(e=t.match(/version\/(\d+)/i))&&(n[2]=e[1]),~t.toLowerCase().indexOf("qqbrowser")&&null!=(e=t.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("micromessenger")&&null!=(e=t.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("edge")&&null!=(e=t.match(/(edge(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("trident")&&null!=(e=/\brv[ :]+(\d+)/g.exec(t)||[])&&(n=[null,"IE",e[1]]);var i=void 0,r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var o in r){var a=r[o];if(a.r.test(navigator.userAgent)){i=a.s;break}}return{name:n[1],version:n[2],os:i}}();return function(){return e}}();t.getBrowserInfo=r,t.getBrowserVersion=function(){return r().version},t.getBrowserOS=i,t.isChrome=function(){var e=r();return e.name&&"Chrome"===e.name},t.isSafari=function(){var e=r();return e.name&&"Safari"===e.name},t.isFireFox=function(){var e=r();return e.name&&"Firefox"===e.name},t.isOpera=function(){var e=r();return e.name&&"OPR"===e.name},t.isQQBrowser=function(){var e=r();return e.name&&"QQBrowser"===e.name},t.isWeChatBrowser=function(){var e=r();return e.name&&"MicroMessenger"===e.name},t.isSupportedPC=function(){var e=i();return"Linux"===e||"Mac OS X"===e||"Mac OS"===e||-1!==e.indexOf("Windows")},t.isSupportedMobile=function(){var e=i();return"Android"===e||"iOS"===e},t.getChromeKernelVersion=function(){var e=navigator.userAgent.match(/chrome\/[\d]./i);return e&&e[0]&&e[0].split("/")[1]},t.isChromeKernel=function(){return!!navigator.userAgent.match(/chrome\/[\d]./i)}},function(e,t,n){"use strict";function i(e){return new Promise(function(t,n){o(e,t,n)})}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=null,a=null,s=null,d=null,u=null,c=null,l=null,f=null,p=null,h=null,g={addStream:null},m={log:function(){},extractVersion:function(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseInt(i[n])}};if("object"==("undefined"==typeof window?"undefined":r(window))?(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype?(f=function(e,t){e.srcObject=t},p=function(e){return e.srcObject}):(f=function(e,t){"mozSrcObject"in e?e.mozSrcObject=t:(e._srcObject=t,e.src=t?URL.createObjectURL(t):null)},p=function(e){return"mozSrcObject"in e?e.mozSrcObject:e._srcObject}),o=window.navigator&&window.navigator.getUserMedia):(f=function(e,t){e.srcObject=t},p=function(e){return e.srcObject}),a=function(e,t){f(e,t)},s=function(e,t){f(e,p(t))},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){for(var _ in m.log("This appears to be Firefox"),d="firefox",u=m.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),c=31,h=mozRTCPeerConnection,g)g[_]=h.prototype[_];if(l=function(e,t){if(u<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var r=e.iceServers[i];if(r.hasOwnProperty("urls"))for(var o=0;o<r.urls.length;o++){var a={url:r.urls[o]};0===r.urls[o].indexOf("turn")&&(a.username=r.username,a.credential=r.credential),n.push(a)}else n.push(e.iceServers[i])}e.iceServers=n}var s=new h(e,t);for(var d in g)s[d]=g[d];return s},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),o=function(e,t,n){var i=function(e){if("object"!==(void 0===e?"undefined":r(e))||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i=e[n]="object"===r(e[n])?e[n]:{ideal:e[n]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(n),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[n]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var o={};o[n]="number"==typeof i.ideal?{min:i.ideal,max:i.ideal}:i.ideal,e.advanced.push(o),delete i.ideal,Object.keys(i).length||delete e[n]}}}),t.length&&(e.require=t),e};return u<38&&(m.log("spec: "+JSON.stringify(e)),e.audio&&(e.audio=i(e.audio)),e.video&&(e.video=i(e.video)),m.log("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,n)},navigator.getUserMedia=o,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},u<41){var v=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return v().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){for(var _ in m.log("This appears to be Chrome"),d="chrome",u=m.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),c=38,h=webkitRTCPeerConnection,g)g[_]=h.prototype[_];l=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new h(e,t);for(var i in g)n[i]=g[i];var r=n.getStats.bind(n);return n.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r(e,t);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t};return arguments.length>=2?r.apply(this,[function(e){o[1](a(e))},arguments[0]]):new Promise(function(t,n){r.apply(i,1===o.length&&null===e?[function(e){t.apply(null,[a(e)])},n]:[t,n])})},n},["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===r(arguments[0])){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(i,r){t.apply(e,[i,r,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this;return new Promise(function(i,r){t.apply(n,[e[0],function(){i(),e.length>=2&&e[1].apply(null,[])},function(t){r(t),e.length>=3&&e[2].apply(null,[t])}])})}});var y=function(e){if("object"!==(void 0===e?"undefined":r(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===r(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[o("min",n)]=i.ideal,t.optional.push(a),(a={})[o("max",n)]=i.ideal,t.optional.push(a)):(a[o("",n)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(o=function(e,t,n){return e.audio&&(e.audio=y(e.audio)),e.video&&(e.video=y(e.video)),m.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,n)},navigator.getUserMedia=o,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:i,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var S=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return m.log("spec:   "+JSON.stringify(e)),e.audio=y(e.audio),e.video=y(e.video),m.log("chrome: "+JSON.stringify(e)),S(e)}}else navigator.mediaDevices.getUserMedia=function(e){return i(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){m.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){m.log("Dummy mediaDevices.removeEventListener called.")}),a=function(e,t){u>=43?f(e,t):void 0!==e.src?e.src=t?URL.createObjectURL(t):null:m.log("Error attaching stream to element.")},s=function(e,t){u>=43?f(e,p(t)):e.src=t.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(m.log("This appears to be Edge"),d="edge",u=m.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),c=12):m.log("Browser does not appear to be WebRTC-capable");else m.log("This does not appear to be a browser"),d="not a browser";var b,E={};try{Object.defineProperty(E,"version",{set:function(e){u=e}})}catch(e){}l?b=l:"undefined"!=typeof window&&(b=window.RTCPeerConnection),e.exports={RTCPeerConnection:b,getUserMedia:o,attachMediaStream:a,reattachMediaStream:s,setSrcObject:f,getSrcObject:p,webrtcDetectedBrowser:d,webrtcDetectedVersion:u,webrtcMinimumVersion:c,webrtcTesting:E,webrtcUtils:m}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.popBanTip=t.random=t.safeCall=t.is32Uint=t.vsResHack=t.audioLevelHelper=t.generateSessionId=t.isLiveTranscodingValid=t.checkSystemRequirements=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(5)),a=i(n(0)),s=i(n(11)),d=n(12),u=n(6),c=null,l=function(e){for(var t=0;t<e.length;t++)for(var n in e[t])if("number"!=typeof e[t][n])throw new Error("Param user["+t+"] - ["+n+"] is inVaild");return!0};t.checkSystemRequirements=function(){var e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,n=window.WebSocket,i=!!e&&!!t&&!!n,r=!1;return a.default.debug(o.getBrowserInfo(),"isAPISupport:"+i),o.isChrome()&&o.getBrowserVersion()>=58&&"iOS"!==o.getBrowserOS()&&(r=!0),o.isFireFox()&&o.getBrowserVersion()>=56&&(r=!0),o.isOpera()&&o.getBrowserVersion()>=45&&(r=!0),o.isSafari()&&o.getBrowserVersion()>=11&&(r=!0),(o.isWeChatBrowser()||o.isQQBrowser())&&"iOS"!==o.getBrowserOS()&&(r=!0),o.isSupportedPC()||o.isSupportedMobile()||(r=!1),i&&r},t.isLiveTranscodingValid=function(e){var t=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var n in e)if("lowLatency"===n&&"boolean"!=typeof e[n]||"userConfigExtraInfo"===n&&"object"!==r(e[n])||"transcodingUsers"===n&&!l(e[n])||!~t.indexOf(n)&&"number"!=typeof e[n])throw new Error("Param ["+n+"] is inVaild");return!0},t.generateSessionId=function(){return(0,s.default)().replace(/-/g,"").toUpperCase()},t.audioLevelHelper=function(e){return this.audioContext=(c||(c=(0,d.createAudioContext)()),c),this.sourceNode=e.otWebkitAudioSource||this.audioContext.createMediaStreamSource(e),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var e=0,t=0;t<this.timeDomainData.length;t++)e=Math.max(e,Math.abs(this.timeDomainData[t]-128));return e/128}return a.default.warning("can't find analyser in audioLevelHelper"),0},this},t.vsResHack=function(e,t,n){try{var i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.setAttribute("playsinline",""),i.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(i),i.addEventListener("playing",function(e){o.isFireFox()?i.videoWidth&&(t(i.videoWidth,i.videoHeight),document.body.removeChild(i)):(t(i.videoWidth,i.videoHeight),document.body.removeChild(i))}),(0,u.setSrcObject)(i,e)}catch(e){n(e)}},t.is32Uint=function(e){return!!(0<=e&&e<=4294967295)},t.safeCall=function(){var e=arguments[0];if("function"==typeof e){var t=Array.prototype.slice.call(arguments,1);e.apply(null,t)}},t.random=function(e){isNaN(e)&&(e=1e3);var t=+new Date;return t=(9301*t+49297)%233280,Math.ceil(t/233280*e)},t.popBanTip=function(){if(!document.getElementById("agora-ban-tip")){var e=document.createElement("div");e.id="agora-ban-tip",e.style="position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;",document.querySelector("body").prepend(e);var t=document.createElement("div");t.style="background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;",e.append(t);var n=document.createElement("div");n.style="height: 76px; display: flex; justify-content: center; align-items: center;";var i=document.createElement("span");i.style="height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;",i.innerText="!";var r=document.createElement("span");r.innerText="This browser does not support webRTC",n.append(i),n.append(r);var o=document.createElement("div");o.style="height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;",o.innerText="OK",t.append(n),t.append(o),o.onclick=function(){var e=document.getElementById("agora-ban-tip");e.parentNode.removeChild(e)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUseHttps=t.post=void 0;var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(2));t.post=function(e,t,n,r,o){var a=new XMLHttpRequest;if(a.timeout=t.timeout||i.HTTP_CONNECT_TIMEOUT,a.open("POST",e,!0),a.setRequestHeader("Content-type","application/json; charset=utf-8"),o)for(var s in o)"withCredentials"==s?a.withCredentials=!0:a.setRequestHeader(s,o[s]);a.onload=function(e){n&&n(a.responseText)},a.onerror=function(t){r&&r(t,e)},a.ontimeout=function(t){r&&r(t,e)},a.send(JSON.stringify(t))},t.shouldUseHttps=function(){return"https:"==document.location.protocol}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.createStream=t.Stream=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=i(n(22)),a=n(13),s=n(1),d=i(n(0)),u=n(5),c=n(14),l=n(7),f=n(4),p=i(n(3)),h=n(12),g=n(10),m=function(e){function t(e,t){return{width:{ideal:e},height:{ideal:t}}}var n=(0,s.EventDispatcher)();if(n.params=Object.assign({},e),n.stream=e.stream,n.url=e.url,n.onClose=void 0,n.local=!1,n.videoSource=e.videoSource,n.audioSource=e.audioSource,n.video=!!e.video,n.audio=!!e.audio,n.screen=!!e.screen,n.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},n.videoSize=e.videoSize,n.player=void 0,n.audioLevelHelper=null,e.attributes=e.attributes||{},n.attributes=e.attributes,n.microphoneId=e.microphoneId,n.cameraId=e.cameraId,n.inSwitchDevice=!1,n.videoEnabled=!0,n.audioEnabled=!0,n.lowStream=null,n.videoWidth=0,n.videoHeight=0,n.streamId=null,n.streamId=e.streamID,n.userId=null,n.mirror=!1!==e.mirror,n.DTX=e.audioProcessing&&e.audioProcessing.DTX,n.audioProcessing=e.audioProcessing,n.highQuality=!1,n.stereo=!1,n.speech=!1,n.audioMixing={state:"UNINIT",muted:!0,states:{UNINIT:"UNINIT",IDLE:"IDLE",STARTING:"STARTING",BUSY:"BUSY",PAUSED:"PAUSED"},inEarMonitoring:"FILE",inEarMonitoringModes:{NONE:"NONE",FILE:"FILE",MICROPHONE:"MOCROPHONE",ALL:"ALL"},volume:100,startAt:null,startOffset:null,pauseAt:null,pauseOffset:null,resumeAt:null,resumeOffset:null,stopAt:null,ctx:null,mediaStreamSource:null,mediaStreamDest:null,options:null,buffer:{},source:[]},!(void 0===n.videoSize||n.videoSize instanceof Array&&4===n.videoSize.length))throw Error("Invalid Video Size");n.videoSize=[640,480,640,480],void 0!==e.local&&!0!==e.local||(n.local=!0),n.initialized=!n.local,n.on("collectStats",function(e){e.promises.push(n._getPCStats()),e.promises.push(new Promise(function(e){var t={};n.pc&&n.pc.isSubscriber?null!==window.navigator.userAgent.match("Firefox")&&((0,c.setStat)(t,"videoReceiveResolutionHeight",n.videoHeight),(0,c.setStat)(t,"videoReceiveResolutionWidth",n.videoWidth)):n.pc&&!n.pc.isSubscriber&&(((0,u.isSafari)()||(0,u.isFireFox)())&&((0,c.setStat)(t,"videoSendResolutionHeight",n.videoHeight),(0,c.setStat)(t,"videoSendResolutionWidth",n.videoWidth)),((0,u.isSafari)()||(0,u.isFireFox)())&&n.uplinkStats&&(0,c.setStat)(t,"videoSendPacketsLost",n.uplinkStats.uplink_cumulative_lost)),e(t)})),e.promises.push(new Promise(function(e){var t={};return n.traffic_stats&&n.pc&&n.pc.isSubscriber?((0,c.setStat)(t,"accessDelay",n.traffic_stats.access_delay),(0,c.setStat)(t,"endToEndDelay",n.traffic_stats.e2e_delay),(0,c.setStat)(t,"videoReceiveDelay",n.traffic_stats.video_delay),(0,c.setStat)(t,"audioReceiveDelay",n.traffic_stats.audio_delay)):n.traffic_stats&&n.pc&&!n.pc.isSubscriber&&(0,c.setStat)(t,"accessDelay",n.traffic_stats.access_delay),e(t)}))});var i={true:!0,unspecified:!0,"90p_1":t(160,90),"120p_1":t(160,120),"120p_3":t(120,120),"120p_4":t(212,120),"180p_1":t(320,180),"180p_3":t(180,180),"180p_4":t(240,180),"240p_1":t(320,240),"240p_3":t(240,240),"240p_4":t(424,240),"360p_1":t(640,360),"360p_3":t(360,360),"360p_4":t(640,360),"360p_6":t(360,360),"360p_7":t(480,360),"360p_8":t(480,360),"360p_9":t(640,360),"360p_10":t(640,360),"360p_11":t(640,360),"480p_1":t(640,480),"480p_2":t(640,480),"480p_3":t(480,480),"480p_4":t(640,480),"480p_6":t(480,480),"480p_8":t(848,480),"480p_9":t(848,480),"480p_10":t(640,480),"720p_1":t(1280,720),"720p_2":t(1280,720),"720p_3":t(1280,720),"720p_5":t(960,720),"720p_6":t(960,720),"1080p_1":t(1920,1080),"1080p_2":t(1920,1080),"1080p_3":t(1920,1080),"1080p_5":t(1920,1080),"1440p_1":t(2560,1440),"1440p_2":t(2560,1440),"4k_1":t(3840,2160),"4k_3":t(3840,2160)};return n.unmuteAudio=void 0,n.muteAudio=void 0,n.unmuteVideo=void 0,n.muteVideo=void 0,n.setVideoResolution=function(t){return void 0!==i[t+=""]&&(e.video=i[t],e.attributes=e.attributes||{},e.attributes.resolution=t,!0)},n.setVideoFrameRate=function(t){return!(0,u.isFireFox)()&&"object"===(void 0===t?"undefined":r(t))&&t instanceof Array&&t.length>1&&(e.attributes=e.attributes||{},e.attributes.minFrameRate=t[0],e.attributes.maxFrameRate=t[1],!0)},n.setVideoBitRate=function(t){return"object"===(void 0===t?"undefined":r(t))&&t instanceof Array&&t.length>1&&(e.attributes=e.attributes||{},e.attributes.minVideoBW=t[0],e.attributes.maxVideoBW=t[1],!0)},n.setScreenBitRate=function(t){return"object"===(void 0===t?"undefined":r(t))&&t instanceof Array&&t.length>1&&(e.screenAttributes=e.screenAttributes||{},e.screenAttributes.minVideoBW=t[0],e.screenAttributes.maxVideoBW=t[1],!0)},n.setScreenProfile=function(e){if("string"==typeof e&&n.screen){switch(e){case"480p_1":n.screenAttributes.width=640,n.screenAttributes.height=480,n.screenAttributes.maxFr=5,n.screenAttributes.minFr=1;break;case"480p_2":n.screenAttributes.width=640,n.screenAttributes.height=480,n.screenAttributes.maxFr=30,n.screenAttributes.minFr=25;break;case"720p_1":n.screenAttributes.width=1280,n.screenAttributes.height=720,n.screenAttributes.maxFr=5,n.screenAttributes.minFr=1;break;case"720p_2":n.screenAttributes.width=1280,n.screenAttributes.height=720,n.screenAttributes.maxFr=30,n.screenAttributes.minFr=25;break;case"1080p_1":n.screenAttributes.width=1920,n.screenAttributes.height=1080,n.screenAttributes.maxFr=5,n.screenAttributes.minFr=1;break;case"1080p_2":n.screenAttributes.width=1920,n.screenAttributes.height=1080,n.screenAttributes.maxFr=30,n.screenAttributes.minFr=25}return!0}return!1},n.setVideoProfileCustom=function(e){n.setVideoResolution(e[0]),n.setVideoFrameRate([e[1],e[1]]),n.setVideoBitRate([e[2],e[2]])},n.setVideoProfileCustomPlus=function(i){console.log(i),e.video=t(i.width,i.height),e.attributes=e.attributes||{},e.attributes.resolution=i.width+"x"+i.height,n.setVideoFrameRate([i.framerate,i.framerate]),n.setVideoBitRate([i.bitrate,i.bitrate])},n.setVideoProfile=function(e){if(n.profile=e,"string"==typeof e&&n.video){switch(e){case"120p":case"120P":case"120p_1":case"120P_1":n.setVideoResolution("120p_1"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([10,65]);break;case"120p_3":case"120P_3":n.setVideoResolution("120p_3"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([10,50]);break;case"180p":case"180P":case"180p_1":case"180P_1":n.setVideoResolution("180p_1"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([10,140]);break;case"180p_3":case"180P_3":n.setVideoResolution("180p_3"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([10,100]);break;case"180p_4":case"180P_4":n.setVideoResolution("180p_4"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([10,120]);break;case"240p":case"240P":case"240p_1":case"240P_1":n.setVideoResolution("240p_1"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([10,200]);break;case"240p_3":case"240P_3":n.setVideoResolution("240p_3"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([10,140]);break;case"240p_4":case"240P_4":n.setVideoResolution("240p_4"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([10,220]);break;case"360p":case"360P":case"360p_1":case"360P_1":n.setVideoResolution("360p_1"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([20,400]);break;case"360p_3":case"360P_3":n.setVideoResolution("360p_3"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([20,260]);break;case"360p_4":case"360P_4":n.setVideoResolution("360p_4"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([20,600]);break;case"360p_6":case"360P_6":n.setVideoResolution("360p_6"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([20,400]);break;case"360p_7":case"360P_7":n.setVideoResolution("360p_7"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([20,320]);break;case"360p_8":case"360P_8":n.setVideoResolution("360p_8"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([20,490]);break;case"360p_9":case"360P_9":n.setVideoResolution("360p_9"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([20,800]);break;case"360p_10":case"360P_10":n.setVideoResolution("360p_10"),n.setVideoFrameRate([24,24]),n.setVideoBitRate([20,800]);break;case"360p_11":case"360P_11":n.setVideoResolution("360p_11"),n.setVideoFrameRate([24,24]),n.setVideoBitRate([20,1e3]);break;case"480p":case"480P":case"480p_1":case"480P_1":n.setVideoResolution("480p_1"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([20,500]);break;case"480p_2":case"480P_2":n.setVideoResolution("480p_2"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([20,1e3]);break;case"480p_3":case"480P_3":n.setVideoResolution("480p_3"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([20,400]);break;case"480p_4":case"480P_4":n.setVideoResolution("480p_4"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([20,750]);break;case"480p_6":case"480P_6":n.setVideoResolution("480p_6"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([20,600]);break;case"480p_8":case"480P_8":n.setVideoResolution("480p_8"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([20,610]);break;case"480p_9":case"480P_9":n.setVideoResolution("480p_9"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([20,930]);break;case"480p_10":case"480P_10":n.setVideoResolution("480p_10"),n.setVideoFrameRate([10,10]),n.setVideoBitRate([20,400]);break;case"720p":case"720P":case"720p_1":case"720P_1":n.setVideoResolution("720p_1"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([30,1130]);break;case"720p_2":case"720P_2":n.setVideoResolution("720p_2"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([30,2e3]);break;case"720p_3":case"720P_3":n.setVideoResolution("720p_3"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([30,1710]);break;case"720p_5":case"720P_5":n.setVideoResolution("720p_5"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([30,910]);break;case"720p_6":case"720P_6":n.setVideoResolution("720p_6"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([30,1380]);break;case"1080p":case"1080P":case"1080p_1":case"1080P_1":n.setVideoResolution("1080p_1"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([50,2080]);break;case"1080p_2":case"1080P_2":n.setVideoResolution("1080p_2"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([50,3e3]);break;case"1080p_3":case"1080P_3":n.setVideoResolution("1080p_3"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([50,3150]);break;case"1080p_5":case"1080P_5":n.setVideoResolution("1080p_5"),n.setVideoFrameRate([60,60]),n.setVideoBitRate([50,4780]);break;case"1440p":case"1440P":case"1440p_1":case"1440P_1":n.setVideoResolution("1440p_1"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([50,4850]);break;case"1440p_2":case"1440P_2":n.setVideoResolution("1440p_2"),n.setVideoFrameRate([60,60]),n.setVideoBitRate([50,7350]);break;case"4k":case"4K":case"4k_1":case"4K_1":n.setVideoResolution("4k_1"),n.setVideoFrameRate([30,30]),n.setVideoBitRate([50,8910]);break;case"4k_3":case"4K_3":n.setVideoResolution("4k_3"),n.setVideoFrameRate([60,60]),n.setVideoBitRate([50,13500]);break;default:n.setVideoResolution("480p_1"),n.setVideoFrameRate([15,15]),n.setVideoBitRate([20,500])}return!0}return!1},n.setAudioProfile=function(e){if(n.audioProfile=e,"string"==typeof e&&n.audio){switch(e){case"speech_low_quality":n.highQuality=!1,n.stereo=!1,n.speech=!0,n.lowQuality=!0;break;case"speech_standard":n.highQuality=!1,n.stereo=!1,n.speech=!0,n.lowQuality=!1;break;case"music_standard":n.highQuality=!1,n.stereo=!1,n.speech=!1,n.lowQuality=!1;break;case"standard_stereo":n.highQuality=!1,n.stereo=!0,n.speech=!1,n.lowQuality=!1;break;case"high_quality":n.highQuality=!0,n.stereo=!1,n.speech=!1,n.lowQuality=!1;break;case"high_quality_stereo":n.highQuality=!0,n.stereo=!0,n.speech=!1,n.lowQuality=!1;break;default:n.highQuality=!1,n.stereo=!1,n.speech=!1,n.lowQuality=!1}return!0}return!1},n.getId=function(){return n.streamId},n.getUserId=function(){return n.userId},n.setUserId=function(e){n.userId&&d.default.warning("Stream.userId "+n.userId+" => "+e),n.userId=e},n.getAttributes=function(){return e.screen?n.screenAttributes:e.attributes},n.hasAudio=function(){return n.audio},n.hasVideo=function(){return n.video},n.hasScreen=function(){return n.screen},n.isVideoOn=function(){return(n.hasVideo()||n.hasScreen())&&n.videoEnabled},n.isAudioOn=function(){return n.hasAudio()&&n.audioEnabled},n.init=function(t,i){var o=((new Date).getTime(),arguments[2]);if(void 0===o&&(o=2),!0!==n.initialized)if(!0===n.local){if(n.videoSource||n.audioSource){var s=new MediaStream;return n.videoSource&&(d.default.debug("Added videoSource"),s.addTrack(n.videoSource),n.video=!0),n.audioSource&&(d.default.debug("Added audioSource"),s.addTrack(n.audioSource),n.audio=!0),n.hasVideo()?(0,l.vsResHack)(s,function(e,i){d.default.info("Video Source width "+e+" height "+i),n.stream=s,n.initialized=!0,t&&t()},function(e){d.default.warning("Failed to get width & height from video source",e),n.stream=s,n.initialized=!0,t&&t()}):(n.stream=s,n.initialized=!0,t&&t())}try{if((e.audio||e.video||e.screen)&&void 0===e.url){d.default.debug("Requested access to local media");var c=e.video;if(e.screen)var f={video:c,audio:!1,screen:!0,data:!0,extensionId:e.extensionId,attributes:n.screenAttributes,fake:e.fake,mediaSource:e.mediaSource};else if(f={video:c,audio:e.audio,fake:e.fake},!(null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35)){var p=30,h=30;if(void 0!==e.attributes.minFrameRate&&(p=e.attributes.minFrameRate),void 0!==e.attributes.maxFrameRate&&(h=e.attributes.maxFrameRate),!0===f.audio){f.audio=!e.microphoneId||{deviceId:{exact:e.microphoneId}};var g={};n.audioProcessing&&(void 0!==n.audioProcessing.AGC&&((0,u.isFireFox)()?g.autoGainControl=n.audioProcessing.AGC:(0,u.isChrome)()&&(g.googAutoGainControl=n.audioProcessing.AGC,g.googAutoGainControl2=n.audioProcessing.AGC)),void 0!==n.audioProcessing.AEC&&(g.echoCancellation=n.audioProcessing.AEC),void 0!==n.audioProcessing.ANS&&((0,u.isFireFox)()?g.noiseSuppression=n.audioProcessing.ANS:(0,u.isChrome)()&&(g.googNoiseSuppression=n.audioProcessing.ANS))),n.stereo&&(0,u.isChrome)()&&(g.googAutoGainControl=!1,g.googAutoGainControl2=!1,g.echoCancellation=!1,g.googNoiseSuppression=!1),0!==Object.keys(g).length&&(f.audio=!0===f.audio?{mandatory:g}:Object.assign(f.audio,g))}!0===f.video?(f.video={width:{ideal:n.videoSize[0]},height:{ideal:n.videoSize[1]},frameRate:{ideal:p,max:h}},n.setVideoBitRate([500,500]),f.video.deviceId=e.cameraId?{exact:e.cameraId}:void 0):"object"===r(f.video)&&(f.video.frameRate={ideal:p,max:h},f.video.deviceId=e.cameraId?{exact:e.cameraId}:void 0)}d.default.debug(f);var m=Object.assign({},f);if(n.constraints=f,(0,a.GetUserMedia)(m,function(r){n.screenAudioTrack&&r.addTrack(n.screenAudioTrack);var o=r.getVideoTracks().length>0,a=r.getAudioTracks().length>0;return m.video&&!o&&m.audio&&!a?(d.default.error("Media access: NO_CAMERA_MIC_PERMISSION"),i&&i("NO_CAMERA_MIC_PERMISSION")):m.video&&!o?(d.default.error("Media access: NO_CAMERA_PERMISSION"),i&&i("NO_CAMERA_PERMISSION")):m.screen&&!o?(d.default.error("Media access: NO_SCREEN_PERMISSION"),i&&i("NO_SCREEN_PERMISSION")):m.audio&&!a?(d.default.error("Media access: NO_MIC_PERMISSION"),i&&i("NO_MIC_PERMISSION")):(d.default.debug("User has granted access to local media"),n.dispatchEvent({type:"accessAllowed"}),n.stream=r,n.initialized=!0,n.videoEnabled=!!(e.video||e.screen||e.videoSource),n.audioEnabled=!(!e.audio&&!e.audioSource),e.screen&&e.audio&&!n.screenAudioTrack||t&&t(),n.hasVideo()&&(0,l.vsResHack)(r,function(e,t){n.videoWidth=e,n.videoHeight=t},function(e){d.default.warning("vsResHack failed:"+e)}),void(e.screen&&(0,u.isChrome)()&&n.stream&&n.stream.getVideoTracks()[0]&&(n.stream.getVideoTracks()[0].onended=function(){n.dispatchEvent({type:"stopScreenSharing"})})))},function(e){var r={type:"error",msg:e.name||e};switch(r.msg){case"Starting video failed":case"TrackStartError":if(n.videoSize=void 0,o>0)return void setTimeout(function(){n.init(t,i,o-1)},1);r.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":r.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":r.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":r.msg="PERMISSION_DENIED",n.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":n.dispatchEvent({type:"accessDenied"});break;case"InvalidStateError":r.msg="PERMISSION_DENIED",n.dispatchEvent({type:"accessDenied"});break;case"NotAllowedError":n.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":r.msg="CONSTRAINT_NOT_SATISFIED";break;default:r.msg||(r.msg="UNDEFINED")}if(d.default.error("Media access:",r.msg),"function"==typeof i)return i(r)}),e.screen&&e.audio){var _=!e.microphoneId||{deviceId:{exact:e.microphoneId}};g={},n.audioProcessing&&(void 0!==n.audioProcessing.AGC&&((0,u.isFireFox)()?g.autoGainControl=n.audioProcessing.AGC:(0,u.isChrome)()&&(g.googAutoGainControl=n.audioProcessing.AGC,g.googAutoGainControl2=n.audioProcessing.AGC)),void 0!==n.audioProcessing.AEC&&(g.echoCancellation=n.audioProcessing.AEC),void 0!==n.audioProcessing.ANS&&((0,u.isFireFox)()?g.noiseSuppression=n.audioProcessing.ANS:(0,u.isChrome)()&&(g.googNoiseSuppression=n.audioProcessing.ANS))),n.stereo&&(0,u.isChrome)()&&(g.googAutoGainControl=!1,g.googAutoGainControl2=!1,g.echoCancellation=!1,g.googNoiseSuppression=!1),0!==Object.keys(g).length&&(_=!0===_?{mandatory:g}:Object.assign(_,g));var v={video:!1,audio:_};d.default.debug(v),(0,a.GetUserMedia)(v,function(e){d.default.info("User has granted access to auxiliary local media."),n.dispatchEvent({type:"accessAllowed"});var i=e.getAudioTracks()[0];n.stream?(n.stream.addTrack(i),t&&t()):n.screenAudioTrack=i},function(e){var r={type:"error",msg:e.name||e};switch(r.msg){case"Starting video failed":case"TrackStartError":if(n.videoSize=void 0,o>0)return void setTimeout(function(){n.init(t,i,o-1)},1);r.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":r.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":r.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":r.msg="PERMISSION_DENIED",n.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":n.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":r.msg="CONSTRAINT_NOT_SATISFIED";break;default:r.msg||(r.msg="UNDEFINED")}d.default.error("Media access:",r.msg),"function"==typeof i&&i(r)})}}else"function"==typeof i&&i({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(e){d.default.error("Stream init:",e),"function"==typeof i&&i({type:"error",msg:e.message||e})}}else"function"==typeof i&&i({type:"warning",msg:"STREAM_NOT_LOCAL"});else"function"==typeof i&&i({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"})},n.close=function(){if(d.default.debug("Close stream with id",n.streamId),void 0!==n.stream){var e=n.stream.getTracks();for(var t in e)e.hasOwnProperty(t)&&e[t].stop();n.stream=void 0}(0,u.isSafari)()&&n.pc&&n.pc.peerConnection&&n.pc.peerConnection.removeTrack&&n.pc.peerConnection.getSenders&&n.pc.peerConnection.getSenders().forEach(function(e){e&&(d.default.debug("Remove Track",e),n.pc.peerConnection.removeTrack(e))}),n.initialized=!1,n.unmuteAudio=void 0,n.muteAudio=void 0,n.unmuteVideo=void 0,n.muteVideo=void 0,n.lowStream&&n.lowStream.close()},n.enableAudio=function(){return d.default.debug("Enable audio stream with id",n.streamId),n._flushAudioMixingMuteStatus(!1),!(!n.hasAudio()||!n.initialized||void 0===n.stream||!0===n.stream.getAudioTracks()[0].enabled||(void 0!==n.unmuteAudio&&n.unmuteAudio(),n.audioEnabled=!0,n.stream.getAudioTracks()[0].enabled=!0,0))},n.disableAudio=function(){return d.default.debug("Disable audio stream with id",n.streamId),n._flushAudioMixingMuteStatus(!0),!!(n.hasAudio()&&n.initialized&&void 0!==n.stream&&n.stream.getAudioTracks()[0].enabled)&&(void 0!==n.muteAudio&&n.muteAudio(),n.audioEnabled=!1,n.stream.getAudioTracks()[0].enabled=!1,n.sid&&f.report.audioSendingStopped(n.sid,{succ:!0,reason:"muteAudio"}),!0)},n.enableVideo=function(){return d.default.debug("Enable video stream with id",n.streamId),!(!n.initialized||void 0===n.stream||!n.stream.getVideoTracks().length||!0===n.stream.getVideoTracks()[0].enabled||(void 0!==n.unmuteVideo&&n.unmuteVideo(),n.pc&&(n.pc.isVideoMute=!1),n.videoEnabled=!0,n.stream.getVideoTracks()[0].enabled=!0,n.lowStream&&n.lowStream.enableVideo(),0))},n.disableVideo=function(){return d.default.debug("Disable video stream with id",n.streamId),!!(n.initialized&&void 0!==n.stream&&n.stream.getVideoTracks().length&&n.stream.getVideoTracks()[0].enabled)&&(void 0!==n.muteVideo&&n.muteVideo(),n.pc&&(n.pc.isVideoMute=!0),n.videoEnabled=!1,n.stream.getVideoTracks()[0].enabled=!1,n.lowStream&&n.lowStream.disableVideo(),n.sid&&f.report.videoSendingStopped(n.sid,{succ:!0,reason:"muteVideo"}),!0)},n.addTrack=function(e){if(n.pc&&n.pc.addTrack(e,n.stream),"audio"==e.kind){var t=new MediaStream;t.addTrack(e);var i=n.stream.getVideoTracks()[0];i&&t.addTrack(i),n.stream=t,n.player&&n.player.video&&(n.player.video.srcObject=n.stream)}else n.stream.addTrack(e)},n.removeTrack=function(e){n.pc&&n.pc.removeTrack(e,n.stream),n.stream.removeTrack(e),"live"==e.readyState&&(e.stop(),d.default.debug("Track "+e.kind+" Stopped"))},n.setAudioOutput=function(e,t,i){return"string"!=typeof e?(d.default.error("setAudioOutput Invalid Parameter",e),i&&i(p.default.INVALID_PARAMETER)):(n.audioOutput=e,n.player?void n.player.setAudioOutput(e,t,i):t&&t())},n.play=function(e,t){n.elementID=e,n.playOptions=t,n.isPlaying()?d.default.error("Stream.play(): Stream is already playing"):!n.local||n.video||n.screen?void 0!==e&&(n.player=new o.default({id:n.getId(),stream:n,elementID:e,options:t})):n.hasAudio()&&(n.player=new o.default({id:n.getId(),stream:n,elementID:e,options:t})),n.audioOutput&&n.player.setAudioOutput(n.audioOutput),void 0!==n.audioLevel&&n.player.setAudioVolume(n.audioLevel),n._flushAudioMixingMuteStatus(!1)},n.stop=function(){d.default.debug("Stop stream player with id",n.streamId),n.player?(n.player.destroy(),delete n.player):d.default.error("Stream.stop(): Stream is not playing"),n._flushAudioMixingMuteStatus(!0)},n.isPlaying=function(){return!!n.player},n.getVideoTrack=function(){if(n.stream&&n.stream.getVideoTracks){var e=n.stream.getVideoTracks()[0];if(e)return d.default.info("getVideoTrack",e),e}d.default.info("getVideoTrack None")},n.getAudioTrack=function(){if(n.stream&&n.stream.getAudioTracks){var e=n.stream.getAudioTracks()[0];if(e)return d.default.info("getAudioTracks",e),e}d.default.info("getAudioTracks None")},n._replaceMediaStreamTrack=function(e,t,i){if(n.stream){if("video"==e.kind){if(o=n.stream.getVideoTracks()[0])return n.stream.removeTrack(o),n.stream.addTrack(e),d.default.debug("_replaceMediaStreamTrack "+e.kind+" SUCCESS"),"live"==o.readyState&&(o.stop(),d.default.debug("Track "+o.kind+" Stopped")),t&&t();var r="MEDIASTREAM_TRACK_NOT_FOUND";return d.default.error("MEDIASTREAM_TRACK_NOT_FOUND "+e.kind),i(r)}var o;return"audio"==e.kind?(o=n.stream.getAudioTracks()[0])?(n.stream.removeTrack(o),n.stream.addTrack(e),d.default.debug("_replaceMediaStreamTrack SUCCESS"),"live"==o.readyState&&(o.stop(),d.default.debug("Track "+o.kind+" Stopped")),t&&t()):(r="MEDIASTREAM_TRACK_NOT_FOUND",d.default.error("MEDIASTREAM_TRACK_NOT_FOUND "+e.kind),i(r)):(d.default.error("_replaceMediaStreamTrack "+(r="INVALID_TRACK_TYPE")+" "+e.kind),i&&i(r))}return d.default.error("_replaceMediaStreamTrack "+(r="NO_STREAM_FOUND")),i&&i(r)},n.replaceTrack=function(e,t,i){return e&&e.kind?n.pc&&n.pc.hasSender&&n.pc.hasSender(e.kind)?void n.pc.replaceTrack(e,function(){return d.default.debug("PeerConnection.replaceTrack "+e.kind+" SUCCESS"),n._replaceMediaStreamTrack(e,t,i)},function(t){return d.default.error("PeerConnection.replaceTrack "+e.kind+" Failed "+t),i&&i(t)}):n._replaceMediaStreamTrack(e,t,i):i&&i("INVALID_TRACK")},n.setAudioVolume=function(e){e>=0&&e<=100?(n.audioLevel=e,n.player&&n.player.setAudioVolume(e)):d.default.error("Invalid audio level: "+e)},n.getStats=function(e,t){var i={type:"collectStats",promises:[]};n.dispatchEvent(i),Promise.all(i.promises).then(function(t){var i=Object.assign.apply(Object,t);e&&setTimeout(e.bind(n,i),0)}).catch(function(e){t&&setTimeout(t.bind(n,e),0)})},n._getPCStats=function(){return new Promise(function(e,t){if(!n.pc||"established"!==n.pc.state||!n.pc.getStats)return t("PEER_CONNECTION_NOT_ESTABLISHED");n.pc.getStats(function(i){if(!n.pc||"established"!==n.pc.state||!n.pc.getStats)return t("PEER_CONNECTION_STATE_CHANGE");var r=n.pc.isSubscriber?(0,c.subscribeStatsFilter)(i):(0,c.publishStatsFilter)(i);return e(r)})}).then(function(e){return n.pc.isSubscriber?(0,u.isFireFox)()&&((0,c.setStat)(e,"videoReceiveResolutionHeight",n.videoHeight),(0,c.setStat)(e,"videoReceiveResolutionWidth",n.videoWidth)):(((0,u.isSafari)()||(0,u.isFireFox)())&&((0,c.setStat)(e,"videoSendResolutionHeight",n.videoHeight),(0,c.setStat)(e,"videoSendResolutionWidth",n.videoWidth)),((0,u.isSafari)()||(0,u.isFireFox)())&&n.uplinkStats&&(0,c.setStat)(e,"videoSendPacketsLost",n.uplinkStats.uplink_cumulative_lost)),Promise.resolve(e)})},n.getAudioLevel=function(){return n.audioLevelHelper?n.audioLevelHelper.getAudioLevel():n.stream?0!==n.stream.getAudioTracks().length?(n.audioLevelHelper=new l.audioLevelHelper(n.stream),n.audioLevelHelper.getAudioLevel()):void d.default.warning("can't get audioLevel beacuse no audio trace in stream"):(d.default.warning("can't get audioLevel beacuse no stream exist"),0)},n.loadAudioBuffer=function(e,t,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){if(r.status>400){var t=r.statusText;return d.default.error("loadAudioBuffer Failed: "+t),i(t)}var o=r.response;n.audioMixing.state==n.audioMixing.states.UNINIT&&n._initAudioContext(),n.audioMixing.ctx.decodeAudioData(o,function(t){n.audioMixing.buffer[e]=t,i(null)},function(e){d.default.error("decodeAudioData Failed:",e),i(e)})},r.send()},n.createAudioBufferSource=function(e){if(n.audioMixing.buffer[e.id]){var t=n.audioMixing.buffer[e.id],i=n.audioMixing.ctx.createBufferSource();i.buffer=t;var r=n.audioMixing.ctx.createGain();return i.connect(r),r.connect(n.audioMixing.mediaStreamDest),i.gainNode=r,e.loop?(i.loop=!0,i.start(0,e.playTime/1e3)):e.cycle>1?(0,u.isChrome)()?(i.loop=!0,i.start(0,e.playTime/1e3,(e.cycle*t.duration*1e3-(e.playTime||0))/1e3)):(d.default.warning("Cycle Param is ignored by current browser"),i.start(0,e.playTime/1e3)):i.start(0,e.playTime/1e3),n.audioMixing.source.push(i),n._flushAudioMixingMuteStatus(),i.addEventListener("ended",function(){for(var e=n.audioMixing.source.length-1;e>=0;e--)i==n.audioMixing.source[e]&&n.audioMixing.source.splice(e,1);n.dispatchEvent({type:"audioSourceEnded",source:i})}),i}return d.default.error("AUDIOBUFFER_NOT_FOUND",e.id),!1},n.on("audioSourceEnded",function(e){0!=n.audioMixing.source.length||n.audioMixing.state!=n.audioMixing.states.BUSY||n.pauseAt||(n.audioMixing.state=n.audioMixing.states.IDLE,n.audioMixing.startAt=null,n.audioMixing.startOffset=null,n.audioMixing.resumeAt=null,n.audioMixing.resumeOffset=null,n.audioMixing.mediaStreamSource.connect(n.audioMixing.mediaStreamDest))}),n.clearAudioBufferSource=function(){n.audioBufferSource.forEach(function(e){e.stop()})},n._initAudioContext=function(){if(n.audioMixing.state!==n.audioMixing.states.UNINIT)throw new Error("Failed to init audio context "+n.audioMixing.state);if(!n.stream)throw new Error("Failed to init audio context. Local Stream not initialized");n.audioMixing.ctx=(0,h.createAudioContext)(),n.audioMixing.mediaStreamSource=n.audioMixing.ctx.createMediaStreamSource(n.stream),n.audioMixing.mediaStreamDest=n.audioMixing.ctx.createMediaStreamDestination(),n.audioMixing.mediaStreamSource.connect(n.audioMixing.mediaStreamDest);var e=n.stream.getVideoTracks()[0];if(e&&n.audioMixing.mediaStreamDest.stream.addTrack(e),n.stream=n.audioMixing.mediaStreamDest.stream,n.pc&&n.pc.peerConnection&&n.pc.peerConnection){var t=(n.pc.peerConnection&&n.pc.peerConnection.getSenders()).find(function(e){return e&&e.track&&"audio"==e.track.kind}),i=n.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];t&&t.replaceTrack&&i&&t.replaceTrack(i)}n.audioMixing.state=n.audioMixing.states.IDLE},n._reloadInEarMonitoringMode=function(e){if(e){if(!n.audioMixing.inEarMonitoringModes[e])return d.default.error("Invalid InEarMonitoringMode "+e);n.audioMixing.inEarMonitoring=e}switch(n.audioMixing.state==n.audioMixing.states.UNINIT&&n._initAudioContext(),n.audioMixing.inEarMonitoring){case n.audioMixing.inEarMonitoringModes.FILE:n.audioMixing.mediaStreamSource.connectedToDestination&&(n.audioMixing.mediaStreamSource.disconnect(n.audioMixing.ctx.destination),n.audioMixing.mediaStreamSource.connectedToDestination=!1);case n.audioMixing.inEarMonitoringModes.ALL:n.audioMixing.source.forEach(function(e){e.connectedToDestination||(e.gainNode.connect(n.audioMixing.ctx.destination),e.connectedToDestination=!0)})}switch(n.audioMixing.inEarMonitoring){case n.audioMixing.inEarMonitoringModes.MICROPHONE:n.audioMixing.source.forEach(function(e){e.connectedToDestination&&(e.gainNode.disconnect(n.audioMixing.ctx.destination),e.connectedToDestination=!1)});case n.audioMixing.inEarMonitoringModes.ALL:n.audioMixing.mediaStreamSource.connectedToDestination||(n.audioMixing.mediaStreamSource.connect(n.audioMixing.ctx.destination),n.audioMixing.mediaStreamSource.connectedToDestination=!0)}},n._startAudioMixingBufferSource=function(e){n.audioMixing.state==n.audioMixing.states.UNINIT&&n._initAudioContext();var t=e.replace,i=n.createAudioBufferSource({id:e.filePath,loop:e.loop,cycle:e.cycle,playTime:e.playTime});return i?(n._reloadInEarMonitoringMode(),t&&n.audioMixing.mediaStreamSource.disconnect(n.audioMixing.mediaStreamDest),i):null},n._stopAudioMixingBufferSource=function(){var e=n.audioMixing.source[0];return e?(n.audioMixing.mediaStreamSource.connect(n.audioMixing.mediaStreamDest),e.stop(),e):null},n._flushAudioMixingMuteStatus=function(e){void 0!==e&&(n.audioMixing.muted=!!e),n.audioMixing.source.forEach(function(e){e.gainNode.gain.value=n.audioMixing.muted?0:n.audioMixing.volume/100})},n.startAudioMixing=function(e,t){var i;if((0,u.isSafari)()&&(0,u.getBrowserVersion)()<12)return d.default.error("Cannot startAudioMixing: ",i="BROWSER_NOT_SUPPORT"),t(i);if(n.audioMixing.state==n.audioMixing.states.UNINIT&&n._initAudioContext(),n.audioMixing.state!==n.audioMixing.states.IDLE)return d.default.error("Cannot startAudioMixing: ",i=n.audioMixing.state),t(i);if(void 0!==e.cycle&&!e.cycle>0)return d.default.error(i="Invalid Parmeter cycle: "+e.cycle),t(i);if(n.audioMixing.state=n.audioMixing.states.STARTING,n.audioMixing.options=e,n.audioMixing.buffer[e.filePath]){if(n._startAudioMixingBufferSource(e))return n.audioMixing.startAt=Date.now(),n.audioMixing.resumeAt=null,n.audioMixing.pauseOffset=null,n.audioMixing.pauseAt=null,n.audioMixing.resumeOffset=null,n.audioMixing.stopAt=null,n.audioMixing.startOffset=e.playTime||0,n.audioMixing.state=n.audioMixing.states.BUSY,t&&t(null);n.audioMixing.state=n.audioMixing.states.IDLE;var r="CREATE_BUFFERSOURCE_FAILED";if(t)return t(r);d.default.error(r)}else n.loadAudioBuffer(e.filePath,e.filePath,function(i){if(i)n.audioMixing.state=n.audioMixing.states.IDLE,t?t(i):d.default.error(i);else{if(n._startAudioMixingBufferSource(e))return n.audioMixing.startAt=Date.now(),n.audioMixing.resumeAt=null,n.audioMixing.pauseOffset=null,n.audioMixing.pauseAt=null,n.audioMixing.resumeOffset=null,n.audioMixing.stopAt=null,n.audioMixing.startOffset=e.playTime||0,n.audioMixing.state=n.audioMixing.states.BUSY,t&&t(null);if(n.audioMixing.state=n.audioMixing.states.IDLE,i="CREATE_BUFFERSOURCE_FAILED",t)return t(i);d.default.error(i)}})},n.stopAudioMixing=function(){n.audioMixing.state==n.audioMixing.states.BUSY||n.audioMixing.state==n.audioMixing.states.PAUSED?(n._stopAudioMixingBufferSource(),n.audioMixing.stopAt=Date.now(),n.audioMixing.state=n.audioMixing.states.IDLE):d.default.error("Invalid state for stopAudioMixing "+n.audioMixing.state)},n.pauseAudioMixing=function(){n.audioMixing.state==n.audioMixing.states.BUSY?(n._stopAudioMixingBufferSource(),n.audioMixing.pauseAt=Date.now(),n.audioMixing.state=n.audioMixing.states.PAUSED,n.audioMixing.pauseOffset=n.audioMixing.resumeAt?n.audioMixing.pauseAt-n.audioMixing.resumeAt+n.audioMixing.resumeOffset:n.audioMixing.pauseAt-n.audioMixing.startAt+n.audioMixing.startOffset):d.default.error("Invalid State for pauseAudioMixing "+n.audioMixing.state)},n.resumeAudioMixing=function(){n.audioMixing.state==n.audioMixing.states.PAUSED?(n._startAudioMixingBufferSource({filePath:n.audioMixing.options.filePath,cycle:n.audioMixing.options.cycle,loop:n.audioMixing.options.loop,playTime:n.audioMixing.pauseOffset,replace:n.audioMixing.options.replace}),n.audioMixing.resumeAt=Date.now(),n.audioMixing.resumeOffset=n.audioMixing.pauseOffset,n.audioMixing.state=n.audioMixing.states.BUSY,n.audioMixing.pauseAt=null,n.audioMixing.pauseOffset=null):d.default.error("Invalid State for resumeAudioMixing "+n.audioMixing.state)},n.adjustAudioMixingVolume=function(e){n.audioMixing.volume=e,n._flushAudioMixingMuteStatus()},n.getAudioMixingDuration=function(){return n.audioMixing.options&&n.audioMixing.options.filePath&&n.audioMixing.buffer[n.audioMixing.options.filePath]?1e3*n.audioMixing.buffer[n.audioMixing.options.filePath].duration:null},n.getAudioMixingCurrentPosition=function(){return n.audioMixing.state==n.audioMixing.states.PAUSED?n.audioMixing.pausedPosition%n.getAudioMixingDuration():n.audioMixing.state==n.audioMixing.states.BUSY?(Date.now()-n.audioMixing.startAt+n.audioMixing.startOffset)%n.getAudioMixingDuration():void d.default.error("Invalid State for getAudioMixingCurrentPosition "+n.audioMixing.state)},n.setAudioMixingPosition=function(e){n.audioMixing.state==n.audioMixing.states.BUSY?(n._stopAudioMixingBufferSource(),n._startAudioMixingBufferSource({filePath:n.audioMixing.options.filePath,loop:n.audioMixing.options.loop,cycle:n.audioMixing.options.cycle,playTime:e}),n.audioMixing.startAt=Date.now(),n.audioMixing.startOffset=e,n.audioMixing.resumeAt=null,n.audioMixing.resumeOffset=null,n.audioMixing.pauseOffset=null,n.audioMixing.pauseAt=null):n.audioMixing.state==n.audioMixing.states.PAUSED?n.audioMixing.pauseOffset=e:d.default.error("Invalid State for setAudioMixingPosition "+n.audioMixing.state)},n.setVideoProfile("480P"),n._switchVideoDevice=function(e,t,i){if(e===n.cameraId)return t&&t();n.constraints.video.deviceId={exact:e},d.default.debug(n.constraints);var r=Object.assign({},n.constraints);(0,a.GetUserMedia)(r,function(r){try{(0,u.isSafari)()&&"11"===(0,u.getBrowserVersion)()?n.replaceTrack(r.getVideoTracks()[0],t,i):(n.removeTrack(n.stream.getVideoTracks()[0]),n.addTrack(r.getVideoTracks()[0]),n.isPlaying()&&(n.stop(),n.elementID&&n.play(n.elementID)),n.cameraId=e,t&&t())}catch(e){return i&&i(e)}},function(e){return i&&i(e)})},n._switchAudioDevice=function(e,t,i){if(e===n.microphoneId)return t&&t();!0===n.constraints.audio?n.constraints.audio={deviceId:{exact:e}}:n.constraints.audio.deviceId={exact:e},d.default.debug(n.constraints);var r=Object.assign({},n.constraints);(0,a.GetUserMedia)(r,function(r){try{(0,u.isSafari)()&&"11"===(0,u.getBrowserVersion)()?n.replaceTrack(r.getAudioTracks()[0],t,i):(n.removeTrack(n.stream.getAudioTracks()[0]),n.addTrack(r.getAudioTracks()[0]),n.isPlaying()&&(n.stop(),n.elementID&&n.play(n.elementID)),n.microphoneId=e,t&&t())}catch(e){return i&&i(e)}},function(e){return i&&i(e)})},n.switchDevice=function(e,t,i,r){var o=function(){return n.inSwitchDevice=!1,i&&i()},a=function(e){n.inSwitchDevice=!1,r&&"function"==typeof r?r(e):d.default.error(e)};return n.inSwitchDevice?r&&r("Device switch is in process."):(n.inSwitchDevice=!0,n.local?n.screen&&"video"===e?a("The device cannot be switched during screen-sharing."):n.videoSource||n.audioSource?a("The device cannot be switched when using videoSource or audioSource."):n.lowStream?a("The device cannot be switched when using lowstream."):n.audioMixing.state!==n.audioMixing.states.UNINIT&&n.audioMixing.state!==n.audioMixing.states.IDLE?a("The device cannot be switched when using audio Mixing."):void g.deviceManager.getDeviceById(t,function(){if("video"===e)n._switchVideoDevice(t,o,a);else{if("audio"!==e)return a("Invalid type.");n._switchAudioDevice(t,o,a)}},function(){return a("The device does not exist.")}):a("Only the local stream can switch the device."))},n};t.Stream=m,t.createStream=function(e){return d.default.debug("Create stream"),m(e)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.deviceManager=void 0;var r=n(1),o=i(n(0)),a=i(n(3)),s=new function(){var e=(0,r.EventDispatcher)();return e.devicesHistory={},e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.deviceStates={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},e.deviceReloadTimer=null,e._init=function(t,n){e.state=e.states.INITING,e.devicesHistory={},e._reloadDevicesInfo(function(){e.state=e.states.INITED,e.dispatchEvent({type:"inited"}),t&&t()},function(t){o.default.warning("Device Detection functionality cannot start properly."),e.state=e.states.UNINIT,n&&n(t)})},e._enumerateDevices=function(e,t){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return o.default.warning("enumerateDevices() not supported."),t&&t("enumerateDevices() not supported");navigator.mediaDevices.enumerateDevices().then(function(t){e&&setTimeout(function(){e(t)},0)}).catch(function(e){t&&t(e)})},e._reloadDevicesInfo=function(t,n){var i=[];e._enumerateDevices(function(n){var r=Date.now();for(var a in n.forEach(function(t){var n=e.devicesHistory[t.deviceId];if((n?n.state:e.deviceStates.INACTIVE)!=e.deviceStates.ACTIVE){var o=n||{initAt:r};o.device=t,o.state=e.deviceStates.ACTIVE,i.push(o),e.devicesHistory[t.deviceId]=o}e.devicesHistory[t.deviceId].lastReloadAt=r}),e.devicesHistory){var s=e.devicesHistory[a];s&&s.state==e.deviceStates.ACTIVE&&s.lastReloadAt!==r&&(s.state=e.deviceStates.INACTIVE,i.push(s)),s.lastReloadAt=r}e.state==e.states.INITED&&i.forEach(function(t){var n=Object.assign({},t);switch(t.device.kind){case"audioinput":n.type="recordingDeviceChanged";break;case"audiooutput":n.type="playoutDeviceChanged";break;case"videoinput":n.type="cameraChanged";break;default:o.default.warning("Unknown device change",n),n.type="unknownDeviceChanged"}e.dispatchEvent(n)}),t&&t()},n)},e.getDeviceById=function(t,n,i){e.getDevices(function(e){for(var r=0;r<e.length;r++){var o=e[r];if(o&&o.deviceId===t)return n&&n(o)}return i&&i()})},e.getDevices=function(t,n){e._enumerateDevices(t,function(e){n&&n(e.name+": "+e.message)})},e.getVideoCameraIdByLabel=function(t,n,i){e.getCameras(function(e){var r=!0,o=!1,s=void 0;try{for(var d,u=e[Symbol.iterator]();!(r=(d=u.next()).done);r=!0){var c=d.value;if(c.label===t)return n&&n(c.deviceId)}}catch(e){o=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw s}}return i&&i(a.default.NOT_FIND_DEVICE_BY_LABEL)},i)},e.getRecordingDevices=function(t,n){return e._enumerateDevices(function(e){var n=e.filter(function(e){return"audioinput"==e.kind});t&&t(n)},function(e){n&&n(e)})},e.getPlayoutDevices=function(t,n){return e._enumerateDevices(function(e){var n=e.filter(function(e){return"audiooutput"==e.kind});t&&t(n)},function(e){n&&n(e)})},e.getCameras=function(t,n){return e._enumerateDevices(function(e){var n=e.filter(function(e){return"videoinput"==e.kind});t&&t(n)},function(e){n&&n(e)})},e._init(function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",function(){e._reloadDevicesInfo()}),e.deviceReloadTimer=setInterval(e._reloadDevicesInfo,5e3)}),e};t.deviceManager=s},function(e,t,n){var i=n(20),r=n(21);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||r(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=window.AudioContext||window.webkitAudioContext;t.createAudioContext=function(){if(i)return new i;throw new Error("AUDIO_CONTEXT_NOT_SUPPORTED")},t.checkAudioContext=function(){return!!i}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.GetUserMedia=t.Connection=void 0;var r=i(n(24)),o=i(n(25)),a=i(n(26)),s=i(n(27)),d=i(n(28)),u=i(n(0)),c=i(n(29)),l=n(3),f=103;t.Connection=function(e){var t={};if(e.session_id=f+=1,"undefined"!=typeof window&&window.navigator)if(null!==window.navigator.userAgent.match("Firefox"))t.browser="mozilla",t=(0,d.default)(e);else if(window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome"))u.default.debug("Safari"),(t=(0,a.default)(e)).browser="safari";else if(window.navigator.userAgent.indexOf("MSIE "))(t=(0,o.default)(e)).browser="ie";else if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]>=26)(t=(0,o.default)(e)).browser="chrome-stable";else{if(!(window.navigator.userAgent.toLowerCase().indexOf("chrome")>=40))throw t.browser="none","WebRTC stack not available";(t=(0,r.default)(e)).browser="chrome-canary"}else u.default.error("Publish/subscribe video/audio streams not supported yet"),t=(0,s.default)(e);return t},t.GetUserMedia=function(e,t,n){if(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.screen){var i=null;try{i=window.require("electron")}catch(e){}if(i)return void(i.desktopCapturer?new c.default(e,t,n).shareScreen(i):n(l.ErrorCodes.ELECTRON_NOT_SUPPORT_SHARING_SCREEN));if(u.default.debug("Screen access requested"),null!==window.navigator.userAgent.match("Firefox")){if(!~["screen","window","application"].indexOf(e.mediaSource))return n&&n("Invalid mediaSource, mediaSource should be one of [screen, window, application]");if(!e.attributes)return n&&n("Share screen attributes is null");var r={};r.video={frameRate:{ideal:e.attributes.mxaFr,max:e.attributes.mxaFr},height:{ideal:e.attributes.height},width:{ideal:e.attributes.width},mediaSource:e.mediaSource},navigator.getMedia(r,t,n)}else if(null!==window.navigator.userAgent.match("Chrome")){if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<34)return void n({code:"This browser does not support screen sharing"});var o="okeephmleflklcdebijnponpabbmmgeo";e.extensionId&&(u.default.debug("extensionId supplied, using "+e.extensionId),o=e.extensionId),u.default.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(o,{getStream:!0},function(i){if(void 0===i)return u.default.debug("Access to screen denied"),void n({code:"Access to screen denied"});r={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i.streamId,maxHeight:e.attributes.height,maxWidth:e.attributes.width,maxFrameRate:e.attributes.maxFr,minFrameRate:e.attributes.minFr}}},navigator.getMedia(r,t,n)})}catch(e){return u.default.debug("AgoraRTC screensharing plugin is not accessible"),void n({code:"no_plugin_present"})}}else u.default.debug("This browser does not support screenSharing")}else window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?navigator.mediaDevices.getUserMedia(e).then(t).catch(n):"undefined"!=typeof navigator&&navigator.getMedia?navigator.getMedia(e,t,n):u.default.error("Video/audio streams not supported yet")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeStatsFilter=t.publishStatsFilter=t.setStat=void 0,n(0);var i=function(e,t,n){if(["End2EndDelay","TransportDelay","PacketLossRate","RecvLevel","RecvBitrate","CodecType","MuteState","RecordingLevel","SendLevel","SamplingRate","SendBitrate","CodecType","MuteState","End2EndDelay","TransportDelay","PacketLossRate","RecvBitrate","RecvResolutionWidth","RecvResolutionHeight","RenderFrameRate","TargetSendBitrate","SendFrameRate","SendFrameRate","SendBitrate","SendResolutionWidth","SendResolutionHeight","EncodeDelay","MuteState","RTT","accessDelay","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendPacketsLost","videoSendFrameRate","audioSendPacketsLost","videoSendResolutionWidth","videoSendResolutionHeight","accessDelay","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveResolutionWidth","videoReceiveResolutionHeight","endToEndDelay","videoReceiveDelay","audioReceiveDelay"].indexOf(t)>-1&&("string"==typeof n||isFinite(n)))return e[t]=""+n};t.setStat=i,t.publishStatsFilter=function(e){var t={};return e.forEach(function(e){e.id&&(-1===e.id.indexOf("send")&&-1===e.id.indexOf("outbound_rtp")&&-1===e.id.indexOf("OutboundRTP")||("audio"===e.mediaType?(i(t,"audioSendBytes",e.bytesSent),i(t,"audioSendPackets",e.packetsSent),i(t,"audioSendPacketsLost",e.packetsLost)):(i(t,"videoSendBytes",e.bytesSent),i(t,"videoSendPackets",e.packetsSent),i(t,"videoSendPacketsLost",e.packetsLost),i(t,"videoSendFrameRate",e.googFrameRateSent),i(t,"videoSendResolutionWidth",e.googFrameWidthSent),i(t,"videoSendResolutionHeight",e.googFrameHeightSent))))}),t},t.subscribeStatsFilter=function(e){var t={};return e.forEach(function(e){e.id&&(-1===e.id.indexOf("recv")&&-1===e.id.indexOf("inbound_rtp")&&-1===e.id.indexOf("InboundRTP")||("audio"===e.mediaType?(i(t,"audioReceiveBytes",e.bytesReceived),i(t,"audioReceivePackets",e.packetsReceived),i(t,"audioReceivePacketsLost",e.packetsLost)):(i(t,"videoReceiveBytes",e.bytesReceived),i(t,"videoReceivePacketsLost",e.packetsLost),i(t,"videoReceivePackets",e.packetsReceived),i(t,"videoReceiveFrameRate",e.googFrameRateReceived),i(t,"videoReceiveDecodeFrameRate",e.googFrameRateDecoded),i(t,"videoReceiveResolutionWidth",e.googFrameWidthReceived),i(t,"videoReceiveResolutionHeight",e.googFrameHeightReceived))))}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AUDIO_SAMPLE_RATE_32000=32e3,t.AUDIO_SAMPLE_RATE_44100=44100,t.AUDIO_SAMPLE_RATE_48000=48e3,t.VIDEO_CODEC_PROFILE_BASELINE=66,t.VIDEO_CODEC_PROFILE_MAIN=77,t.VIDEO_CODEC_PROFILE_HIGH=100,t.REMOTE_VIDEO_STREAM_HIGH=0,t.REMOTE_VIDEO_STREAM_LOW=1,t.REMOTE_VIDEO_STREAM_MEDIUM=2,t.CLIENT_MODE_LIVE="live",t.CLIENT_MODE_RTC="rtc",t.CLIENT_MODE_WEB="web",t.CLIENT_MODE_INTEROP="interop",t.CLIENT_MODE_H264_INTEROP="h264_interop",t.CLIENT_MODE_WEBONLY="web-only",t.CLIENT_MODES=["live","rtc","web","interop","h264_interop","web-only"],t.CLIENT_CODEC_VP8="vp8",t.CLIENT_CODEC_H264="h264",t.CLIENT_CODECS=["vp8","h264"],t.ENCRYPTION_MODES=["aes-128-xts","aes-256-xts","aes-128-ecb"],t.ENCRYPTION_MODE_AES128XTS="aes-128-xts",t.ENCRYPTION_MODE_AES256XTS="aes-256-xts",t.ENCRYPTION_MODE_AES128ECB="aes-128-ecb",t.ENCRYPTION_MODE_NONE="none"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e&&e.apply(this,[].slice.call(arguments,1))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGatewayList=void 0;var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(2)),r=n(0),o=r&&r.__esModule?r:{default:r},a=n(8),s=n(4),d=n(3),u=function(e,t,n,i){var r=(new Date).getTime(),u="";t.multiIP&&t.multiIP.gateway_ip&&(u={vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]});var c={flag:4,ts:+new Date,key:t.appId,cname:t.cname,detail:{},uid:t.uid||0};u&&(c.detail[5]=JSON.stringify(u)),(0,a.post)(e,c,function(a){try{var u=JSON.parse(a).res,c=u.code}catch(e){var l="requestChooseServer failed with unexpected body "+a;return o.default.error(l),i(l)}if(c)return s.report.joinChooseServer(t.sid,{lts:r,succ:!1,csAddr:e,serverList:null,ec:p=d.APErrorCode[u.code]||c}),i("Get server node failed ["+p+"]",e,p);var f,p,h=[];return f=u.detail&&"CN"==u.detail[3]?".agoraio.cn":".agora.io",u.addresses.forEach(function(e){var t;e.ip&&e.port?(e.ip.match(/^[\.\:\d]+$/)?t="webrtc-"+e.ip.replace(/[^\d]/g,"-")+f+":"+e.port:(o.default.info("Cannot recognized as IP address "+e.ip+". Used As Host instead"),t=e.ip+":"+e.port),h.push(t)):o.default.error("Invalid address format ",e)}),h.length?n({gateway_addr:h,uid:u.uid,cid:u.cid,uni_lbs_ip:u.detail},e):(o.default.error("Empty Address response",u),s.report.joinChooseServer(t.sid,{lts:r,succ:!1,csAddr:e,serverList:null,ec:p="EMPTY_ADDRESS_RESPONSE"}),i("Get server node failed ["+p+"]",e,p))},function(e,n){"timeout"===e.type?(s.report.joinChooseServer(t.sid,{lts:r,succ:!1,csAddr:n,serverList:null,ec:"timeout"}),i("Connect choose server timeout",n)):s.report.joinChooseServer(t.sid,{lts:r,succ:!1,csAddr:n,serverList:null,ec:"server_wrong"})},{"X-Packet-Service-Type":0,"X-Packet-URI":44})},c=function(e,t,n){for(var r=(new Date).getTime(),a=!1,c=!0,l=function(n,i){if(a)s.report.joinChooseServer(e.sid,{lts:r,succ:!0,csAddr:i,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null},!1);else{if(clearTimeout(_),a=!0,o.default.debug("Get gateway address:",n.gateway_addr),e.proxyServer){for(var d=n.gateway_addr,u=0;u<d.length;u++){var c=d[u].split(":");n.gateway_addr[u]=e.proxyServer+"/ws/?h="+c[0]+"&p="+c[1]}o.default.debug("Get gateway address:",n.gateway_addr)}t(n),s.report.joinChooseServer(e.sid,{lts:r,succ:!0,csAddr:i,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null},!0)}},f=function(e,t,i){c&&(o.default.error(e,t,i),i&&!d.JOIN_CS_RETRY_LIST.includes(i)&&(c=!1,n(i)))},p=i.WEBCS_DOMAIN,h=0;h<p.length;++h){var g;if("string"==typeof p[h]){var m=p[h];o.default.debug("Connect to choose_server: "+(g=e.proxyServer?"https://"+e.proxyServer+"/ap/?url="+m+"/api/v1":"https://"+m+"/api/v1")),u(g,e,l,f)}else o.default.error("Invalid Host",p[h])}var _=setTimeout(function(){if(!a)for(var t=i.WEBCS_DOMAIN_BACKUP_LIST,n=0;n<t.length;++n)if("string"==typeof t[n]){var r=t[n];o.default.debug("Connect to backup_choose_server: "+(g=e.proxyServer?"https://"+e.proxyServer+"/ap/?url="+r+"/api/v1":"https://"+r+"/api/v1")),u(g,e,l,f)}else o.default.error("Invalid Host",t[n])},1e3);setTimeout(function(){!a&&c&&n()},i.WEBCS_BACKUP_CONNECT_TIMEOUT)};t.getGatewayList=function(e,t,n){var i=!1,r=null,a=1;!function n(){i||c(e,function(e){i=!0,clearTimeout(r),t(e)},function(e){e?o.default.info("Join failed: "+e):(o.default.debug("Request gateway list will be restart in "+a+"s"),r=setTimeout(function(){n()},1e3*a),a=a>=3600?3600:2*a)})}()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0),o=r&&r.__esModule?r:{default:r},a=n(7),s=n(9),d=n(10),u=n(15),c=n(30);t.default={TranscodingUser:c.TranscodingUser,LiveTranscoding:c.LiveTranscoding,createClient:c.createClient,createStream:s.createStream,Logger:o.default,getDevices:d.deviceManager.getDevices,checkSystemRequirements:a.checkSystemRequirements,VERSION:i.VERSION,BUILD:i.BUILD,AUDIO_SAMPLE_RATE_32000:u.AUDIO_SAMPLE_RATE_32000,AUDIO_SAMPLE_RATE_44100:u.AUDIO_SAMPLE_RATE_44100,AUDIO_SAMPLE_RATE_48000:u.AUDIO_SAMPLE_RATE_48000,VIDEO_CODEC_PROFILE_BASELINE:u.VIDEO_CODEC_PROFILE_BASELINE,VIDEO_CODEC_PROFILE_MAIN:u.VIDEO_CODEC_PROFILE_MAIN,VIDEO_CODEC_PROFILE_HIGH:u.VIDEO_CODEC_PROFILE_HIGH,REMOTE_VIDEO_STREAM_HIGH:u.REMOTE_VIDEO_STREAM_HIGH,REMOTE_VIDEO_STREAM_LOW:u.REMOTE_VIDEO_STREAM_LOW,REMOTE_VIDEO_STREAM_MEDIUM:u.REMOTE_VIDEO_STREAM_MEDIUM}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTimestamp=function(){var e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0;return[n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]]].join("")}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(5)),o=i(n(23)),a=i(n(0)),s=n(6),d=i(n(3));t.default=function(e){var t=(0,o.default)({});if(t.id=e.id,t.fit=e.options&&e.options.fit,"contain"!==t.fit&&"cover"!==t.fit&&(t.fit=null),t.url=e.url,t.stream=e.stream.stream,t.elementID=e.elementID,t.setAudioOutput=function(e,n,i){var r=t.video||t.audio;return r?r.setSinkId?void r.setSinkId(e).then(function(){return a.default.debug("video "+t.id+" setAudioOutput "+e+" SUCCESS"),r==t.video&&t.audio?t.audio.setSinkId(e):Promise.resolve()}).then(function(){return a.default.debug("audio "+t.id+" setAudioOutput "+e+" SUCCESS"),n&&n()}).catch(function(e){return a.default.error("VideoPlayer.setAudioOutput",e),i&&i(e)}):(a.default.error(d.default.WEB_API_NOT_SUPPORTED),i&&i(d.default.WEB_API_NOT_SUPPORTED)):(a.default.error(d.default.PLAYER_NOT_FOUND),i&&i(d.default.PLAYER_NOT_FOUND))},t.destroy=function(){(0,s.setSrcObject)(t.video,null),(0,s.setSrcObject)(t.audio,null),t.video.pause(),delete t.resizer,document.getElementById(t.div.id)&&t.parentNode.contains(t.div)&&t.parentNode.removeChild(t.div)},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),t.div.setAttribute("style",e.stream.video?"width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;":"width: 100%; height: 100%; position: relative; overflow: hidden;"),t.video=document.createElement("video"),t.video.setAttribute("id","video"+t.id),e.stream.local&&!e.stream.screen?t.video.setAttribute("style",e.stream.mirror?"width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: "+(t.fit||"cover")+";":"width: 100%; height: 100%; position: absolute; object-fit: "+(t.fit||"cover")+";"):e.stream.video?(t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: "+(t.fit||"cover")+";"),window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")&&t.video.setAttribute("controls","")):t.video.setAttribute("style",e.stream.screen?"width: 100%; height: 100%; position: absolute; object-fit: "+(t.fit||"contain"):"width: 100%; height: 100%; position: absolute; display: none; object-fit: "+(t.fit||"cover")),t.video.setAttribute("autoplay",""),t.video.setAttribute("muted",""),t.video.setAttribute("playsinline",""),e.stream.local&&(t.video.volume=0,t.video.setAttribute("muted","")),t.audio=document.createElement("audio"),t.audio.setAttribute("id","audio"+t.id),t.audio.setAttribute("autoplay",""),e.stream.local&&(t.audio.volume=0,t.audio.setAttribute("muted","")),void 0!==t.elementID?(document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID)):(document.body.appendChild(t.div),t.container=document.body),t.parentNode=t.div.parentNode,t.video.addEventListener("playing",function(e){!function e(){t.video.videoWidth*t.video.videoHeight>4?a.default.debug("video dimensions:",t.video.videoWidth,t.video.videoHeight):setTimeout(e,50)}()}),e.stream.hasVideo()||e.stream.hasScreen())t.div.appendChild(t.video),t.div.appendChild(t.audio),(0,s.attachMediaStream)(t.video,e.stream.stream),(0,s.attachMediaStream)(t.audio,e.stream.stream);else if(!e.stream.local&&t.video.removeAttribute("muted"),t.div.appendChild(t.video),window.MediaStream&&r.isSafari()){var n=new MediaStream(e.stream.stream.getAudioTracks());(0,s.setSrcObject)(t.video,n)}else(0,s.setSrcObject)(t.video,e.stream.stream);return t.setAudioVolume=function(e){var n=parseInt(e)/100;isFinite(n)&&(n<0?n=0:n>1&&(n=1),t.video&&(t.video.volume=n),t.audio&&(t.audio.volume=n))},t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.default=function(e){var t=(0,i.EventDispatcher)(e);return t.url=".",t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=i&&i.__esModule?i:{default:i},o=(n(6),function(e){var t={},n=webkitRTCPeerConnection;t.pc_config={iceServers:[]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map(function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})}):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&(e.turnServer instanceof Array?e.turnServer.map(function(e){"string"==typeof e.url&&""!==e.url&&t.pc_config.iceServers.push({username:e.username,credential:e.password,url:e.url})}):"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.password,url:e.turnServer.url}))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103,t.peerConnection=new n(t.pc_config,t.con),t.peerConnection.onicecandidate=function(e){e.candidate?t.iceCandidateCount+=1:(r.default.debug("PeerConnection State: "+t.peerConnection.iceGatheringState),void 0===t.ices&&(t.ices=0),t.ices=t.ices+1,t.ices>=1&&t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded()))};var i=function(t){var n;return e.minVideoBW&&e.maxVideoBW&&(n=t.match(/m=video.*\r\n/),t=t.replace(n[0],n[0]+"b=AS:"+e.maxVideoBW+"\r\n"),r.default.debug("Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)),e.maxAudioBW&&(n=t.match(/m=audio.*\r\n/),t=t.replace(n[0],n[0]+"b=AS:"+e.maxAudioBW+"\r\n")),t};return t.processSignalingMessage=function(e){var n,r=JSON.parse(e);t.incomingMessage=r,"new"===t.state?"OFFER"===r.messageType?(n={sdp:r.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===r.messageType?((n={sdp:r.sdp,type:"answer"}).sdp=i(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.sendOK(),t.state="established"):"pr-answer"===r.messageType?(n={sdp:r.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):t.error("offer"===r.messageType?"Not written yet":"Illegal message for this state: "+r.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===r.messageType?(n={sdp:r.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state))},t.addStream=function(e){t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater(function(){t.onstablestate()})},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){if(t.actionNeeded){if("new"===t.state||"established"===t.state)t.peerConnection.createOffer(function(e){if(e.sdp=i(e.sdp),r.default.debug("Changed",e.sdp),e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();r.default.debug("Not sending a new offer")},function(e){r.default.debug("peer connection create offer failed ",e)},t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer(function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;r.default.debug(n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}},function(e){r.default.debug("peer connection create answer failed ",e)},t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;t.sendMessage("ANSWER",t.peerConnection.localDescription.sdp),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find(function(t){return t.track.kind==e});if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var r=t._getSender(e.kind);if(!r)return i("NO_SENDER_FOUND");try{r.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout(function(){return n&&n()},50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.onopen=function(){t.onopen&&t.onopen()},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t});t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=i&&i.__esModule?i:{default:i},o=n(6);t.default=function(e){var t={},n=o.RTCPeerConnection;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isSubscriber=e.isSubscriber,t.pc_config={iceServers:[{url:"stun:webcs.agora.io:3478"}]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map(function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})}):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&(e.turnServer instanceof Array?e.turnServer.map(function(e){"string"==typeof e.url&&""!==e.url&&t.pc_config.iceServers.push({username:e.username,credential:e.password,url:e.url})}):"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103,t.peerConnection=new n(t.pc_config,t.con),t.peerConnection.onicecandidate=function(e){var n,i,o,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout(function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())},1e3)),null===i&&null===o&&null===a||void 0!==t.ice||(r.default.debug("srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+o),clearTimeout(t.timeout),t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1},r.default.debug('Created webkitRTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".');var i=function(t){return e.screen&&(t=t.replace("a=x-google-flag:conference\r\n","")),t},a=function(t){var n;return e.minVideoBW&&e.maxVideoBW&&(n=t.match(/m=video.*\r\n/),t=t.replace(n[0],n[0]+"b=AS:"+e.maxVideoBW+"\r\n"),r.default.debug("Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)),e.maxAudioBW&&(n=t.match(/m=audio.*\r\n/),t=t.replace(n[0],n[0]+"b=AS:"+e.maxAudioBW+"\r\n")),t};return t.processSignalingMessage=function(e){var n,r=JSON.parse(e);t.incomingMessage=r,"new"===t.state?"OFFER"===r.messageType?(n={sdp:r.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===r.messageType?((n={sdp:r.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=a(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.sendOK(),t.state="established"):"pr-answer"===r.messageType?(n={sdp:r.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):t.error("offer"===r.messageType?"Not written yet":"Illegal message for this state: "+r.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===r.messageType?(n={sdp:r.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):"ANSWER"===r.messageType?((n={sdp:r.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=a(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state))},t.getVideoRelatedStats=function(e){t.peerConnection.getStats(null,function(n){Object.keys(n).forEach(function(i){var r=n[i];t.isSubscriber?"video"===r.mediaType&&r.id&&~r.id.indexOf("recv")&&e&&e({mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:r.googFrameRateReceived,frameRateDecoded:r.googFrameRateDecoded}):"video"===r.mediaType&&r.id&&~r.id.indexOf("send")&&e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:r.googFrameRateInput,frameRateSent:r.googFrameRateSent})})})},t.getStatsRate=function(e){t.getStats(function(t){e(t)})},t.getStats=function(e){t.peerConnection.getStats(null,function(n){var i=[],r=[],o=null;Object.keys(n).forEach(function(e){var t=n[e];r.push(t),"ssrc"!==t.type&&"VideoBwe"!==t.type||(o=t.timestamp,i.push(t))}),i.push({id:"time",startTime:t.connectedTime,timestamp:o||new Date}),e(i,r)})},t.addTrack=function(e,n){t.peerConnection.addTrack(e,n)},t.removeTrack=function(e,n){t.peerConnection.removeTrack(t.peerConnection.getSenders().find(function(t){return t.track==e}))},t.addStream=function(e){t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater(function(){t.onstablestate()})},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){if(t.actionNeeded){if("new"===t.state||"established"===t.state)t.peerConnection.createOffer(function(e){if(e.sdp=a(e.sdp),e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();r.default.debug("Not sending a new offer")},function(e){r.default.debug("peer connection create offer failed ",e)},t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer(function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;r.default.debug(n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}},function(e){r.default.debug("peer connection create answer failed ",e)},t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;t.sendMessage("ANSWER",t.peerConnection.localDescription.sdp),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find(function(t){return t.track.kind==e});if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var r=t._getSender(e.kind);if(!r)return i("NO_SENDER_FOUND");try{r.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout(function(){return n&&n()},50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&(t.onaddstream(e,"ontrack"),t.peerConnection.onaddstream=null)},t.peerConnection.onaddstream=function(e){t.onaddstream&&(t.onaddstream(e,"onaddstream"),t.peerConnection.ontrack=null)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.peerConnection.onnegotiationneeded=function(){void 0!==t.prevOffer&&t.peerConnection.createOffer().then(function(e){return e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),t.peerConnection.setLocalDescription(e)}).then(function(){t.onnegotiationneeded&&t.onnegotiationneeded(t.peerConnection.localDescription.sdp)}).catch(function(e){console.log("createOffer error: ",e)})},t.onaddstream=null,t.onremovestream=null,t.onnegotiationneeded=null,t.state="new",t.markActionNeeded(),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=i&&i.__esModule?i:{default:i},o=n(6);t.default=function(e){var t={};t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isSubscriber=e.isSubscriber,t.pc_config={iceServers:[{urls:["stun:webcs.agora.io:3478","stun:stun.l.google.com:19302"]}],bundlePolicy:"max-bundle"},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map(function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})}):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&(e.turnServer instanceof Array?e.turnServer.map(function(e){"string"==typeof e.url&&""!==e.url&&t.pc_config.iceServers.push({username:e.username,credential:e.password,url:e.url})}):"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:["turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"]}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:["turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"]}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103,t.peerConnection=new o.RTCPeerConnection(t.pc_config),r.default.debug('safari Created RTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.peerConnection.onicecandidate=function(e){var n,i,o,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout(function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())},1e3)),null===i&&null===o&&null===a||void 0!==t.ice||(r.default.debug("srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+o),clearTimeout(t.timeout),t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1};var n=function(t){return e.screen&&(t=t.replace("a=x-google-flag:conference\r\n","")),t},i=function(t){var n;return e.minVideoBW&&e.maxVideoBW&&(n=t.match(/m=video.*\r\n/),t=t.replace(n[0],n[0]+"b=AS:"+e.maxVideoBW+"\r\n"),r.default.debug("Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)),e.maxAudioBW&&(n=t.match(/m=audio.*\r\n/),t=t.replace(n[0],n[0]+"b=AS:"+e.maxAudioBW+"\r\n")),t};t.processSignalingMessage=function(e){var r,o=JSON.parse(e);t.incomingMessage=o,"new"===t.state?"OFFER"===o.messageType?(r={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===o.messageType?((r={sdp:o.sdp,type:"answer"}).sdp=n(r.sdp),r.sdp=i(r.sdp),r.sdp=r.sdp.replace(/a=x-google-flag:conference\r\n/g,""),t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.sendOK(),t.state="established"):"pr-answer"===o.messageType?(r={sdp:o.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r))):t.error("offer"===o.messageType?"Not written yet":"Illegal message for this state: "+o.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===o.messageType?(r={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.state="offer-received",t.markActionNeeded()):"ANSWER"===o.messageType?((r={sdp:o.sdp,type:"answer"}).sdp=n(r.sdp),r.sdp=i(r.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(r))):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state))};var a={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},s={id:"",type:"",mediaType:"",googCodecName:"h264"===e.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},d={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},u={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},c={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},l=0,f=0,p=0;return t.getVideoRelatedStats=function(n){t.peerConnection.getStats().then(function(i){i.forEach(function(i){if(t.isSubscriber){if("track"===i.type&&~i.id.indexOf("video")){if(!t.lastReport)return void(t.lastReport=i);n&&n({peerId:t.uid,mediaType:"video",isVideoMute:t.isVideoMute,frameRateReceived:i.framesReceived-t.lastReport.framesReceived+"",frameRateDecoded:i.framesDecoded-t.lastReport.framesDecoded+""}),t.lastReport=i}}else if("outbound-rtp"===i.type&&"video"===i.mediaType){if(!t.lastReport)return void(t.lastReport=i);n&&n({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:e.maxFrameRate+"",frameRateSent:i.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=i}})})},t.getStatsRate=function(e){t.getStats(function(t){t.forEach(function(e){"outbound-rtp"===e.type&&"video"===e.mediaType&&e.googFramesEncoded&&(e.googFrameRateSent=((e.googFramesEncoded-l)/3).toString(),l=e.googFramesEncoded),"inbound-rtp"===e.type&&-1!=e.id.indexOf("55543")&&(e.googFrameRateReceived&&(e.googFrameRateReceived=((e.googFrameReceived-p)/3).toString(),p=e.googFrameReceived),e.googFrameRateDecoded&&(e.googFrameRateDecoded=((e.googFramesDecoded-f)/3).toString(),f=e.googFramesDecoded))}),e(t)})},t.getStats=function(e){var n=[];t.peerConnection.getStats().then(function(i){i.forEach(function(e){n.push(e),"outbound-rtp"===e.type&&"audio"===e.mediaType&&(a.id=e.id,a.type=e.type,a.mediaType=e.mediaType,a.bytesSent=e.bytesSent?e.bytesSent+"":"0",a.packetsSent=e.packetsSent?e.packetsSent+"":"0"),"outbound-rtp"===e.type&&"video"===e.mediaType&&(s.id=e.id,s.type=e.type,s.mediaType=e.mediaType,s.bytesSent=e.bytesSent?e.bytesSent+"":"0",s.packetsSent=e.packetsSent?e.packetsSent+"":"0",s.googPlisReceived=e.pliCount?e.pliCount+"":"0",s.googNacksReceived=e.nackCount?e.nackCount+"":"0",s.googFirsReceived=e.firCount?e.firCount+"":"0",s.googFramesEncoded=e.framesEncoded?e.framesEncoded+"":"0"),"inbound-rtp"===e.type&&-1!=e.id.indexOf("44444")&&(d.id=e.id,d.type=e.type,d.mediaType="audio",d.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",d.bytesReceived=e.bytesReceived?e.bytesReceived+"":"0",d.packetsLost=e.packetsLost?e.packetsLost+"":"0",d.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",d.googJitterReceived=e.jitter?e.jitter+"":"0"),"inbound-rtp"===e.type&&-1!=e.id.indexOf("55543")&&(u.id=e.id,u.type=e.type,u.mediaType="video",u.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",u.bytesReceived=e.bytesReceived?e.bytesReceived+"":"0",u.packetsLost=e.packetsLost?e.packetsLost+"":"0",u.googJitterBufferMs=e.jitter?e.jitter+"":"0",u.googNacksSent=e.nackCount?e.nackCount+"":"0",u.googPlisSent=e.pliCount?e.pliCount+"":"0",u.googFirsSent=e.firCount?e.firCount+"":"0"),"track"===e.type&&-1!=e.id.indexOf("55543")&&(u.googFrameWidthReceived=e.frameWidth?e.frameWidth+"":"0",u.googFrameHeightReceived=e.frameHeight?e.frameHeight+"":"0",u.googFrameReceived=e.framesReceived?e.framesReceived+"":"0",u.googFramesDecoded=e.framesDecoded?e.framesDecoded+"":"0"),"track"===e.type&&-1!=e.id.indexOf("44444")&&(d.audioOutputLevel=e.audioLevel+"",a.audioInputLevel=e.audioLevel+""),"candidate-pair"===e.type&&(0==e.availableIncomingBitrate?c.googAvailableSendBandwidth=e.availableOutgoingBitrate+"":c.googAvailableReceiveBandwidth=e.availableIncomingBitrate+"")});var r=[c,a,s,d,u];r.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),e(r,n)}).catch(function(e){console.error(e)})},t.addTrack=function(e,n){t.peerConnection.addTrack(e,n)},t.removeTrack=function(e,n){var i=t.peerConnection.getSenders().find(function(t){return t.track==e});i.replaceTrack(null),t.peerConnection.removeTrack(i)},t.addStream=function(e){window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?e.getTracks().forEach(function(n){return t.peerConnection.addTrack(n,e)}):t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater(function(){t.onstablestate()})},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){if(t.actionNeeded){if("new"===t.state||"established"===t.state){if(e.isSubscriber&&window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")){var n=t.peerConnection.addTransceiver("audio"),o=t.peerConnection.addTransceiver("video");n.setDirection("recvonly"),o.setDirection("recvonly")}t.peerConnection.createOffer(t.mediaConstraints).then(function(n){if(n.sdp=i(n.sdp),e.isSubscriber||(n.sdp=n.sdp.replace(/a=extmap:4 urn:3gpp:video-orientation\r\n/g,"")),n.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(n),t.state="preparing-offer",void t.markActionNeeded();r.default.debug("Not sending a new offer")}).catch(function(e){r.default.debug("peer connection create offer failed ",e)})}else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer(function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;r.default.debug(n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}},function(e){r.default.debug("peer connection create answer failed ",e)},t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;t.sendMessage("ANSWER",t.peerConnection.localDescription.sdp),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find(function(t){return t.track.kind==e});if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var r=t._getSender(e.kind);if(!r)return i("NO_SENDER_FOUND");try{r.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout(function(){return n&&n()},50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.peerConnection.onnegotiationneeded=function(){void 0!==t.prevOffer&&t.peerConnection.createOffer().then(function(e){return e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),t.peerConnection.setLocalDescription(e)}).then(function(){t.onnegotiationneeded&&t.onnegotiationneeded(t.peerConnection.localDescription.sdp)}).catch(function(e){console.log("createOffer error: ",e)})},t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{addStream:function(){}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=i&&i.__esModule?i:{default:i},o=n(6);t.default=function(e){var t={},n=(mozRTCPeerConnection,mozRTCSessionDescription),i=!1;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isSubscriber=e.isSubscriber,t.pc_config={iceServers:[]},e.iceServers instanceof Array?e.iceServers.map(function(e){0===e.url.indexOf("stun:")&&t.pc_config.iceServers.push({url:e.url})}):(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map(function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})}):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay"))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,mozDontOfferDataChannel:!0},t.roapSessionId=103,t.peerConnection=new o.RTCPeerConnection(t.pc_config),r.default.debug('safari Created RTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.peerConnection.onicecandidate=function(e){var n,i,o,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout(function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())},1e3)),null===i&&null===o&&null===a||void 0!==t.ice||(r.default.debug("srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+o),clearTimeout(t.timeout),t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1},t.checkMLineReverseInSDP=function(e){return!(!~e.indexOf("m=audio")||!~e.indexOf("m=video"))&&e.indexOf("m=audio")>e.indexOf("m=video")},t.reverseMLineInSDP=function(e){var t=e.split("m=audio"),n=t[1].split("m=video");return t[0]+"m=video"+n[1]+"m=audio"+n[0]},t.processSignalingMessage=function(e){var i=JSON.parse(e);t.incomingMessage=i,"new"===t.state?"OFFER"===i.messageType?(i.sdp=l(i.sdp),t.peerConnection.setRemoteDescription(new n({sdp:i.sdp,type:"offer"}),function(){r.default.debug("setRemoteDescription succeeded")},function(e){r.default.info("setRemoteDescription failed: "+e.name)}),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+i.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===i.messageType?(i.sdp=l(i.sdp),i.sdp=i.sdp.replace(/ generation 0/g,""),i.sdp=i.sdp.replace(/ udp /g," UDP "),i.sdp=i.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),i.sdp=i.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),i.sdp=i.sdp.replace(/a=mid:video/,"a=mid:sdparta_1"),t.isMLineReverseInSDP&&(i.sdp=t.reverseMLineInSDP(i.sdp)),t.peerConnection.setRemoteDescription(new n({sdp:i.sdp,type:"answer"}),function(){r.default.debug("setRemoteDescription succeeded")},function(e){r.default.info("setRemoteDescription failed: "+e)}),t.sendOK(),t.state="established"):"pr-answer"===i.messageType?t.peerConnection.setRemoteDescription(new n({sdp:i.sdp,type:"pr-answer"}),function(){r.default.debug("setRemoteDescription succeeded")},function(e){r.default.info("setRemoteDescription failed: "+e.name)}):t.error("offer"===i.messageType?"Not written yet":"Illegal message for this state: "+i.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===i.messageType?(t.peerConnection.setRemoteDescription(new n({sdp:i.sdp,type:"offer"}),function(){r.default.debug("setRemoteDescription succeeded")},function(e){r.default.info("setRemoteDescription failed: "+e.name)}),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+i.messageType+" in state "+t.state))};var a={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},s={id:"",type:"",mediaType:"",googCodecName:"h264"===e.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},d={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},u={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},c=0;t.getVideoRelatedStats=function(e){t.peerConnection.getStats().then(function(n){Object.keys(n).forEach(function(i){var r=n[i];if(t.isSubscriber){if("inboundrtp"===r.type&&"video"===r.mediaType){if(!t.lastReport)return void(t.lastReport=r);e&&e({browser:"firefox",mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:r.framerateMean+"",frameRateDecoded:r.framesDecoded-t.lastReport.framesDecoded+""}),t.lastReport=r}}else if("outboundrtp"===r.type&&"video"===r.mediaType){if(!t.lastReport)return void(t.lastReport=r);e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:r.framerateMean+"",frameRateSent:r.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=r}})})},t.getStatsRate=function(e){t.getStats(function(t){t.forEach(function(e){"inboundrtp"===e.type&&"video"===e.mediaType&&e.googFrameRateDecoded&&(e.googFrameRateDecoded=((e.googFramesDecoded-c)/3).toString(),c=e.googFramesDecoded)}),e(t)})},t.getStats=function(e){t.peerConnection.getStats().then(function(n){var i=[];Object.keys(n).forEach(function(e){var t=n[e];i.push(t),"outboundrtp"===t.type&&"video"===t.mediaType&&(s.id=t.id,s.type=t.type,s.mediaType=t.mediaType,s.bytesSent=t.bytesSent?t.bytesSent+"":"0",s.packetsSent=t.packetsSent?t.packetsSent+"":"0",s.googPlisReceived=t.pliCount?t.pliCount+"":"0",s.googNacksReceived=t.nackCount?t.nackCount+"":"0",s.googFirsReceived=t.firCount?t.firCount+"":"0",s.googFrameRateSent=t.framerateMean?t.framerateMean+"":"0"),"outboundrtp"===t.type&&"audio"===t.mediaType&&(a.id=t.id,a.type=t.type,a.mediaType=t.mediaType,a.bytesSent=t.bytesSent?t.bytesSent+"":"0",a.packetsSent=t.packetsSent?t.packetsSent+"":"0"),"inboundrtp"!==t.type||"audio"!==t.mediaType||t.isRemote||(d.id=t.id,d.type=t.type,d.mediaType=t.mediaType,d.bytesReceived=t.bytesReceived?t.bytesReceived+"":"0",d.packetsLost=t.packetsLost?t.packetsLost+"":"0",d.packetsReceived=t.packetsReceived?t.packetsReceived+"":"0",d.googJitterReceived=t.jitter?t.jitter+"":"0"),"inboundrtp"!==t.type||"video"!==t.mediaType||t.isRemote||(u.id=t.id,u.type=t.type,u.mediaType=t.mediaType,u.bytesReceived=t.bytesReceived?t.bytesReceived+"":"0",u.googFrameRateReceived=t.framerateMean?t.framerateMean+"":"0",u.googFramesDecoded=t.framesDecoded?t.framesDecoded+"":"0",u.packetsLost=t.packetsLost?t.packetsLost+"":"0",u.packetsReceived=t.packetsReceived?t.packetsReceived+"":"0",u.googJitterBufferMs=t.jitter?t.jitter+"":"0",u.googNacksSent=t.nackCount?t.nackCount+"":"0",u.googPlisSent=t.pliCount?t.pliCount+"":"0",u.googFirsSent=t.firCount?t.firCount+"":"0"),-1!==t.id.indexOf("outbound_rtcp_video")&&(s.packetsLost=t.packetsLost?t.packetsLost+"":"0")});var r=[s,a,d,u];r.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),e(r,i)},function(e){r.default.error(e)})},t.addStream=function(e){i=!0,t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater(function(){t.onstablestate()})},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){if(t.actionNeeded){if("new"===t.state||"established"===t.state)i&&(t.mediaConstraints=void 0),t.peerConnection.createOffer(function(e){if(e.sdp=l(e.sdp),e.sdp=e.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.isMLineReverseInSDP=t.checkMLineReverseInSDP(e.sdp),t.state="preparing-offer",void t.markActionNeeded();r.default.debug("Not sending a new offer")},function(e){r.default.debug("Ups! create offer failed ",e)},t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer(function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;r.default.debug(n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}},function(){r.default.debug("Ups! Something went wrong")});else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;t.sendMessage("ANSWER",t.peerConnection.localDescription.sdp),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find(function(t){return t.track.kind==e});if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var r=t._getSender(e.kind);if(!r)return i("NO_SENDER_FOUND");try{r.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout(function(){return n&&n()},50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var l=function(t){var n;return e.video&&e.maxVideoBW&&(null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0&&(t=t.replace(n[0],n[0]+"b=TIAS:"+1e3*e.maxVideoBW+"\r\n"))),e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0&&(t=t.replace(n[0],n[0]+"b=TIAS:"+1e3*e.maxAudioBW+"\r\n"))),t};return t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var i={};return i.callback=t,i.config=e,i.error=n,i.selectSource=function(e,t,n){var i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var r=document.createElement("div");r.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");var a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var s=document.createElement("div");s.setAttribute("style","text-align: right; padding: 16px 0;");var d=document.createElement("button");d.innerHTML="cancel",d.setAttribute("style","width: 85px;"),d.onclick=function(){document.body.removeChild(u),n&&n("NotAllowedError")},s.appendChild(d),r.appendChild(o),r.appendChild(a),r.appendChild(s);var u=document.createElement("div");u.setAttribute("style","position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),u.appendChild(i),u.appendChild(r),document.body.appendChild(u),e.map(function(e){if(e.id){var n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;"),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+e.thumbnail.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name+"</span>",n.onclick=function(){document.body.removeChild(u),t&&t(e.id)},a.appendChild(n)}})},i.getShareScreenStream=function(e){navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i.config.attributes.height,maxWidth:i.config.attributes.width,maxFrameRate:i.config.attributes.maxFr,minFrameRate:i.config.attributes.minFr}}},i.callback,i.error)},i.shareScreen=function(e){try{var t=window.require("electron_share_screen_ui")}catch(e){}t?t(function(e){i.getShareScreenStream(e)},i.error):e.desktopCapturer.getSources({types:["window","screen"]},function(e,t){if(e)throw e;i.selectSource(t,function(e){i.getShareScreenStream(e)},i.error)})},i}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.LiveTranscoding=t.TranscodingUser=t.createLiveClient=t.createRtcClient=t.createClient=void 0;var r=i(n(31)),o=i(n(0)),a=i(n(3)),s=n(7),d=n(17),u=n(4),c=n(5),l=n(35),f=n(9),p=n(10),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(2)),g=n(1),m=n(36),_=n(37),v=n(38),y=n(15),S=function(e){var t={key:void 0,highStream:null,lowStream:null,lowStreamParameter:null,isDualStream:!1,highStreamState:2,lowStreamState:2,proxyServer:null,turnServer:{}};return e=Object.assign({},e),t.aespassword=null,t.aesmode=y.ENCRYPTION_MODE_NONE,t.hasPublished=!1,t.renewToken=function(e,n,i){t.gatewayClient||(o.default.error("renewToken Failed. GatewayClient not Exist"),(0,s.safeCall)(i,a.default.INVALID_OPERATION)),t.key?(t.key=e,t.gatewayClient.renewToken(e,n,i)):(o.default.error("renewToken should not be called before user join"),(0,s.safeCall)(i,a.default.INVALID_OPERATION))},t.setLowStreamParameter=function(e){t.lowStreamParameter=e},t.init=function(t,n,i){if("string"!=typeof t)throw new Error("Param appId should be string");(0,c.isChromeKernel)()&&(0,c.getChromeKernelVersion)()<=48?i?i(a.default.BAD_ENVIRONMENT):(0,s.popBanTip)():(o.default.info("Initializing AgoraRTC client, appId: "+t+"."),e.appId=t,e.sessionId=(0,s.generateSessionId)(),n&&n())},t.setTurnServer=function(e,n,i){var r=e.turnServerURL,a=e.username,s=e.password,d=e.udpport,u=e.forceturn,c=e.tcpport;if(!r)throw new Error("Do not set the turnServerURL parameter as empty");if(!a)throw new Error("Do not set the username parameter as empty");if(!s)throw new Error("Do not set the password parameter as empty");if(!d)throw new Error("Do not set the udpport parameter as empty");t.turnServer.url=r,t.turnServer.udpport=d,t.turnServer.username=a,t.turnServer.credential=s,t.turnServer.forceturn=u||!1,c&&(t.turnServer.tcpport=c,o.default.info("Set turnserver tcpurl."+t.turnServer.url+":"+t.turnServer.tcpport)),o.default.info("Set turnserver udpurl."+t.turnServer.url+":"+t.turnServer.udpport+",username:"+t.turnServer.uername+",password:"+t.turnServer.credential)},t.setProxyServer=function(e){if(!e)throw new Error("Do not set the proxyServer parameter as empty");t.proxyServer=e,u.report.setProxyServer(e)},t.setEncryptionSecret=function(e){if(!e||"string"!=typeof e)throw new Error("Invalid secret");t.aespassword=e},t.setEncryptionMode=function(e){if("string"!=typeof e)throw new Error("Invalid encryptionMode");y.ENCRYPTION_MODES.includes(e)||(e=y.ENCRYPTION_MODE_NONE),t.aesmode=e},t.configPublisher=function(e){t.gatewayClient.configPublisher(e)},t.enableDualStream=function(n,i){return"iOS"===(0,c.getBrowserOS)()?(u.report.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),i&&i(a.default.IOS_NOT_SUPPORT)):(0,c.isWeChatBrowser)()?(u.report.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),i&&i(a.default.WECHAT_NOT_SUPPORT)):(u.report.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!0}),t.isDualStream=!0,void(0===t.highStreamState?t._publishLowStream(n,function(e){o.default.warning(e),i&&i(a.default.ENABLE_DUALSTREAM_FAILED)}):1===t.highStreamState?i&&i(a.default.STILL_ON_PUBLISHING):n&&n()))},t.disableDualStream=function(n,i){u.report.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!1,succ:!0}),t.isDualStream=!1,0===t.highStreamState?t._unpublishLowStream(function(){t.highStream.lowStream=null,n&&n()},function(e){o.default.warning(e),i&&i(a.default.DISABLE_DUALSTREAM_FAILED)}):1===t.highStreamState?i&&i(a.default.STILL_ON_PUBLISHING):n&&n()},t._createLowStream=function(e,n){if(t.highStream&&t.highStream.stream){var i=Object.assign({},t.highStream.params);if(i.streamID+=1,i.audio=!1,i.video){var r=t.highStream.stream.getVideoTracks()[0];r?p.deviceManager.getVideoCameraIdByLabel(r.label,function(a){i.cameraId=a;var s=new f.Stream(i);if(s.streamId=t.highStream.getId()+1,t.lowStreamParameter){var d=Object.assign({},t.lowStreamParameter);if(!d.width||!d.height){var u,p=(0,l.simMap)(t.highStream.profile);d.width=(u=h.SUPPORT_RESOLUTION_LIST[p[0]])[0],d.height=u[1]}d.framerate=d.framerate||5,d.bitrate=d.bitrate||50,((0,c.isSafari)()||(0,c.isOpera)())&&(o.default.debug("Shimming lowStreamParameter"),d.width=(u=h.SUPPORT_RESOLUTION_LIST[t.highStream.profile])[0],d.height=u[1]),s.setVideoProfileCustomPlus(d)}else s.setVideoProfileCustom((0,l.simMap)(t.highStream.profile));s.init(function(){t.highStream.lowStream=s,r.enabled||s.disableVideo(),e&&e(s)},n)},n):n&&n(a.default.HIGH_STREAM_NOT_VIDEO_TRACE)}else n&&n(a.default.HIGH_STREAM_NOT_VIDEO_TRACE)}else n&&n(a.default.HIGH_STREAM_NOT_VIDEO_TRACE)},t._getLowStream=function(e,n){t.lowStream?e(t.lowStream):t._createLowStream(function(n){t.lowStream=n,e(t.lowStream)},n)},t._publishLowStream=function(e,n){return 2!==t.lowStreamState?n&&n(a.default.LOW_STREAM_ALREADY_PUBLISHED):t.highStream&&t.highStream.hasScreen()?n&&n(a.default.SHARING_SCREEN_NOT_SUPPORT):void t._getLowStream(function(i){t.lowStreamState=1,t.gatewayClient.publish(i,function(){t.lowStreamState=0,e&&e()},function(e){o.default.debug("publish low stream failed"),n&&n(e)})},n)},t._unpublishLowStream=function(e,n){if(0!==t.lowStreamState)return n&&n(a.default.LOW_STREAM_NOT_YET_PUBLISHED);t.lowStream&&(t.gatewayClient.unpublish(t.lowStream,function(){},function(e){o.default.debug("unpublish low stream failed"),n&&n(e)}),t.lowStream.close(),t.lowStream=null,t.lowStreamState=2,e&&e())},t.join=function(n,i,c,l,f){if(n&&"string"!=typeof n)return o.default.warning("Param channelKey should be string"),f&&f(a.default.INVALID_PARAMETER);if("string"!=typeof i)return o.default.warning("Param channel should be string"),f&&f(a.default.INVALID_PARAMETER);if(c&&("number"!=typeof c||!(0,s.is32Uint)(c))&&"string"!=typeof c)return o.default.warning("Param uid should be valid number or string"),f&&f(a.default.INVALID_PARAMETER);if("string"==typeof c&&0==c.length)return o.default.warning("String uid should not be empty"),f&&f(a.default.INVALID_PARAMETER);if("string"==typeof c&&c.length>256)return o.default.warning("Length of string uid should be less than 255"),f&&f(a.default.INVALID_PARAMETER);t.highStream=null,t.lowStream=null,t.lowStreamParameter=null,t.isDualStream=!1,t.highStreamState=2,t.lowStreamState=2;var p={appId:e.appId,sid:e.sessionId,cname:i,uid:c,turnServer:t.turnServer,proxyServer:t.proxyServer};if("string"==typeof c&&(p.stringUid=c,p.uid=0),t.aespassword&&t.aesmode!==y.ENCRYPTION_MODE_NONE&&Object.assign(p,{aespassword:t.aespassword,aesmode:t.aesmode}),u.report.sessionInit(e.sessionId,{lts:(new Date).getTime(),cname:i,appid:e.appId,mode:e.mode,succ:!0}),t.onSuccess=l,t.onFailure=f,t.channel=i,t.gatewayClient.state!==r.default.DISCONNECTED)return o.default.error("Client already in connecting/connected state"),f&&f(a.default.INVALID_OPERATION),void u.report.joinGateway(p.sid,{lts:Date.now(),succ:!1,ec:a.default.INVALID_OPERATION,addr:null});t.gatewayClient.state=r.default.CONNECTING,(0,d.getGatewayList)(p,function(r){o.default.info("Joining channel: "+i),t.key=n||e.appId,p.cid=r.cid,p.uid=r.uid,r.uni_lbs_ip&&r.uni_lbs_ip[1]&&(p.uni_lbs_ip=r.uni_lbs_ip[1]),p.gatewayAddr=r.gateway_addr,t.joinInfo=p,t.gatewayClient.join(p,t.key,function(e){o.default.info("Join channel "+i+" success, join with uid: "+e+"."),t.onSuccess=null,l&&l(e)},f)},f)},t.renewChannelKey=function(e,n,i){void 0===t.key?(o.default.error("renewChannelKey should not be called before user join"),(0,s.safeCall)(i,a.default.INVALID_OPERATION)):(t.key=e,t.gatewayClient.key=e,t.gatewayClient.rejoin(),(0,s.safeCall)(n))},t.leave=function(e,n){o.default.info("Leaving channel"),t.gatewayClient.leave(e,n)},t._publish=function(n,i,r){if(2!==t.highStreamState)return o.default.warning("Can't publish stream when stream already publish",n.getId()),r&&r(a.default.STREAM_ALREADY_PUBLISHED);o.default.info("Publishing stream, uid: ",n.getId()),t.highStream=n,t.highStreamState=1,t.highStream.streamId=t.joinInfo.stringUid||t.joinInfo.uid,t.hasPublished=!1,t.gatewayClient.publish(n,function(){n.sid=e.sessionId,t.highStreamState=0,o.default.info("Publish success, uid:",n.getId()),t.isDualStream?t._publishLowStream(function(){i&&i()},function(){i&&i()}):i&&i()},r)},t._unpublish=function(e,n,i){if(0!==t.highStreamState)return o.default.warning("Can't unpublish stream when stream not publish"),i&&i(a.default.STREAM_NOT_YET_PUBLISHED);o.default.info("Unpublish stream, uid: ",e.getId()),t.isDualStream&&t.lowStream?(t._unpublishLowStream(null,i),t.gatewayClient.unpublish(e,null,i),t.highStreamState=2,o.default.info("Unpublish stream success, uid:",e.getId())):(t.gatewayClient.unpublish(e,null,i),t.highStreamState=2,o.default.info("Unpublish stream success, uid:",e.getId())),n&&n()},t.publish=function(e,n){2===t.highStreamState?t._publish(e,null,n):n&&n(a.default.STREAM_ALREADY_PUBLISHED)},t.unpublish=function(e,n){0===t.highStreamState?t._unpublish(e,null,n):n&&n(a.default.STREAM_NOT_YET_PUBLISHED)},t.subscribe=function(e,n){o.default.info("Subscribe stream, uid: ",e.getId()),t.gatewayClient.subscribe(e,null,n)},t.unsubscribe=function(e,n){o.default.info("Unsubscribe stream, uid: ",e.getId()),t.gatewayClient.unsubscribe(e,null,n)},t.setRemoteVideoStreamType=function(e,n){t.gatewayClient.setRemoteVideoStreamType(e,n)},t.setStreamFallbackOption=function(e,n){t.gatewayClient.setStreamFallbackOption(e,n)},t.startLiveStreaming=function(e,n){t.gatewayClient.startLiveStreaming(e,n)},t.stopLiveStreaming=function(e){t.gatewayClient.stopLiveStreaming(e)},t.setLiveTranscoding=function(e){Object.assign(b,e),t.gatewayClient.setLiveTranscoding(b)},t.enableAudioVolumeIndicator=function(e,n){e=e||2e3,n=n||3,t.audioVolumeIndication=t.audioVolumeIndication||{enabled:!0},t.audioVolumeIndication.interval=e,t.audioVolumeIndication.smooth=n,t.audioVolumeIndication={interval:e,smooth:n},o.default.info("enableAudioVolumeIndicator interval "+e+" smooth "+n),t.gatewayClient.enableAudioVolumeIndicator(e,n)},t.getNetworkStats=function(e,t){return _.networkManager.getStats(e,t)},t.getSystemStats=function(e,t){return v.systemManager.getStats(e,t)},t.getRecordingDevices=function(e,t){return p.deviceManager.getRecordingDevices(e,t)},t.getPlayoutDevices=function(e,t){return p.deviceManager.getPlayoutDevices(e,t)},t.getCameras=function(e,t){return p.deviceManager.getCameras(e,t)},t.getRemoteAudioStats=function(e,n){return t.rtcStatsCollector.getRemoteAudioStats(e,n)},t.getLocalAudioStats=function(e,n){return t.rtcStatsCollector.getLocalAudioStats(e,n)},t.getRemoteVideoStats=function(e,n){return t.rtcStatsCollector.getRemoteVideoStats(e,n)},t.getLocalVideoStats=function(e,n){return t.rtcStatsCollector.getLocalVideoStats(e,n)},t.getTransportStats=function(e,n){return t.rtcStatsCollector.getTransportStats(e,n)},t.gatewayClient=(0,r.default)(e),t.rtcStatsCollector=(0,m.RTCStatsCollector)(t.gatewayClient),t.on=t.gatewayClient.on,e&&e.turnServer&&t.setTurnServer(e.turnServer),e&&e.proxyServer&&t.setProxyServer(e.proxyServer),t.on("onMultiIP",function(e){t.gatewayClient.closeGateway(),t.gatewayClient.socket=void 0,t.gatewayClient.hasChangeBGPAddress=!0,t.joinInfo.multiIP=e.arg.option,t.gatewayClient.state=r.default.CONNECTING,(0,d.getGatewayList)(t.joinInfo,function(e){o.default.info("Joining channel: "+t.channel),t.joinInfo.cid=e.cid,t.joinInfo.uid=e.uid,t.joinInfo.uni_lbs_ip=e.uni_lbs_ip,t.joinInfo.gatewayAddr=e.gateway_addr,t.onSuccess?t.gatewayClient.join(t.joinInfo,t.key,function(e){o.default.info("Join channel "+t.channel+" success");var n=t.onSuccess;t.onSuccess=null,t.onFailure=null,n(e)},t.onFailure):(t.gatewayClient.joinInfo=Object.assign({},t.joinInfo),t.gatewayClient.rejoin())},t.onFailure)}),t.on("rejoin",function(){t.highStream&&0==(2===t.highStreamState?2:0)&&(o.default.info("publish after rejoin"),t.highStreamState=2,t.lowStreamState=2,t.publish(t.highStream,function(e){e&&o.default.info(e)}))}),t.on("streamPublished",function(e){t.hasPublished||(t.hasPublished=!0,t.gatewayClient.dispatchEvent((0,g.StreamEvent)({type:"stream-published",stream:e.stream})))}),t.on("pubP2PLost",function(e){o.default.debug("Start reconnect local peerConnection :",t.highStream.getId()),t.gatewayClient.dispatchEvent({type:"stream-reconnect-start",id:t.highStream.getId()}),1===t.highStreamState&&(t.highStreamState=0,t.lowStreamState=0),t._unpublish(t.highStream,function(){t._publish(t.highStream,function(){o.default.debug("Reconnect local peerConnection success:",t.highStream.getId()),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:t.highStream.getId()})},function(e){o.default.debug("Reconnect local peerConnection failed:"+e),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:t.highStream.getId()})})},function(e){o.default.debug("Reconnect local peerConnection failed:"+e),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:t.highStream.getId()})})}),t.on("subP2PLost",function(e){o.default.debug("Start reconnect remote peerConnection :",e.stream.getId()),t.gatewayClient.dispatchEvent({type:"stream-reconnect-start",id:e.stream.getId()}),t.gatewayClient.unsubscribe(e.stream,function(){t.gatewayClient.subscribe(e.stream,function(){o.default.debug("Reconnect remote peerConnection success:",e.stream.getId()),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:e.stream.getId()})},function(n){o.default.debug("Reconnect remote peerConnection failed:"+n),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:e.stream.getId()})})},function(n){o.default.debug("Reconnect remote peerConnection failed:"+n),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",id:e.stream.getId()})})}),_.networkManager.on("networkTypeChanged",function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e)}),p.deviceManager.on("recordingDeviceChanged",function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e)}),p.deviceManager.on("playoutDeviceChanged",function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e)}),p.deviceManager.on("cameraChanged",function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e)}),t.rtcStatsCollector.on("streamTypeChange",function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e)}),t},b={width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:y.AUDIO_SAMPLE_RATE_48000,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:y.VIDEO_CODEC_PROFILE_HIGH,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]};t.createClient=function(e){(e=Object.assign({},e||{})).codec||(e.codec=function(e){switch(e){case y.CLIENT_MODE_H264_INTEROP:return y.CLIENT_CODEC_H264;default:return y.CLIENT_CODEC_VP8}}(e.mode));var t=function(e){return y.CLIENT_MODES.includes(e.mode)?y.CLIENT_CODECS.includes(e.codec)?e.mode==y.CLIENT_MODE_H264_INTEROP&&e.codec!==y.CLIENT_CODEC_H264&&a.default.CLIENT_MODE_CODEC_MISMATCH:a.default.INVALID_CLIENT_CODEC:a.default.INVALID_CLIENT_MODE}(e);if(t)throw o.default.error("Invalid parameter setting MODE : "+e.mode+" CODEC : "+e.codec+" ERROR "+t),new Error(t);return o.default.info("Creating client , MODE : "+e.mode+" CODEC : "+e.codec),function(e){switch(e.mode){case y.CLIENT_MODE_INTEROP:case y.CLIENT_MODE_H264_INTEROP:e.mode=y.CLIENT_MODE_LIVE;break;case y.CLIENT_MODE_WEBONLY:e.mode=y.CLIENT_MODE_RTC}}(e),S(e)},t.createRtcClient=function(){return o.default.info("Creating client , MODE : rtc"),o.default.warning("createRtcClient is deprecated."),S({mode:"rtc"})},t.createLiveClient=function(e){var t="host";return e&&"audience"===e.role&&(t=e.role),o.default.info("Creating client , MODE : live"),o.default.warning("createLiveClient is deprecated."),S({mode:"live",role:t})},t.TranscodingUser={uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},t.LiveTranscoding=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(9),a=i(n(32)),s=n(13),d=n(1),u=i(n(0)),c=n(3),l=i(c),f=i(n(16)),p=n(17),h=n(2),g=n(4),m=n(7),_=n(5),v=i(n(34)),y=function e(t){var n=!1,i=function(){var e={appId:t.appId,key:T.key,channel:T.joinInfo.cname,uid:T.uid,version:h.VERSION,browser:navigator.userAgent,mode:t.mode,codec:t.codec,role:t.role,config:T.config};return T.joinInfo.hasOwnProperty("stringUid")&&(e.stringUid=T.joinInfo.stringUid),{_type:"join1",message:e}},y=function(e){return{_type:"control",message:e}},b=function(e,t,n){return{_type:"publish",options:e,sdp:t,p2pid:n}},E=e.DISCONNECTED,w=e.CONNECTING,I=e.CONNECTED,R=e.DISCONNECTING,T=(0,d.EventDispatcher)(t);T.socket=void 0,T.state=E,T.mode=t.mode,T.role=t.role,T.codec=t.codec,T.config={},T.timers={},T.timer_counter={},T.localStreams={},T.remoteStreams={},T.attemps=1,T.p2p_attemps=1,T.audioLevel={},T.activeSpeaker=void 0,T.reconnectMode="retry",T.rejoinAttempt=0,T.hasChangeBGPAddress=!1,T.traffic_stats={},T.p2ps=new Map,T.firstFrameTimer=new Map,T.liveStreams=new Map,T.remoteStreamsInChannel=new Set,T.inChannelInfo={joinAt:null,duration:0};var A=f.default;T.p2pCounter=(0,m.random)(1e5),T.generateP2PId=function(){return++T.p2pCounter},T.audioVolumeIndication={enabled:!1,sortedAudioVolumes:[],smooth:3,interval:2e3},T.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},T.streamFallbackTypes={STREAM_FALLBACK_OPTION_DISABLED:0,STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:1,STREAM_FALLBACK_OPTION_AUDIO_ONLY:2},T.configPublisher=function(e){T.config=e},T.join=function(e,t,n,r){var o=(new Date).getTime(),a=e.uid;if(T.inChannelInfo.joinAt&&(T.inChannelInfo.duration+=o-T.inChannelInfo.joinAt),T.inChannelInfo.joinAt=o,T.state!==w)return u.default.error("GatewayClient.join Failed: state ",T.state),r&&r(l.default.INVALID_OPERATION),void g.report.joinGateway(e.sid,{lts:o,succ:!1,ec:l.default.INVALID_OPERATION,addr:null});if(null!=a&&parseInt(a)!==a)return u.default.error("Input uid is invalid"),T.state=E,r&&r(l.default.INVALID_PARAMETER),void g.report.joinGateway(e.sid,{lts:o,succ:!1,ec:l.default.INVALID_PARAMETER,addr:null});var s=S.register(T,{uid:a,cname:e&&e.cname});if(s)return T.state=E,r&&r(s),void g.report.joinGateway(e.sid,{lts:o,succ:!1,ec:s,addr:null});T.joinInfo=Object.assign({},e),T.uid=a,T.key=t,N(e,function(t){T.state=I,u.default.debug("Connected to gateway server"),T.pingTimer=setInterval(function(){var e=Date.now();k({_type:"ping"},function(){var t=Date.now()-e;k({_type:"signal_stats",message:{pingpongElapse:t}},function(){},function(e){})},function(e){})},3e3),k(i(),function(t){if(g.report.joinGateway(e.sid,{lts:o,succ:!0,ec:null,vid:t.vid,addr:T.socket.getURL()}),T.rejoinAttempt=0,n&&n(t.uid),T.leaveOnConnected){u.default.info("Calling Leave() once joined");var i=T.leaveOnConnected;T.leaveOnConnected=null,T.leave(i.onSuccess,i.onFailure)}},function(t){if(u.default.error("User join failed ["+t+"]"),v.default[t]&&T.rejoinAttempt<4){if(T._doWithAction(v.default[t],n,r),T.leaveOnConnected){u.default.error("Calling Leave() once joined: Join Failed");var i=T.leaveOnConnected;T.leaveOnConnected=null,i.onFailure(l.default.JOIN_CHANNEL_FAILED)}}else r&&r(t);g.report.joinGateway(e.sid,{lts:o,succ:!1,ec:t,addr:T.socket.getURL()})})},function(t){u.default.error("User join failed ["+t+"]"),r&&r(t),g.report.joinGateway(e.sid,{lts:o,succ:!1,ec:t,addr:T.socket.getURL()})}),clearInterval(T.timers.trafficStats),T.timers.trafficStats=setInterval(function(){k({_type:"traffic_stats"},function(e){T.traffic_stats=e;var t=T.localStreams[a];t&&(t.traffic_stats={access_delay:e.access_delay}),e.peer_delay&&e.peer_delay.forEach(function(t){var n=T.remoteStreams[t.peer_uid];n&&(n.traffic_stats={access_delay:e.access_delay,e2e_delay:t.e2e_delay,audio_delay:t.audio_delay,video_delay:t.video_delay})})})},3e3),T.resetAudioVolumeIndication()},T.leave=function(e,t){switch(T.state){case E:return u.default.debug("Client Already in DISCONNECTED status"),void A(e);case R:return u.default.error("Client Already in DISCONNECTING status"),void A(t,l.default.INVALID_OPERATION);case w:return T.leaveOnConnected?(u.default.error("Client.leave() already called"),void A(t,l.default.INVALID_OPERATION)):(u.default.debug("Client connecting. Waiting for Client Fully Connected(And leave)"),void(T.leaveOnConnected={onSuccess:e,onFailure:t}))}var n=S.unregister(T);if(n)u.default.error(n);else{for(var i in T.state=R,clearInterval(T.pingTimer),T.timers)T.timers.hasOwnProperty(i)&&clearInterval(T.timers[i]);for(var i in T.inChannelInfo.joinAt&&(T.inChannelInfo.duration+=Date.now()-T.inChannelInfo.joinAt,T.inChannelInfo.joinAt=null),k({_type:"leave"},function(t){T.socket.close(),T.socket=void 0,u.default.info("Leave channel success"),T.state=E,e&&e(t)},function(e){u.default.error("Leave Channel Failed",e),T.state=I,t&&t(e)}),T.localStreams)if(T.localStreams.hasOwnProperty(i)){var r=T.localStreams[i];delete T.localStreams[i],void 0!==r.pc&&(r.pc.close(),r.pc=void 0)}L()}},T.publish=function(e,t,n){var i=(new Date).getTime(),o=!1;if(e.publishLTS=i,"object"!==(void 0===e?"undefined":r(e))||null===e)return u.default.error("Invalid local stream"),n&&n(l.default.INVALID_LOCAL_STREAM),void g.report.publish(T.joinInfo.sid,{lts:i,succ:!1,ec:l.default.INVALID_LOCAL_STREAM});if(null===e.stream&&void 0===e.url)return u.default.error("Invalid local media stream"),n&&n(l.default.INVALID_LOCAL_STREAM),void g.report.publish(T.joinInfo.sid,{lts:i,succ:!1,ec:l.default.INVALID_LOCAL_STREAM});if(T.state!==I)return u.default.error("User is not in the session"),n&&n(l.default.INVALID_OPERATION),void g.report.publish(T.joinInfo.sid,{lts:i,succ:!1,ec:l.default.INVALID_OPERATION});var a=e.getAttributes()||{};if(e.local&&void 0===T.localStreams[e.getId()]&&(e.hasAudio()||e.hasVideo()||e.hasScreen())){var c=T.generateP2PId();if(T.p2ps.set(c,e),e.p2pId=c,void 0!==e.url)M(b({state:"url",audio:e.hasAudio(),video:e.hasVideo(),attributes:e.getAttributes(),mode:T.mode},e.url),function(t,n){"success"===t?(e.getUserId()!==n&&e.setUserId(n),T.localStreams[n]=e,e.onClose=function(){T.unpublish(e)}):u.default.error("Publish local stream failed",t)});else{T.localStreams[e.getId()]=e,e.pc=(0,s.Connection)({callback:function(r){u.default.debug("SDP exchange in publish : send offer --  ",JSON.parse(r)),M(b({state:"offer",id:e.getId(),audio:e.hasAudio(),video:e.hasVideo()||e.hasScreen(),attributes:e.getAttributes(),dtx:e.DTX,hq:e.highQuality,lq:e.lowQuality,stereo:e.stereo,speech:e.speech,mode:T.mode,codec:T.codec,p2pid:c,turnip:T.joinInfo.turnServer.url,turnport:Number(T.joinInfo.turnServer.udpport),turnusername:T.joinInfo.turnServer.username,turnpassword:T.joinInfo.turnServer.credential},r),function(a,s){if("error"===a)return u.default.error("Publish local stream failed"),n&&n(l.default.PUBLISH_STREAM_FAILED),void g.report.publish(T.joinInfo.sid,{lts:i,succ:!1,localSDP:r,ec:l.default.PUBLISH_STREAM_FAILED});e.pc.onsignalingmessage=function(t){e.pc.onsignalingmessage=function(){},M(b({state:"ok",id:e.getId(),audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),attributes:e.getAttributes(),mode:T.mode},t)),e.getUserId()!==s.id&&e.setUserId(s.id),u.default.info("Local stream published with uid",s.id),e.onClose=function(){T.unpublish(e)},e.unmuteAudio=function(){k(y({action:"audio-out-on",streamId:e.getId()}),function(){},function(){})},e.unmuteVideo=function(){k(y({action:"video-out-on",streamId:e.getId()}),function(){},function(){})},e.muteAudio=function(){k(y({action:"audio-out-off",streamId:e.getId()}),function(){},function(){})},e.muteVideo=function(){k(y({action:"video-out-off",streamId:e.getId()}),function(){},function(){})},e.getId()===e.getUserId()&&(e.isAudioOn()||e.hasAudio()&&(u.default.debug("local stream audio mute"),e.muteAudio()),e.isVideoOn()||(e.hasVideo()||e.hasScreen())&&(u.default.debug("local stream video mute"),e.muteVideo()))},e.pc.oniceconnectionstatechange=function(r){if("failed"===r){if(null!=T.timers[e.getId()]&&(clearInterval(T.timers[e.getId()]),clearInterval(T.timers[e.getId()]+"_RelatedStats")),u.default.error("Publisher connection is lost -- streamId: "+e.getId()+" p2pId: "+c),T.p2ps.delete(c),u.default.debug("publish p2p failed: ",T.p2ps),!o)return o=!0,g.report.publish(T.joinInfo.sid,{lts:i,succ:!1,ec:l.default.PEERCONNECTION_FAILED}),T.dispatchEvent((0,d.ClientEvent)({type:"pubP2PLost",stream:e})),n&&n(l.default.PEERCONNECTION_FAILED);T.dispatchEvent((0,d.ClientEvent)({type:"pubP2PLost",stream:e}))}else if("connected"===r&&(u.default.debug("publish p2p connected: ",T.p2ps),!o))return o=!0,g.report.publish(T.joinInfo.sid,{lts:i,succ:!0,ec:null}),t&&t()},u.default.debug("SDP exchange in publish : receive answer --  ",JSON.parse(a)),e.pc.processSignalingMessage(a)})},audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),isSubscriber:!1,stunServerUrl:T.stunServerUrl,turnServer:T.joinInfo.turnServer,maxAudioBW:a.maxAudioBW,minVideoBW:a.minVideoBW,maxVideoBW:a.maxVideoBW,mode:T.mode,codec:T.codec,isVideoMute:!e.videoEnabled,maxFrameRate:e.attributes.maxFrameRate}),e.pc.addStream(e.stream),u.default.debug("PeerConnection add stream :",e.stream),e.pc.onnegotiationneeded=function(t){M(b({state:"negotiation",p2pid:c},t),function(t,n){e.pc.processSignalingMessage(t)})},T.timers[e.getId()]=setInterval(function(){e&&e.pc&&e.pc.getStats&&e.pc.getStatsRate(function(t){t.forEach(function(t){t&&t.id&&(/_recv$/.test(t.id)||/^time$/.test(t.id)||e.getUserId()&&(-1===t.id.indexOf("outbound_rtp")&&-1===t.id.indexOf("OutboundRTP")||"video"!==t.mediaType||(t.googFrameWidthSent=e.videoWidth+"",t.googFrameHeightSent=e.videoHeight+""),e.getId()==e.getUserId()?k({_type:"publish_stats",options:{stats:t},sdp:null},null,null):k({_type:"publish_stats_low",options:{stats:t},sdp:null},null,null)))})})},3e3);var f=function(){e&&e.pc&&e.pc.getVideoRelatedStats&&e.pc.getVideoRelatedStats(function(t){e.getId()===e.getUserId()?k({_type:"publish_related_stats",options:t},null,null):k({_type:"publish_related_stats_low",options:t},null,null)})};f(),T.timers[e.getId()+"_RelatedStats"]=setInterval(f,1e3)}}},T.unpublish=function(e,t,n){return"object"!==(void 0===e?"undefined":r(e))||null===e?(u.default.error("Invalid local stream"),void A(n,l.default.INVALID_LOCAL_STREAM)):T.state!==I?(u.default.error("User not in the session"),void A(n,l.default.INVALID_OPERATION)):(null!=T.timers[e.getId()]&&(clearInterval(T.timers[e.getId()]),clearInterval(T.timers[e.getId()+"_RelatedStats"])),void(void 0!==T.socket?e.local&&void 0!==T.localStreams[e.getId()]?(delete T.localStreams[e.getId()],k(function(e){return{_type:"unpublish",message:e}}(e.getUserId())),(e.hasAudio()||e.hasVideo()||e.hasScreen())&&void 0===e.url&&void 0!==e.pc&&(e.pc.close(),e.pc=void 0),e.onClose=void 0,e.unmuteAudio=void 0,e.muteAudio=void 0,e.unmuteVideo=void 0,e.muteVideo=void 0,T.p2ps.delete(e.p2pId),t&&t()):(u.default.error("Invalid local stream"),A(n,l.default.INVALID_LOCAL_STREAM)):(u.default.error("User not in the session"),A(n,l.default.INVALID_OPERATION))))},T.subscribe=function(e,t,n){var i=(new Date).getTime();e.subscribeLTS=i;var o=!1;if("object"!==(void 0===e?"undefined":r(e))||null===e)return u.default.error("Invalid remote stream"),n&&n(l.default.INVALID_REMOTE_STREAM),void g.report.subscribe(T.joinInfo.sid,{lts:i,succ:!1,peerid:e.getId()+"",ec:l.default.INVALID_REMOTE_STREAM});if(T.state!==I&&(u.default.error("User is not in the session"),!o))return o=!0,g.report.subscribe(T.joinInfo.sid,{lts:i,succ:!1,peerid:e.getId()+"",ec:l.default.INVALID_OPERATION}),n&&n(l.default.INVALID_OPERATION);if(!e.local&&T.remoteStreams.hasOwnProperty(e.getId()))if(e.hasAudio()||e.hasVideo()||e.hasScreen()){var a=T.generateP2PId();T.p2ps.set(a,e),e.p2pId=a,e.pc=(0,s.Connection)({callback:function(t){u.default.debug("SDP exchange in subscribe : send offer --  ",JSON.parse(t)),M(function(e,t,n){return{_type:"subscribe",options:e,sdp:t,p2pid:void 0}}({streamId:e.getId(),audio:!0,video:!0,mode:T.mode,codec:T.codec,p2pid:a,turnip:T.joinInfo.turnServer.url,turnport:Number(T.joinInfo.turnServer.udpport),turnusername:T.joinInfo.turnServer.username,turnpassword:T.joinInfo.turnServer.credential},t),function(t){if("error"===t)return u.default.error("Subscribe remote stream failed, closing stream ",e.getId()),e.close(),n&&n(l.default.SUBSCRIBE_STREAM_FAILED),void g.report.subscribe(T.joinInfo.sid,{lts:i,succ:!1,peerid:e.getId()+"",ec:l.default.SUBSCRIBE_STREAM_FAILED});u.default.debug("SDP exchange in subscribe : receive answer --  ",JSON.parse(t)),e.pc.processSignalingMessage(t)})},nop2p:!0,audio:!0,video:!0,screen:e.hasScreen(),isSubscriber:!0,stunServerUrl:T.stunServerUrl,turnServer:T.joinInfo.turnServer,isVideoMute:!e.videoEnabled,uid:e.getId()}),e.pc.onaddstream=function(t,n){if("ontrack"===n&&"video"===t.track.kind||"onaddstream"===n){u.default.info("Remote stream subscribed with uid ",e.getId());var i=T.remoteStreams[e.getId()];if(T.remoteStreams[e.getId()].stream="onaddstream"===n?t.stream:t.streams[0],T.remoteStreams[e.getId()].hasVideo()){if((0,_.isFireFox)()){var r=T.remoteStreams[e.getId()].stream;(0,m.vsResHack)(r,function(t,n){e.videoWidth=t,e.videoHeight=n},function(e){return u.default.warning("vsResHack failed:"+e)})}}else T.remoteStreams[e.getId()].disableVideo();i&&i.isPlaying()&&i.elementID&&(u.default.debug("Reload Player "+i.elementID+" StreamId "+i.getId()),e.audioOutput=i.audioOutput,i.stop(),e.play(i.elementID,i.playOptions));var o=(0,d.StreamEvent)({type:"stream-subscribed",stream:T.remoteStreams[e.getId()]});T.dispatchEvent(o)}e.unmuteAudio=function(){k(y({action:"audio-in-on",streamId:e.getId()}),function(){},function(){})},e.muteAudio=function(){k(y({action:"audio-in-off",streamId:e.getId()}),function(){},function(){})},e.unmuteVideo=function(){k(y({action:"video-in-on",streamId:e.getId()}),function(){},function(){})},e.muteVideo=function(){k(y({action:"video-in-off",streamId:e.getId()}),function(){},function(){})}},T.timers[e.getId()]=setInterval(function(){e&&e.pc&&e.pc.getStats&&e.pc.getStatsRate(function(t){t.forEach(function(t){if(t&&t.id){if(/_send$/.test(t.id)||/^time$/.test(t.id)||/^bweforvideo$/.test(t.id))return;-1!==t.id.indexOf("inbound_rtp")&&"video"===t.mediaType&&(t.googFrameWidthReceived=e.videoWidth+"",t.googFrameHeightReceived=e.videoHeight+""),M(function(e,t){return{_type:"subscribe_stats",options:{id:e,stats:t},sdp:null}}(e.getId(),t),null,null)}})})},3e3),T.timers[e.getId()+"_RelatedStats"]=setInterval(function(){e&&e.pc&&e.pc.getVideoRelatedStats&&e.pc.getVideoRelatedStats(function(e){k(function(e){return{_type:"subscribe_related_stats",options:e}}(e),null,null)})},1e3),T.audioLevel[e.getId()]=0,T.timers[e.getId()+"audio"]=setInterval(function(){T.hasListeners("active-speaker")&&e&&e.pc&&"established"===e.pc.state&&e.pc.getStats&&e.pc.getStats(function(t){t.forEach(function(t){if("audio"===t.mediaType){if(t.audioOutputLevel>5e3)for(var n in T.audioLevel[e.getId()]<20&&(T.audioLevel[e.getId()]+=1),T.audioLevel)parseInt(n)!==e.getId()&&T.audioLevel[n]>0&&(T.audioLevel[n]-=1);var i=Object.keys(T.audioLevel).sort(function(e,t){return T.audioLevel[t]-T.audioLevel[e]});if(T.activeSpeaker!==i[0]){var r=(0,d.ClientEvent)({type:"active-speaker",uid:i[0]});T.dispatchEvent(r),T.activeSpeaker=i[0],u.default.debug("Update active speaker:"+T.activeSpeaker)}}})})},50),e.pc.oniceconnectionstatechange=function(r){if("failed"===r)null!=T.timers[e.getId()]&&(clearInterval(T.timers[e.getId()]),clearInterval(T.timers[e.getId()]+"audio")),u.default.error("Subscriber connection is lost -- streamId: "+e.getId()+" p2pId: "+a),u.default.debug("subscribe p2p failed: ",T.p2ps),o||(o=!0,n&&n(l.default.PEERCONNECTION_FAILED),g.report.subscribe(T.joinInfo.sid,{lts:i,succ:!1,peerid:e.getId()+"",ec:l.default.PEERCONNECTION_FAILED})),T.remoteStreams[e.getId()]&&T.p2ps.has(a)&&(T.p2ps.delete(a),T.dispatchEvent((0,d.ClientEvent)({type:"subP2PLost",stream:e})));else if("connected"===r&&(u.default.debug("subscribe p2p connected: ",T.p2ps),!o))return o=!0,g.report.subscribe(T.joinInfo.sid,{lts:i,succ:!0,peerid:e.getId()+"",ec:null}),T.firstFrameTimer.set(e.getId(),setInterval(function(){e.pc?e.pc.getStats(function(t){t.forEach(function(t){-1===t.id.indexOf("recv")&&-1===t.id.indexOf("inbound_rtp")&&-1===t.id.indexOf("InboundRTP")||"video"===t.mediaType&&(t.framesDecoded>0||t.googFramesDecoded>0)&&(clearInterval(T.firstFrameTimer.get(e.getId())),T.firstFrameTimer.delete(e.getId()),g.report.firstRemoteFrame(T.joinInfo.sid,{lts:(new Date).getTime(),peerid:e.getId()+"",succ:!0,width:+t.googFrameWidthReceived,height:+t.googFrameHeightReceived}))})}):(clearInterval(T.firstFrameTimer.get(e.getId())),T.firstFrameTimer.delete(e.getId()))},100)),t&&t()}}else u.default.error("Invalid remote stream"),o||(o=!0,n&&n(l.default.INVALID_REMOTE_STREAM),g.report.subscribe(T.joinInfo.sid,{lts:i,succ:!1,peerid:e.getId()+"",ec:l.default.INVALID_REMOTE_STREAM}));else u.default.error("No such remote stream"),o||(o=!0,n&&n(l.default.NO_SUCH_REMOTE_STREAM),g.report.subscribe(T.joinInfo.sid,{lts:i,succ:!1,peerid:e.getId()+"",ec:l.default.NO_SUCH_REMOTE_STREAM}))},T.unsubscribe=function(e,t,n){return"object"!==(void 0===e?"undefined":r(e))||null===e?(u.default.error("Invalid remote stream"),void A(n,l.default.INVALID_REMOTE_STREAM)):T.state!==I?(u.default.error("User is not in the session"),void A(n,l.default.INVALID_OPERATION)):(null!=T.timers[e.getId()]&&(clearInterval(T.timers[e.getId()]),clearInterval(T.timers[e.getId()]+"audio")),null!=T.audioLevel[e.getId()]&&delete T.audioLevel[e.getId()],null!=T.timer_counter[e.getId()]&&delete T.timer_counter[e.getId()],T.remoteStreams.hasOwnProperty(e.getId())?T.socket?e.local?(u.default.error("Invalid remote stream"),void A(n,l.default.INVALID_REMOTE_STREAM)):(e.close(),void k(function(e){return{_type:"unsubscribe",message:e}}(e.getId()),function(i){if("error"===i)return u.default.error("Unsubscribe remote stream failed",e.getId()),void A(n,l.default.UNSUBSCRIBE_STREAM_FAILED);void 0!==e.pc&&(e.pc.close(),e.pc=void 0),e.onClose=void 0,e.unmuteAudio=void 0,e.muteAudio=void 0,e.unmuteVideo=void 0,e.muteVideo=void 0,T.p2ps.delete(e.p2pId),u.default.info("Unsubscribe stream success"),t&&t()},n)):(u.default.error("User is not in the session"),void A(n,l.default.INVALID_OPERATION)):void A(n,l.default.NO_SUCH_REMOTE_STREAM))},T.setRemoteVideoStreamType=function(e,t){if(u.default.debug("Switching remote video stream "+e.getId()+" to "+t),"object"===(void 0===e?"undefined":r(e))&&null!==e)if(T.state===I){if(!e.local){switch(t){case T.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case T.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case T.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return}k(function(e,t){return{_type:"switchVideoStream",message:{id:e,type:t}}}(e.getId(),t),null,null)}}else u.default.error("User is not in the session");else u.default.error("Invalid remote stream")},T.renewToken=function(e,t,n){e?T.key?T.state!==I?(u.default.debug("Client is not connected. Trying to rejoin"),T.key=e,T.rejoin(),t&&t()):(u.default.debug("renewToken from "+T.key+" to "+e),k(function(e){return{_type:"renew_token",message:{token:e}}}(e),t,n)):(u.default.error("Client is previously joined without token"),n&&n(l.default.INVALID_PARAMETER)):(u.default.error("Invalid Token "+e),n&&n(l.default.INVALID_PARAMETER))},T.setStreamFallbackOption=function(e,t){if(u.default.debug("Set stream fallback option "+e.getId()+" to "+t),"object"===(void 0===e?"undefined":r(e))&&null!==e)if(T.state===I){if(!e.local){switch(t){case T.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:case T.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:case T.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:break;default:return}k(function(e,t){return{_type:"setFallbackOption",message:{id:e,type:t}}}(e.getId(),t),null,null)}}else u.default.error("User is not in the session");else u.default.error("Invalid remote stream")},T.startLiveStreaming=function(e,t){T.liveStreams.set(e,t),u.default.debug("Start live streaming "+e+" transcodingEnabled "+t),T.state===I?k(function(e,t){return{_type:"start_live_streaming",message:{url:e,transcodingEnabled:t}}}(e,t),null,null):u.default.error("User is not in the session")},T.stopLiveStreaming=function(e){u.default.debug("Stop live streaming "+e),T.state===I?(T.liveStreams.delete(e),k(function(e){return{_type:"stop_live_streaming",message:{url:e}}}(e),null,null)):u.default.error("User is not in the session")},T.setLiveTranscoding=function(e){if((0,m.isLiveTranscodingValid)(e)){if(T.transcoding=e,u.default.debug("Set live transcoding ",e),T.state!==I)return void u.default.error("User is not in the session");k(function(e){return{_type:"set_live_transcoding",message:{transcoding:e}}}(e),null,null)}},T.enableAudioVolumeIndicator=function(e,t){T.audioVolumeIndication.enabled=!0,T.audioVolumeIndication.interval=e,T.audioVolumeIndication.smooth=t,T.resetAudioVolumeIndication()},T.resetAudioVolumeIndication=function(){if(clearInterval(T.timers.audioVolumeIndication),clearInterval(T.timers.audioVolumeSampling),T.audioVolumeIndication.enabled&&T.audioVolumeIndication.interval){var e=Math.floor(1e3*T.audioVolumeIndication.smooth/100);T.timers.audioVolumeSampling=setInterval(function(){T.audioVolumeSampling||(T.audioVolumeSampling={});var t={};for(var n in T.remoteStreams){var i=T.remoteStreams[n];if(i.stream&&i.hasAudio()){var r=i.getAudioLevel();r>0&&r<1&&(r*=100);var o=T.audioVolumeSampling[n]||[];for(o.push(r);o.length>e;)o.shift();t[n]=o}}T.audioVolumeSampling=t},100),T.timers.audioVolumeIndication=setInterval(function(){var e=[];for(var t in T.remoteStreams)if(T.audioVolumeSampling&&T.audioVolumeSampling[t]){var n=T.audioVolumeSampling[t],i=0;n.forEach(function(e){i+=e});var r={uid:t,level:Math.floor(i/n.length)};r.level&&e.push(r)}var o=e.sort(function(e,t){return e.level-t.level});u.default.debug("volume-indicator",JSON.stringify(o)),T.audioVolumeIndication.sortedAudioVolumes=o;var a=(0,d.ClientEvent)({type:"volume-indicator",attr:o});T.dispatchEvent(a)},T.audioVolumeIndication.interval)}},T.closeGateway=function(){u.default.debug("close gateway"),T.state=E,T.socket.close(),C()};var C=function(){for(var e in T.timers)T.timers.hasOwnProperty(e)&&clearInterval(T.timers[e]);for(var e in T.remoteStreams)if(T.remoteStreams.hasOwnProperty(e)){var t=T.remoteStreams[e],n=(0,d.ClientEvent)({type:"stream-removed",uid:t.getId(),stream:t});T.dispatchEvent(n)}T.p2ps.clear(),L(),D(),clearInterval(T.pingTimer)};T.rejoin=function(){T.socket&&(clearInterval(T.pingTimer),T.socket.close(),T.socket=void 0),T.state=w,O()};var O=function(e,t){e=e||function(e){u.default.info("User "+e+" is re-joined to "+T.joinInfo.cname),T.dispatchEvent((0,d.ClientEvent)({type:"rejoin"})),T.liveStreams&&T.liveStreams.size&&T.liveStreams.forEach(function(e,t){e&&T.setLiveTranscoding(T.transcoding),T.startLiveStreaming(t,e)})},t=t||function(e){u.default.error("Re-join to channel failed ["+e+"]"),T.dispatchEvent((0,d.StreamEvent)({type:"error",reason:e}))},T.key?(++T.rejoinAttempt,T.join(T.joinInfo,T.key,e,t)):u.default.error("Connection recover failed [Invalid channel key]")},N=function(e,t,i){T.onConnect=t,void 0!==T.socket?"retry"===T.reconnectMode?(u.default.debug("Retry current gateway"),T.socket.reconnect()):"tryNext"===T.reconnectMode?(u.default.debug("Try next gateway"),T.socket.connectNext()):"recover"===T.reconnectMode&&(u.default.debug("Recover gateway"),u.default.debug("Try to reconnect choose server and get gateway list again "),(0,p.getGatewayList)(T.joinInfo,function(e){T.socket.replaceHost(e.gateway_addr)})):(function(e){T.socket=(0,a.default)(e,{sid:T.joinInfo.sid})}(e.gatewayAddr),T.socket.on("onUplinkStats",function(e){T.localStreams[T.uid]&&(T.localStreams[T.uid].uplinkStats=e)}),T.socket.on("connect",function(){T.attemps=1,k(function(e){var t=e;return e.uni_lbs_ip&&(t=Object.assign(e,{wanip:e.uni_lbs_ip,hasChange:T.hasChangeBGPAddress})),{_type:"token",message:t}}(e),T.onConnect,i)}),T.socket.on("recover",function(){T.state=w,u.default.debug("Try to reconnect choose server and get gateway list again "),(0,p.getGatewayList)(T.joinInfo,function(e){T.socket.replaceHost(e.gateway_addr)})}),T.socket.on("disconnect",function(e){if(T.state!==E){T.state=E;var t=(0,d.StreamEvent)({type:"error",reason:l.default.SOCKET_DISCONNECTED});if(T.dispatchEvent(t),T.reconnectMode=0===T.p2ps.size?"tryNext":"retry",C(),1!=n){var i=1e3*Math.min(30,Math.pow(2,T.attemps)-1);u.default.error("Disconnect from server ["+e+"], attempt to recover [#"+T.attemps+"] after "+i/1e3+" seconds"),setTimeout(function(){T.attemps++,T.state=w,O()},i)}}}),T.socket.on("onAddAudioStream",function(e){if(u.default.info("Newly added audio stream with uid",e.id),T.remoteStreamsInChannel.has(e.id)||T.remoteStreamsInChannel.add(e.id),void 0===T.remoteStreams[e.id]){var t=(0,o.Stream)({streamID:e.id,local:!1,audio:e.audio,video:e.video,screen:e.screen,attributes:e.attributes});T.remoteStreams[e.id]=t;var n=(0,d.StreamEvent)({type:"stream-added",stream:t});T.dispatchEvent(n)}}),T.socket.on("onAddVideoStream",function(e){if(u.default.info("Newly added remote stream with uid"+e.id+"."),T.remoteStreamsInChannel.has(e.id)||T.remoteStreamsInChannel.add(e.id),void 0===T.remoteStreams[e.id]){var t=(0,o.Stream)({streamID:e.id,local:!1,audio:e.audio,video:e.video,screen:e.screen,attributes:e.attributes});T.remoteStreams[e.id]=t;var n=(0,d.StreamEvent)({type:"stream-added",stream:t});T.dispatchEvent(n)}else{var i=T.remoteStreams[e.id];if(void 0!==i.stream){if((t=T.remoteStreams[e.id]).video=!0,t.enableVideo(),u.default.info("Stream changed: enable video "+e.id),t.isPlaying()){var r=t.player.elementID;t.stop(),t.play(r)}}else i.p2pId?T.remoteStreams[e.id].video=!0:(t=(0,o.Stream)({streamID:e.id,local:!1,audio:!0,video:!0,screen:!1,attributes:e.attributes}),T.remoteStreams[e.id]=t,u.default.info("Stream changed: modify video "+e.id))}}),T.socket.on("onRemoveStream",function(e){T.remoteStreamsInChannel.has(e.id)&&T.remoteStreamsInChannel.delete(e.id);var t=T.remoteStreams[e.id];if(t){delete T.remoteStreams[e.id];var n=(0,d.StreamEvent)({type:"stream-removed",stream:t});T.dispatchEvent(n),t.close(),void 0!==t.pc&&(t.pc.close(),t.pc=void 0,T.p2ps.delete(t.p2pId))}else console.log("ERROR stream ",e.id," not found onRemoveStream ",e)}),T.socket.on("onPublishStream",function(e){var t=(0,d.StreamEvent)({type:"streamPublished",stream:T.localStreams[e.id]});T.dispatchEvent(t)}),T.socket.on("mute_audio",function(e){u.default.info("rcv peer mute audio:"+e.peerid);var t=(0,d.ClientEvent)({type:"mute-audio",uid:e.peerid}),n=T.remoteStreams[e.peerid];n&&(n.audioEnabled=!1),T.dispatchEvent(t)}),T.socket.on("unmute_audio",function(e){u.default.info("rcv peer unmute audio:"+e.peerid);var t=(0,d.ClientEvent)({type:"unmute-audio",uid:e.peerid}),n=T.remoteStreams[e.peerid];n&&(n.audioEnabled=!0),T.dispatchEvent(t)}),T.socket.on("mute_video",function(e){u.default.info("rcv peer mute video:"+e.peerid);var t=(0,d.ClientEvent)({type:"mute-video",uid:e.peerid}),n=T.remoteStreams[e.peerid];n&&(n.videoEnabled=!1),T.dispatchEvent(t)}),T.socket.on("unmute_video",function(e){u.default.info("rcv peer unmute video:"+e.peerid);var t=(0,d.ClientEvent)({type:"unmute-video",uid:e.peerid}),n=T.remoteStreams[e.peerid];n&&(n.videoEnabled=!0),T.dispatchEvent(t)}),T.socket.on("user_banned",function(e){u.default.info("user banned uid:"+e.id+"error:"+e.errcode);var t=(0,d.ClientEvent)({type:"client-banned",uid:e.id,attr:e.errcode});T.dispatchEvent(t),n=!0,leave()}),T.socket.on("stream_fallback",function(e){u.default.info("stream fallback uid:"+e.id+" peerId:"+e.peerid+" type:"+e.type);var t=(0,d.ClientEvent)({type:"stream-fallback",uid:e.id,stream:e.peerid,attr:e.type});T.dispatchEvent(t)}),T.socket.on("stream_recover",function(e){u.default.info("stream recover uid:"+e.id+"peerId:"+e.peerid+" type:"+e.type);var t=(0,d.ClientEvent)({type:"stream-recover",uid:e.id,stream:e.peerid,attr:e.type});T.dispatchEvent(t)}),T.socket.on("onP2PLost",function(e){if(u.default.debug("p2plost:",e,"p2ps:",T.p2ps),"publish"===e.event){var t=T.localStreams[e.uid];t&&g.report.publish(T.joinInfo.sid,{lts:t.publishLTS,succ:!1,ec:"DTLS failed"})}if("subscribe"===e.event){var n=T.remoteStreams[e.uid];n&&g.report.subscribe(T.joinInfo.sid,{lts:n.subscribeLTS,succ:!1,peerid:e.uid+"",ec:"DTLS failed"})}u.default.debug("p2plost:",e.p2pid);var i=T.p2ps.get(e.p2pid);i&&(T.p2ps.delete(e.p2pid),i.local?T.dispatchEvent((0,d.ClientEvent)({type:"pubP2PLost",stream:i})):T.remoteStreams[i.getId()]&&T.dispatchEvent((0,d.ClientEvent)({type:"subP2PLost",stream:i})))}),T.socket.on("onTokenPrivilegeWillExpire",function(e){u.default.debug("Received Message onTokenPrivilegeWillExpire"),T.dispatchEvent((0,d.ClientEvent)({type:"onTokenPrivilegeWillExpire"}))}),T.socket.on("onTokenPrivilegeDidExpire",function(){u.default.warning("Received Message onTokenPrivilegeDidExpire, please get new token and join again"),T.dispatchEvent((0,d.ClientEvent)({type:"onTokenPrivilegeDidExpire"})),T.closeGateway()}),T._doWithAction=function(e,t,n){"tryNext"===e?function(e,t){u.default.debug("Connect next gateway"),T.state=E,T.socket.close(),C(),T.reconnectMode="tryNext",O(e,t)}(t,n):"retry"===e?function(e,t){u.default.debug("Reconnect gateway"),T.state=E,T.socket.close(),C(),T.reconnectMode="retry",O(e,t)}(t,n):"quit"===e?(u.default.debug("quit gateway"),T.state=E,T.socket.close(),C()):"recover"===e&&(u.default.debug("Reconnect gateway"),T.state=E,T.socket.close(),C(),T.reconnectMode="recover",O())},T.socket.on("notification",function(e){if(u.default.debug("Receive notification: ",e),"ERR_JOIN_BY_MULTI_IP"===c.GatewayErrorCode[e.code])return T.dispatchEvent({type:"onMultiIP",arg:e});e.detail?T._doWithAction(v.default[c.GatewayErrorCode[e.code]]):e.action&&T._doWithAction(e.action)}),T.socket.on("onPeerLeave",function(e){var t=(0,d.ClientEvent)({type:"peer-leave",uid:e.id});if(T.remoteStreamsInChannel.has(e.id)&&T.remoteStreamsInChannel.delete(e.id),T.remoteStreams.hasOwnProperty(e.id)&&(t.stream=T.remoteStreams[e.id]),T.dispatchEvent(t),T.remoteStreams.hasOwnProperty(e.id)){u.default.info("closing stream on peer leave",e.id);var n=T.remoteStreams[e.id];n.close(),delete T.remoteStreams[e.id],void 0!==n.pc&&(n.pc.close(),n.pc=void 0,T.p2ps.delete(n.p2pId))}T.timers.hasOwnProperty(e.id)&&(clearInterval(T.timers[e.id]),clearInterval(T.timers[e.id]+"_RelatedStats"),delete T.timers[e.id]),null!=T.audioLevel[e.id]&&delete T.audioLevel[e.id],null!=T.timer_counter[e.id]&&delete T.timer_counter[e.id]}),T.socket.on("onUplinkStats",function(e){}),T.socket.on("liveStreamingStarted",function(e){var t=(0,d.LiveStreamingEvent)({type:"liveStreamingStarted",url:e.url});T.dispatchEvent(t)}),T.socket.on("liveStreamingFailed",function(e){var t=(0,d.LiveStreamingEvent)({type:"liveStreamingFailed",url:e.url});T.dispatchEvent(t)}),T.socket.on("liveStreamingStopped",function(e){var t=(0,d.LiveStreamingEvent)({type:"liveStreamingStopped",url:e.url});T.dispatchEvent(t)}),T.socket.on("liveTranscodingUpdated",function(e){var t=(0,d.LiveStreamingEvent)({type:"liveTranscodingUpdated",reason:e.reason});T.dispatchEvent(t)}))},k=function(e,t,n){if(void 0===T.socket)return u.default.error("No socket available"),void A(n,l.default.INVALID_OPERATION);try{T.socket.emitSimpleMessage(e,function(e,i){"success"===e?"function"==typeof t&&t(i):"function"==typeof n&&n(c.GatewayErrorCode[i]||i)})}catch(t){u.default.error("Socket emit message failed"+JSON.stringify(e)),u.default.error(t),A(n,l.default.SOCKET_ERROR)}},M=function(e,t){if(void 0!==T.socket)try{T.socket.emitSimpleMessage(e,function(e,n){t&&t(e,n)})}catch(e){u.default.error("Error in sendSimpleSdp ["+e+"]")}else u.default.error("Error in sendSimpleSdp [socket not ready]")},D=function(){for(var e in T.localStreams)if(void 0!==T.localStreams[e]){var t=T.localStreams[e];delete T.localStreams[e],void 0!==t.pc&&(t.pc.close(),t.pc=void 0)}},L=function(){for(var e in T.remoteStreamsInChannel.clear(),T.remoteStreams)if(T.remoteStreams.hasOwnProperty(e)){var t=T.remoteStreams[e];t.isPlaying()&&t.stop(),t.close(),delete T.remoteStreams[e],void 0!==t.pc&&(t.pc.close(),t.pc=void 0)}};return T},S={_gatewayClients:{},register:function(e,t){var n,i=this;return t.uid?t.cname?i._gatewayClients[t.cname]&&i._gatewayClients[t.cname][t.uid]&&i._gatewayClients[t.cname][t.uid]!==e?(u.default.error(n="UID_CONFLICT",t),n):(u.default.debug("register client Channel",t.cname,"Uid",t.uid),i._gatewayClients[t.cname]||(i._gatewayClients[t.cname]={}),i._gatewayClients[t.cname][t.uid]=e,null):(u.default.error(n="NO_CHANNEL_PROVIDED",t),n):(u.default.error(n="NO_UID_PROVIDED",t),n)},unregister:function(e){var t,n=this,i=e&&e.uid,r=e.joinInfo&&e.joinInfo.cname;return i&&r?n._gatewayClients[r]&&n._gatewayClients[r][i]?n._gatewayClients[r][i]!==e?(u.default.error(t="GATEWAYCLIENT_UID_CONFLICT"),t):(u.default.debug("unregister client ",e.uid),delete n._gatewayClients[r][i],null):void u.default.error(t="GATEWEAY_CLIENT_UNREGISTERED"):(u.default.error(t="INVALID_GATEWAYCLIENT"),t)}};y.DISCONNECTED=0,y.CONNECTING=1,y.CONNECTED=2,y.DISCONNECTING=3,t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),r=i&&i.__esModule?i:{default:i},o=n(1);t.default=function(e,t){var n={connect:function(){t.host=e,n.signal=(0,r.default)(t),n.on=n.signal.on,n.dispatchEvent=n.signal.dispatchEvent,n.signal.on("onopen",function(e){n.signal.onEvent=function(e){n.dispatchEvent((0,o.MediaEvent)({type:e.event,msg:e}))},n.dispatchEvent((0,o.MediaEvent)({type:"connect",msg:e}))}),n.signal.on("onError",function(e){onError(e.msg.code,"error")})},disconnect:function(){n.signal.disconnect()},close:function(){n.signal.close()},getURL:function(){return n.signal.getURL()},reconnect:function(){n.signal.reconnect()},connectNext:function(){n.signal.connectNext()},replaceHost:function(e){n.signal.replaceHost(e)},emitSimpleMessage:function(e,t){n.signal.sendSignalCommand(e,t)}};return n.connect(),n}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=i(n(16)),a=i(n(0)),s=n(4);t.default=function(e){var t=(0,r.EventDispatcher)(e);return t.needReconnect=!0,t.isTimeout=!1,t.isInit=!0,t.hostIndex=0,t.requestID=0,t.host=e.host instanceof Array?e.host:[e.host],t.getURL=function(){return t.connection.url},t.reconnect=function(){t.isInit=!0,t.creatConnection()},t.connectNext=function(){t.isInit=!0,++t.hostIndex,a.default.debug("Gateway length:"+t.host.length+" current index:"+t.hostIndex),t.hostIndex>=t.host.length?t.dispatchEvent((0,r.MediaEvent)({type:"recover"})):t.creatConnection()},t.replaceHost=function(e){t.host=e||t.host,t.hostIndex=0,t.creatConnection()},t.creatConnection=function(){a.default.debug("start connect:"+t.host[t.hostIndex]),t.lts=(new Date).getTime(),t.connection=new WebSocket("wss://"+t.host[t.hostIndex]),t.connection.onopen=function(e){a.default.debug("websockect opened: "+t.host[t.hostIndex]),t.needReconnect=!0,t.isTimeout=!1,t.isInit=!1,clearTimeout(t.timeoutCheck),t.dispatchEvent((0,r.MediaEvent)({type:"onopen",event:e,socket:t}))},t.connection.onmessage=function(e){var n=JSON.parse(e.data);n.hasOwnProperty("_id")?t.dispatchEvent((0,r.MediaEvent)({type:n._id,msg:n})):n.hasOwnProperty("_type")&&t.dispatchSocketEvent((0,r.MediaEvent)({type:n._type,msg:n.message}))},t.connection.onclose=function(n){t.needReconnect?t.isTimeout||t.isInit?(a.default.debug("websockect connect timeout"),s.report.joinGateway(e.sid,{lts:t.lts,succ:!1,ec:"timeout",addr:t.connection.url}),t.connectNext()):t.dispatchEvent((0,r.MediaEvent)({type:"disconnect",event:n})):(a.default.debug("websockect closeed"),(0,o.default)(e.onFailure,n),clearTimeout(t.timeoutCheck),t.dispatchEvent((0,r.MediaEvent)({type:"close",event:n})),t.connection.onopen=void 0,t.connection.onclose=void 0,t.connection.onerror=void 0,t.connection.onmessage=void 0,t.connection=void 0)},t.connection.onerror=function(e){},setTimeout(function(){t.connection&&t.connection.readyState!=WebSocket.OPEN&&(t.isTimeout=!0,t.connection.close())},5e3)},t.creatConnection(),t.sendMessage=function(e,n){t.connection&&t.connection.readyState==WebSocket.OPEN?t.connection.send(JSON.stringify(e)):n({error:"Gateway not connected"})},t.disconnect=function(){t.needReconnect=!0,t.connection.close()},t.close=function(){t.needReconnect=!1,t.connection.onclose=void 0,t.connection.close()},t.sendSignalCommand=function(e,n){e._id="_request_"+t.requestID,t.requestID+=1,"publish_stats"!==e._type&&"subscribe_stats"!==e._type&&"publish_stats_low"!==e._type&&t.on(e._id,function(i){i.msg&&n&&n(i.msg._result,i.msg.message),delete t.dispatcher.eventListeners[e._id]}),t.sendMessage(e,function(e){e.reason="NOT_CONNECTED",n&&n(e.reason,e)})},t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={ERR_NO_VOCS_AVAILABLE:"tryNext",ERR_NO_VOS_AVAILABLE:"tryNext",ERR_JOIN_CHANNEL_TIMEOUT:"tryNext",WARN_REPEAT_JOIN:"quit",ERR_JOIN_BY_MULTI_IP:"recover",WARN_LOOKUP_CHANNEL_TIMEOUT:"tryNext",WARN_OPEN_CHANNEL_TIMEOUT:"tryNext",ERR_VOM_SERVICE_UNAVAILABLE:"tryNext",ERR_TOO_MANY_USERS:"tryNext",ERR_MASTER_VOCS_UNAVAILABLE:"tryNext",ERR_INTERNAL_ERROR:"tryNext",notification_test_recover:"recover",notification_test_tryNext:"tryNext",notification_test_retry:"retry"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simMap=void 0;var i=n(5);t.simMap=function(e){var t;switch(e){case"120p":case"120p_1":t=["120p_1","120p_1","120p_1"];break;case"120p_3":t=["120p_3","120p_3","120p_3"];break;case"180p":case"180p_1":t=["90p_1","90p_1","180p_1"];break;case"180p_3":t=["120p_3","120p_3","180p_3"];break;case"180p_4":t=["120p_1","120p_1","180p_4"];break;case"240p":case"240p_1":t=["120p_1","120p_1","240p_1"];break;case"240p_3":t=["120p_3","120p_3","240p_3"];break;case"240p_4":t=["120p_4","120p_4","240p_4"];break;case"360p":case"360p_1":case"360p_4":case"360p_9":case"360p_10":case"360p_11":t=["90p_1","90p_1","360p_1"];break;case"360p_3":case"360p_6":t=["120p_3","120p_3","360p_3"];break;case"360p_7":case"360p_8":t=["120p_1","120p_1","360p_7"];break;case"480p":case"480p_1":case"480p_2":case"480p_4":case"480p_10":t=["120p_1","120p_1","480p_1"];break;case"480p_3":case"480p_6":t=["120p_3","120p_3","480p_3"];break;case"480p_8":case"480p_9":t=["120p_4","120p_4","480p_8"];break;case"720p":case"720p_1":case"720p_2":case"720p_3":t=["90p_1","90p_1","720p_1"];break;case"720p_5":case"720p_6":t=["120p_1","120p_1","720p_5"];break;case"1080p":case"1080p_1":case"1080p_2":case"1080p_3":case"1080p_5":t=["90p_1","90p_1","1080p_1"];break;case"1440p":case"1440p_1":case"1440p_2":t=["90p_1","90p_1","1440p_1"];break;case"4k":case"4k_1":case"4k_3":t=["90p_1","90p_1","4k_1"];break;default:t=["120p_1","120p_1","360p_7"]}return(0,i.isOpera)()?[e,15,50]:(0,i.isFireFox)()?[t[1],15,100]:(0,i.isSafari)()?[t[2],15,50]:[t[0],15,50]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTCStatsCollector=void 0;var i=n(1),r=(n(0),n(14));t.RTCStatsCollector=function(e){var t=(0,i.EventDispatcher)();return t.gatewayClient=e,t.localStats={},t.remoteStats={},t.getRemoteAudioStats=function(e){var n={};for(var i in t.remoteStats){var o={},a=t.remoteStats[i];(0,r.setStat)(o,"End2EndDelay",a.peer_delay&&a.peer_delay.audio_delay),(0,r.setStat)(o,"TransportDelay",a.peer_delay&&a.peer_delay.e2e_delay),(0,r.setStat)(o,"PacketLossRate",a.peer_delay&&a.peer_delay.e2e_audio_lost_ratio_400ms),(0,r.setStat)(o,"RecvLevel",a.audioStats&&a.audioStats.totalAudioEnergy),(0,r.setStat)(o,"RecvBitrate",a.audioRecvBitrate),(0,r.setStat)(o,"CodecType",a.audioStats&&a.audioStats.googCodecName),(0,r.setStat)(o,"MuteState",a.audioDisabled),n[i]=o}e&&e(n)},t.getLocalAudioStats=function(e){var n={};for(var i in t.localStats){var o={},a=t.localStats[i];(0,r.setStat)(o,"RecordingLevel",a.audioStats&&a.audioStats.audioInputLevel),(0,r.setStat)(o,"SendLevel",a.audioStats&&a.audioStats.totalAudioEnergy),(0,r.setStat)(o,"SamplingRate",a.audioStats&&a.audioStats.totalSamplesDuration),(0,r.setStat)(o,"SendBitrate",a.audioSendBitrate),(0,r.setStat)(o,"CodecType",a.audioStats&&a.audioStats.googCodecName),(0,r.setStat)(o,"MuteState",a.audioDisabled),(0,r.setStat)(o,"SendBitrate",a.audioSendBitrate);var s=t.gatewayClient.localStreams[i];s&&s.isPlaying()&&(0,r.setStat)(o,"MuteState",s.audioEnabled?"0":"1"),n[i]=o}e&&e(n)},t.getRemoteVideoStats=function(e){var n={};for(var i in t.remoteStats){var o={},a=t.remoteStats[i];(0,r.setStat)(o,"End2EndDelay",a.peer_delay&&a.peer_delay.video_delay),(0,r.setStat)(o,"TransportDelay",a.peer_delay&&a.peer_delay.e2e_delay),(0,r.setStat)(o,"PacketLossRate",a.peer_delay&&a.peer_delay.e2e_video_lost_ratio_400ms),(0,r.setStat)(o,"RecvBitrate",a.videoRecvBitrate),(0,r.setStat)(o,"RecvResolutionWidth",a.videoStats&&a.videoStats.googFrameWidthReceived),(0,r.setStat)(o,"RecvResolutionHeight",a.videoStats&&a.videoStats.googFrameHeightReceived),(0,r.setStat)(o,"RenderFrameRate",a.videoStats&&a.videoStats.googFrameRateOutput),(0,r.setStat)(o,"MuteState",a.videoDisabled),n[i]=o}e&&e(n)},t.getLocalVideoStats=function(e){var n={};for(var i in t.localStats){var o={},a=t.localStats[i];(0,r.setStat)(o,"TargetSendBitrate",a.videoTargetSendBitrate),(0,r.setStat)(o,"SendFrameRate",a.videoStats&&a.videoStats.googFrameRateSent),(0,r.setStat)(o,"SendBitrate",a.videoSendBitrate),(0,r.setStat)(o,"SendResolutionWidth",a.videoStats&&a.videoStats.googFrameWidthSent),(0,r.setStat)(o,"SendResolutionHeight",a.videoStats&&a.videoStats.googFrameHeightSent),(0,r.setStat)(o,"EncodeDelay",a.videoStats&&a.videoStats.googAvgEncodeMs),(0,r.setStat)(o,"MuteState",a.videoDisabled),n[i]=o,e&&e(n)}},t.getTransportStats=function(e){var n={},i=t.gatewayClient.traffic_stats;(0,r.setStat)(n,"RTT",i&&i.access_delay),e&&e(n)},t.getStatsTimer=setInterval(function(){var e=t.gatewayClient.traffic_stats,n=Date.now(),i={};Object.keys(t.gatewayClient.remoteStreams).forEach(function(r){var o=t.gatewayClient.remoteStreams[r],a=t.remoteStats[r],s={id:r,updatedAt:n};i[r]=s;var d=e&&e.peer_delay&&e.peer_delay.find(function(e){return e.peer_uid==r});d&&(s.peer_delay=d),o&&(o.isPlaying()&&(s.audioDisabled=o.audioEnabled?"0":"1",s.videoDisabled=o.videoEnabled?"0":"1"),a&&a.peer_delay&&d&&a.peer_delay.stream_type!==d.stream_type&&t.gatewayClient.dispatchEvent({type:"streamTypeChange",uid:r,streamType:d.stream_type}),o.pc&&"established"==o.pc.state&&o.pc.getStats(function(e){if(s.pcStats=e,s.audioStats=e.find(function(e){return"audio"==e.mediaType}),s.videoStats=e.find(function(e){return"video"==e.mediaType}),a&&a.audioStats&&s.audioStats){var t=parseInt(s.audioStats.bytesReceived)-parseInt(a.audioStats.bytesReceived);if(isFinite(t)&&s.audioStats.timestamp){var n=s.audioStats.timestamp.getTime()-a.audioStats.timestamp.getTime();s.audioRecvBitrate=Math.floor(8*t/n)}}if(a&&a.videoStats&&s.videoStats){var i=parseInt(s.videoStats.bytesReceived)-parseInt(a.videoStats.bytesReceived);isFinite(i)&&s.videoStats.timestamp&&(n=s.videoStats.timestamp.getTime()-a.videoStats.timestamp.getTime(),s.videoRecvBitrate=Math.floor(8*i/n))}}))}),t.remoteStats=i;var r={};Object.keys(t.gatewayClient.localStreams).forEach(function(e){var i=t.gatewayClient.localStreams[e],o=t.localStats[e],a={id:e,updatedAt:n};r[e]=a,i&&(i.isPlaying()&&(a.audioDisabled=i.audioEnabled?"0":"1",a.videoDisabled=i.videoEnabled?"0":"1"),i.video&&i.attributes.maxVideoBW?a.videoTargetSendBitrate=i.attributes.maxVideoBW:i.video&&i.screenAttributes&&(a.videoTargetSendBitrate=i.screenAttributes.maxVideoBW),i.pc&&"established"==i.pc.state&&i.pc.getStats(function(e){if(a.pcStats=e,a.audioStats=e.find(function(e){return"audio"==e.mediaType&&e.id.indexOf("_send")>-1}),a.videoStats=e.find(function(e){return"video"==e.mediaType&&e.id.indexOf("_send")>-1}),a.audioStats&&o&&o.audioStats){var t=parseInt(a.audioStats.bytesSent)-parseInt(o.audioStats.bytesSent);if(isFinite(t)&&a.audioStats.timestamp){var n=a.audioStats.timestamp.getTime()-o.audioStats.timestamp.getTime();a.audioSendBitrate=Math.floor(8*t/n)}}if(a.videoStats&&o&&o.videoStats){var i=parseInt(a.videoStats.bytesSent)-parseInt(o.videoStats.bytesSent);isFinite(i)&&a.videoStats.timestamp&&(n=a.videoStats.timestamp.getTime()-o.videoStats.timestamp.getTime(),a.videoSendBitrate=Math.floor(8*i/n))}}))}),t.localStats=r},1e3),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.networkManager=void 0,n(0);var i=n(1),r=new function(){var e=(0,i.EventDispatcher)();return e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.type=null,e.lastConnectedAt=null,e.lastDisconnectedAt=null,e.lastTypeChangedAt=null,e.networkChangeTimer=null,e._init=function(t,n){if(e.state=e.states.INITING,navigator.connection&&navigator.connection.addEventListener){var i=e._getNetworkInfo();e.type=i&&i.type,e.state=e.states.INITED,t&&t()}else e.state=e.states.UNINIT,n&&n("DO_NOT_SUPPORT")},e._getNetworkInfo=function(){return navigator.connection},e._reloadNetworkInfo=function(){var t=e._getNetworkInfo(),n=t&&t.type||"UNSUPPORTED",i=Date.now();n!==e.type&&(e.lastTypeChangedAt=i,"none"==n?e.lastDisconnectedAt=i:"none"==e.type&&(e.lastConnectedAt=i),e.type=n,e.dispatchEvent({type:"networkTypeChanged",networkType:n}))},e.getStats=function(t,n){var i={},r=e._getNetworkInfo();r&&(i.NetworkType=r.type||"UNSUPPORTED"),setTimeout(function(){t(i)},0)},e._init(function(){navigator.connection.addEventListener("change",function(){e._reloadNetworkInfo()}),e.networkChangeTimer=setInterval(function(){e._reloadNetworkInfo()},5e3)},function(e){}),e};t.networkManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.systemManager=void 0;var i=n(0),r=i&&i.__esModule?i:{default:i},o=n(1),a=function(){};a.prototype.set=function(e,t){["BatteryLevel"].indexOf(e)>-1&&(this[e]=t)};var s=new function(){var e=(0,o.EventDispatcher)();return e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.batteryManager=null,e._init=function(t,n){e.state=e.states.INITING,navigator.getBattery?navigator.getBattery().then(function(n){e.batteryManager=n,t&&setTimeout(function(){t()},0)}).catch(function(e){r.default.debug("navigator.getBattery is disabled",e),t&&t()}):(e.state=e.states.INITED,t&&t())},e._getBatteryStats=function(){var t={};return t.BatteryLevel=e.batteryManager&&e.batteryManager.level?Math.floor(100*e.batteryManager.level):"UNSUPPORTED",t},e.getStats=function(t,n){var i=new a,r=e._getBatteryStats();r&&r.BatteryLevel&&i.set("BatteryLevel",r.BatteryLevel),t&&t(i)},e._init(),e};t.systemManager=s}]).default}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Signal=t():e.Signal=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,(function(t){return e[t]}).bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=47)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var d,u=[],c=!1,l=-1;function f(){c&&d&&(c=!1,d.length?u=d.concat(u):l=-1,u.length&&p())}function p(){if(!c){var e=s(f);c=!0;for(var t=u.length;t;){for(d=u,u=[];++l<t;)d&&d[l].run();l=-1,t=u.length}d=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new h(e,t)),1!==u.length||c||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var i=n(6),r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var o=n(5);o.inherits=n(2);var a=n(13),s=n(11);o.inherits(l,a);for(var d=r(s.prototype),u=0;u<d.length;u++){var c=d[u];l.prototype[c]||(l.prototype[c]=s.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||i.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),i.nextTick(t,e)}},function(e,t,n){"use strict";(function(e){var i=n(23),r=n(24),o=n(12);function a(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=d.prototype:(null===e&&(e=new d(t)),e.length=t),e}function d(e,t,n){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,n)}function u(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),d.TYPED_ARRAY_SUPPORT?(e=t).__proto__=d.prototype:e=f(e,t),e}(e,t,n,i):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!d.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|h(t,n),r=(e=s(e,i)).write(t,n);return r!==i&&(e=e.slice(0,r)),e}(e,t,n):function(e,t){if(d.isBuffer(t)){var n=0|p(t.length);return 0===(e=s(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?s(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(c(t),e=s(e,t<0?0:0|p(t)),!d.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=s(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function p(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function h(e,t){if(d.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(i)return F(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function m(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=d.from(t,i)),d.isBuffer(t))return 0===t.length?-1:_(e,t,n,i,r);if("number"==typeof t)return t&=255,d.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,i,r){var o,a=1,s=e.length,d=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,d/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var c=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===d)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(n+d>s&&(n=s-d),o=n;o>=0;o--){for(var l=!0,f=0;f<d;f++)if(u(e,o+f)!==u(t,f)){l=!1;break}if(l)return o}return-1}function v(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function y(e,t,n,i){return W(F(t,e.length-n),e,n,i)}function S(e,t,n,i){return W(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function b(e,t,n,i){return S(e,t,n,i)}function E(e,t,n,i){return W(j(t),e,n,i)}function w(e,t,n,i){return W(function(e,t){for(var n,i,r=[],o=0;o<e.length&&!((t-=2)<0);++o)i=(n=e.charCodeAt(o))>>8,r.push(n%256),r.push(i);return r}(t,e.length-n),e,n,i)}function I(e,t,n){return i.fromByteArray(0===t&&n===e.length?e:e.slice(t,n))}function R(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,a,s,d,u=e[r],c=null,l=u>239?4:u>223?3:u>191?2:1;if(r+l<=n)switch(l){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[r+1]))&&(d=(31&u)<<6|63&o)>127&&(c=d);break;case 3:a=e[r+2],128==(192&(o=e[r+1]))&&128==(192&a)&&(d=(15&u)<<12|(63&o)<<6|63&a)>2047&&(d<55296||d>57343)&&(c=d);break;case 4:a=e[r+2],s=e[r+3],128==(192&(o=e[r+1]))&&128==(192&a)&&128==(192&s)&&(d=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&d<1114112&&(c=d)}null===c?(c=65533,l=1):c>65535&&(i.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=l}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=T));return n}(i)}t.Buffer=d,t.SlowBuffer=function(e){return+e!=e&&(e=0),d.alloc(+e)},t.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),d.poolSize=8192,d._augment=function(e){return e.__proto__=d.prototype,e},d.from=function(e,t,n){return u(null,e,t,n)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0})),d.alloc=function(e,t,n){return function(e,t,n,i){return c(t),t<=0?s(e,t):void 0!==n?"string"==typeof i?s(e,t).fill(n,i):s(e,t).fill(n):s(e,t)}(null,e,t,n)},d.allocUnsafe=function(e){return l(null,e)},d.allocUnsafeSlow=function(e){return l(null,e)},d.isBuffer=function(e){return!(null==e||!e._isBuffer)},d.compare=function(e,t){if(!d.isBuffer(e)||!d.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},d.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return d.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=d.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(!d.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},d.byteLength=h,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},d.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},d.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},d.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?R(this,0,e):(function(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,n);case"utf8":case"utf-8":return R(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return I(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}).apply(this,arguments)},d.prototype.equals=function(e){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===d.compare(this,e)},d.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},d.prototype.compare=function(e,t,n,i,r){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),u=this.slice(i,r),c=e.slice(t,n),l=0;l<s;++l)if(u[l]!==c[l]){o=u[l],a=c[l];break}return o<a?-1:a<o?1:0},d.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},d.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},d.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},d.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return S(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return E(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function A(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function C(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function O(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=B(e[o]);return r}function N(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function k(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,i,r,o){if(!d.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function D(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function L(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function x(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function P(e,t,n,i,o){return o||x(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function U(e,t,n,i,o){return o||x(e,0,n,8),r.write(e,t,n,i,52,8),n+8}d.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),d.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=d.prototype;else{var r=t-e;n=new d(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+e]}return n},d.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},d.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},d.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},d.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},d.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},d.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},d.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},d.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},d.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},d.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},d.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},d.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},d.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),r.read(this,e,!0,23,4)},d.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),r.read(this,e,!1,23,4)},d.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),r.read(this,e,!0,52,8)},d.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),r.read(this,e,!1,52,8)},d.prototype.writeUIntLE=function(e,t,n,i){e=+e,t|=0,n|=0,i||M(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},d.prototype.writeUIntBE=function(e,t,n,i){e=+e,t|=0,n|=0,i||M(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},d.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,255,0),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},d.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},d.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},d.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},d.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},d.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);M(this,e,t,n,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},d.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);M(this,e,t,n,r-1,-r)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},d.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,127,-128),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},d.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},d.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},d.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},d.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},d.prototype.writeFloatLE=function(e,t,n){return P(this,e,t,!0,n)},d.prototype.writeFloatBE=function(e,t,n){return P(this,e,t,!1,n)},d.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},d.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},d.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!d.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},d.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!d.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=d.isBuffer(e)?e:F(new d(e,i).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function j(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(V,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(0))},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(4).Buffer)},function(e,t,n){"use strict";(function(t){e.exports=!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?{nextTick:function(e,n,i,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,i)});case 4:return t.nextTick(function(){e.call(null,n,i,r)});default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return t.nextTick(function(){e.apply(null,o)})}}}:t}).call(this,n(1))},function(e,t,n){var i=n(4),r=i.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(o(i,t),t.Buffer=a),o(r,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)a.set(o=e[t],r),r+=o.length;return a}},a={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(i)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,a,s,d,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(o(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(r(n))for(s=Array.prototype.slice.call(arguments,1),a=(u=n.slice()).length,d=0;d<a;d++)u[d].apply(this,s);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var a;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(a=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var n,o,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(n=this._events[e]).length,o=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){(t=e.exports=n(13)).Stream=t,t.Readable=t,t.Writable=n(11),t.Duplex=n(3),t.Transform=n(17),t.PassThrough=n(32)},function(e,t,n){"use strict";(function(t,i,r){var o=n(6);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;for(e.entry=null;i;){var r=i.callback;t.pendingcb--,r(void 0),i=i.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=v;var s,d=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?i:o.nextTick;v.WritableState=_;var u=n(5);u.inherits=n(2);var c,l={deprecate:n(31)},f=n(14),p=n(7).Buffer,h=r.Uint8Array||function(){},g=n(15);function m(){}function _(e,t){s=s||n(3);var i=t instanceof s;this.objectMode=!!(e=e||{}).objectMode,i&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,u=e.writableHighWaterMark;this.highWaterMark=r||0===r?r:i&&(u||0===u)?u:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1,this.decodeStrings=!(!1===e.decodeStrings),this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,r){--t.pendingcb,n?(o.nextTick(r,i),o.nextTick(I,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(r(i),e._writableState.errorEmitted=!0,e.emit("error",i),I(e,t))}(e,n,i,t,r);else{var a=E(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||b(e,n),i?d(S,e,n,a,r):S(e,n,a,r)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function v(e){if(s=s||n(3),!(c.call(v,this)||this instanceof s))return new v(e);this._writableState=new _(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),f.call(this)}function y(e,t,n,i,r,o,a){t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function S(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),I(e,t)}function b(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=new Array(t.bufferedRequestCount),r=t.corkedRequestsFree;r.entry=n;for(var o=0,s=!0;n;)i[o]=n,n.isBuf||(s=!1),n=n.next,o+=1;i.allBuffers=s,y(e,t,!0,t.length,i,"",r.finish),t.pendingcb++,t.lastBufferedRequest=null,r.next?(t.corkedRequestsFree=r.next,r.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;n;){var d=n.chunk;if(y(e,t,!1,t.objectMode?1:d.length,d,n.encoding,n.callback),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function E(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function w(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),I(e,t)})}function I(e,t){var n=E(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(w,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}u.inherits(v,f),_.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(_.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===v&&e&&e._writableState instanceof _}})):c=function(e){return e instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(e,t,n){var i=this._writableState,r=!1,a=!i.objectMode&&function(e){return p.isBuffer(e)||e instanceof h}(e);return a&&!p.isBuffer(e)&&(e=function(e){return p.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=m),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(a||function(e,t,n,i){var r=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),o.nextTick(i,a),r=!1),r}(this,i,e,n))&&(i.pendingcb++,r=function(e,t,n,i,r,o){if(!n){var a=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=p.from(t,r)),t}(t,i);i!==a&&(n=!0,r="buffer",i=a)}var s=t.objectMode?1:i.length;t.length+=s;var d=t.length<t.highWaterMark;if(d||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else y(e,t,!1,s,i,r,o);return d}(this,i,a,e,t,n)),r},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||b(this,e))},v.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,I(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,i,n)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(1),n(29).setImmediate,n(0))},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";(function(t,i){var r=n(6);e.exports=y;var o,a=n(12);y.ReadableState=v,n(9);var s=function(e,t){return e.listeners(t).length},d=n(14),u=n(7).Buffer,c=t.Uint8Array||function(){},l=n(5);l.inherits=n(2);var f=n(26),p=void 0;p=f&&f.debuglog?f.debuglog("stream"):function(){};var h,g=n(27),m=n(15);l.inherits(y,d);var _=["error","close","destroy","pause","resume"];function v(e,t){var i=t instanceof(o=o||n(3));this.objectMode=!!(e=e||{}).objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,a=e.readableHighWaterMark;this.highWaterMark=r||0===r?r:i&&(a||0===a)?a:this.objectMode?16:16384,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(h||(h=n(16).StringDecoder),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function y(e){if(o=o||n(3),!(this instanceof y))return new y(e);this._readableState=new v(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),d.call(this)}function S(e,t,n,i,r){var o,a=e._readableState;return null===t?(a.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,I(e)}}(e,a)):(r||(o=function(e,t){var n;return function(e){return u.isBuffer(e)||e instanceof c}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(a,t)),o?e.emit("error",o):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=u.from(t)),i?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):b(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?b(e,a,t,!1):T(e,a)):b(e,a,t,!1))):i||(a.reading=!1)),!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function b(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&I(e)),T(e,t)}Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.push(null),t(e)},y.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=u.from(e,t),t=""),n=!0),S(this,e,t,!1,n)},y.prototype.unshift=function(e){return S(this,e,null,!0,!1)},y.prototype.isPaused=function(){return!1===this._readableState.flowing},y.prototype.setEncoding=function(e){return h||(h=n(16).StringDecoder),this._readableState.decoder=new h(e),this._readableState.encoding=e,this};var E=8388608;function w(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=E?e=E:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function I(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(p("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(R,e):R(e))}function R(e){p("emit readable"),e.emit("readable"),N(e)}function T(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(A,e,t))}function A(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(p("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function C(e){p("readable nexttick read 0"),e.read(0)}function O(e,t){t.reading||(p("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),N(e),t.flowing&&!t.reading&&e.read(0)}function N(e){var t=e._readableState;for(p("flow",t.flowing);t.flowing&&null!==e.read(););}function k(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;return e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,r=n.data;for(e-=r.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(r+=a===o.length?o:o.slice(0,e),0==(e-=a)){a===o.length?(++i,t.head=n.next?n.next:t.tail=null):(t.head=n,n.data=o.slice(a));break}++i}return t.length-=i,r}(e,t):function(e,t){var n=u.allocUnsafe(e),i=t.head,r=1;for(i.data.copy(n),e-=i.data.length;i=i.next;){var o=i.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),0==(e-=a)){a===o.length?(++r,t.head=i.next?i.next:t.tail=null):(t.head=i,i.data=o.slice(a));break}++r}return t.length-=r,n}(e,t),i}(e,t.buffer,t.decoder),n);var n}function M(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(D,t,e))}function D(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function L(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}y.prototype.read=function(e){p("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return p("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?M(this):I(this),null;if(0===(e=w(e,t))&&t.ended)return 0===t.length&&M(this),null;var i,r=t.needReadable;return p("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&p("length less than watermark",r=!0),t.ended||t.reading?p("reading or ended",r=!1):r&&(p("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=w(n,t))),null===(i=e>0?k(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&M(this)),null!==i&&this.emit("data",i),i},y.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},y.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,p("pipe count=%d opts=%j",o.pipesCount,t);var d=t&&!1===t.end||e===i.stdout||e===i.stderr?v:u;function u(){p("onend"),e.end()}o.endEmitted?r.nextTick(d):n.once("end",d),e.on("unpipe",function t(i,r){p("onunpipe"),i===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,p("cleanup"),e.removeListener("close",m),e.removeListener("finish",_),e.removeListener("drain",c),e.removeListener("error",g),e.removeListener("unpipe",t),n.removeListener("end",u),n.removeListener("end",v),n.removeListener("data",h),l=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||c())});var c=function(e){return function(){var t=e._readableState;p("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,N(e))}}(n);e.on("drain",c);var l=!1,f=!1;function h(t){p("ondata"),f=!1,!1!==e.write(t)||f||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==L(o.pipes,e))&&!l&&(p("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,f=!0),n.pause())}function g(t){p("onerror",t),v(),e.removeListener("error",g),0===s(e,"error")&&e.emit("error",t)}function m(){e.removeListener("finish",_),v()}function _(){p("onfinish"),e.removeListener("close",m),v()}function v(){p("unpipe"),n.unpipe(e)}return n.on("data",h),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?a(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",m),e.once("finish",_),e.emit("pipe",n),o.flowing||(p("pipe resume"),n.resume()),e},y.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<r;o++)i[o].emit("unpipe",this,n);return this}var a=L(t.pipes,e);return-1===a?this:(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},y.prototype.addListener=y.prototype.on=function(e,t){var n=d.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&I(this):r.nextTick(C,this))}return n},y.prototype.resume=function(){var e=this._readableState;return e.flowing||(p("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(O,e,t))}(this,e)),this},y.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},y.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var r in e.on("end",function(){if(p("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(r){p("wrapped data"),n.decoder&&(r=n.decoder.write(r)),(!n.objectMode||null!=r)&&(n.objectMode||r&&r.length)&&(t.push(r)||(i=!0,e.pause()))}),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var o=0;o<_.length;o++)e.on(_[o],this.emit.bind(this,_[o]));return this._read=function(t){p("wrapped _read",t),i&&(i=!1,e.resume())},this},Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),y._fromList=k}).call(this,n(0),n(1))},function(e,t,n){e.exports=n(9).EventEmitter},function(e,t,n){"use strict";var i=n(6);function r(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this;return this._readableState&&this._readableState.destroyed||this._writableState&&this._writableState.destroyed?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(r,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(i.nextTick(r,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";var i=n(7).Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=d,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=l,t=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"\ufffd";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function d(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd":t},o.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=a(t[i]);return r>=0?(r>0&&(e.lastNeed=r-1),r):--i<n||-2===r?0:(r=a(t[i]))>=0?(r>0&&(e.lastNeed=r-2),r):--i<n||-2===r?0:(r=a(t[i]))>=0?(r>0&&(2===r?r=0:e.lastNeed=r-3),r):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=o;var i=n(3),r=n(5);function o(e){if(!(this instanceof o))return new o(e);i.call(this,e),this._transformState={afterTransform:(function(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}).bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){s(e,t,n)}):s(this,null,null)}function s(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}r.inherits=n(2),r.inherits(o,i),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,i.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;i.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){"use strict";(function(t){function i(e,t){if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0}function r(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=n(19),a=Object.prototype.hasOwnProperty,s=Array.prototype.slice,d="foo"===(function(){}).name;function u(e){return Object.prototype.toString.call(e)}function c(e){return!r(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var l=e.exports=_,f=/\s*function\s+([^\(\s]*)\s*/;function p(e){if(o.isFunction(e)){if(d)return e.name;var t=e.toString().match(f);return t&&t[1]}}function h(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function g(e){if(d||!o.isFunction(e))return o.inspect(e);var t=p(e);return"[Function"+(t?": "+t:"")+"]"}function m(e,t,n,i,r){throw new l.AssertionError({message:n,actual:e,expected:t,operator:i,stackStartFunction:r})}function _(e,t){e||m(e,!0,t,"==",l.ok)}function v(e,t,n,a){if(e===t)return!0;if(r(e)&&r(t))return 0===i(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(c(e)&&c(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(r(e)!==r(t))return!1;var d=(a=a||{actual:[],expected:[]}).actual.indexOf(e);return-1!==d&&d===a.expected.indexOf(t)||(a.actual.push(e),a.expected.push(t),function(e,t,n,i){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var r=y(e),a=y(t);if(r&&!a||!r&&a)return!1;if(r)return v(e=s.call(e),t=s.call(t),n);var d,u,c=E(e),l=E(t);if(c.length!==l.length)return!1;for(c.sort(),l.sort(),u=c.length-1;u>=0;u--)if(c[u]!==l[u])return!1;for(u=c.length-1;u>=0;u--)if(!v(e[d=c[u]],t[d],n,i))return!1;return!0}(e,t,n,a))}return n?e===t:e==t}function y(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function S(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function b(e,t,n,i){var r;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(i=n,n=null),r=function(e){var t;try{e()}catch(e){t=e}return t}(t),i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),e&&!r&&m(r,n,"Missing expected exception"+i);var a="string"==typeof i,s=!e&&r&&!n;if((!e&&o.isError(r)&&a&&S(r,n)||s)&&m(r,n,"Got unwanted exception"+i),e&&r&&n&&!S(r,n)||!e&&r)throw r}l.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return h(g(e.actual),128)+" "+e.operator+" "+h(g(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||m;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var i=n.stack,r=p(t),o=i.indexOf("\n"+r);if(o>=0){var a=i.indexOf("\n",o+1);i=i.substring(a+1)}this.stack=i}}},o.inherits(l.AssertionError,Error),l.fail=m,l.ok=_,l.equal=function(e,t,n){e!=t&&m(e,t,n,"==",l.equal)},l.notEqual=function(e,t,n){e==t&&m(e,t,n,"!=",l.notEqual)},l.deepEqual=function(e,t,n){v(e,t,!1)||m(e,t,n,"deepEqual",l.deepEqual)},l.deepStrictEqual=function(e,t,n){v(e,t,!0)||m(e,t,n,"deepStrictEqual",l.deepStrictEqual)},l.notDeepEqual=function(e,t,n){v(e,t,!1)&&m(e,t,n,"notDeepEqual",l.notDeepEqual)},l.notDeepStrictEqual=function e(t,n,i){v(t,n,!0)&&m(t,n,i,"notDeepStrictEqual",e)},l.strictEqual=function(e,t,n){e!==t&&m(e,t,n,"===",l.strictEqual)},l.notStrictEqual=function(e,t,n){e===t&&m(e,t,n,"!==",l.notStrictEqual)},l.throws=function(e,t,n){b(!0,e,t,n)},l.doesNotThrow=function(e,t,n){b(!1,e,t,n)},l.ifError=function(e){if(e)throw e};var E=Object.keys||function(e){var t=[];for(var n in e)a.call(e,n)&&t.push(n);return t}}).call(this,n(0))},function(e,t,n){(function(e,i){var r=/%[sdj%]/g;t.format=function(e){if(!_(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,o=i.length,a=String(e).replace(r,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),d=i[n];n<o;d=i[++n])g(d)||!S(d)?a+=" "+d:a+=" "+s(d);return a},t.deprecate=function(n,r){if(v(e.process))return function(){return t.deprecate(n,r).apply(this,arguments)};if(!0===i.noDeprecation)return n;var o=!1;return function(){if(!o){if(i.throwDeprecation)throw new Error(r);i.traceDeprecation?console.trace(r):console.error(r),o=!0}return n.apply(this,arguments)}};var o,a={};function s(e,n){var i={seen:[],stylize:u};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),h(n)?i.showHidden=n:n&&t._extend(i,n),v(i.showHidden)&&(i.showHidden=!1),v(i.depth)&&(i.depth=2),v(i.colors)&&(i.colors=!1),v(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=d),c(i,e,i.depth)}function d(e,t){var n=s.styles[t];return n?"\x1b["+s.colors[n][0]+"m"+e+"\x1b["+s.colors[n][1]+"m":e}function u(e,t){return e}function c(e,n,i){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(i,e);return _(r)||(r=c(e,r,i)),r}var o=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(_(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):h(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(e,n);if(o)return o;var a=Object.keys(n),s=function(e){var t={};return a.forEach(function(e,n){t[e]=!0}),t}();if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),E(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(n);if(0===a.length){if(w(n))return e.stylize("[Function"+(n.name?": "+n.name:"")+"]","special");if(y(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return e.stylize(Date.prototype.toString.call(n),"date");if(E(n))return l(n)}var d,u="",S=!1,I=["{","}"];return p(n)&&(S=!0,I=["[","]"]),w(n)&&(u=" [Function"+(n.name?": "+n.name:"")+"]"),y(n)&&(u=" "+RegExp.prototype.toString.call(n)),b(n)&&(u=" "+Date.prototype.toUTCString.call(n)),E(n)&&(u=" "+l(n)),0!==a.length||S&&0!=n.length?i<0?y(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),d=S?function(e,t,n,i,r){for(var o=[],a=0,s=t.length;a<s;++a)A(t,String(a))?o.push(f(e,t,n,i,String(a),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(f(e,t,n,i,r,!0))}),o}(e,n,i,s,a):a.map(function(t){return f(e,n,i,s,t,S)}),e.seen.pop(),function(e,t,n){return e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(d,u,I)):I[0]+u+I[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,i,r,o){var a,s,d;if((d=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=e.stylize(d.set?"[Getter/Setter]":"[Getter]","special"):d.set&&(s=e.stylize("[Setter]","special")),A(i,r)||(a="["+r+"]"),s||(e.seen.indexOf(d.value)<0?(s=g(n)?c(e,d.value,null):c(e,d.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),v(a)){if(o&&r.match(/^\d+$/))return s;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function p(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function _(e){return"string"==typeof e}function v(e){return void 0===e}function y(e){return S(e)&&"[object RegExp]"===I(e)}function S(e){return"object"==typeof e&&null!==e}function b(e){return S(e)&&"[object Date]"===I(e)}function E(e){return S(e)&&("[object Error]"===I(e)||e instanceof Error)}function w(e){return"function"==typeof e}function I(e){return Object.prototype.toString.call(e)}function R(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(v(o)&&(o=i.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var n=i.pid;a[e]=function(){var i=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,i)}}else a[e]=function(){};return a[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=h,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=_,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=v,t.isRegExp=y,t.isObject=S,t.isDate=b,t.isError=E,t.isFunction=w,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(38);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",function(){var e=new Date,t=[R(e.getHours()),R(e.getMinutes()),R(e.getSeconds())].join(":");return[e.getDate(),T[e.getMonth()],t].join(" ")}(),t.format.apply(t,arguments))},t.inherits=n(2),t._extend=function(e,t){if(!t||!S(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,n(0),n(1))},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}},function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,r){var o=i,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},function(e,t,n){"use strict";(function(e){var i=n(4).Buffer,r=n(25).Transform,o=n(37),a=n(19),s=n(18).ok,d=n(4).kMaxLength,u="Cannot create final Buffer. It would be larger than 0x"+d.toString(16)+" bytes";o.Z_MIN_WINDOWBITS=8,o.Z_MAX_WINDOWBITS=15,o.Z_DEFAULT_WINDOWBITS=15,o.Z_MIN_CHUNK=64,o.Z_MAX_CHUNK=1/0,o.Z_DEFAULT_CHUNK=16384,o.Z_MIN_MEMLEVEL=1,o.Z_MAX_MEMLEVEL=9,o.Z_DEFAULT_MEMLEVEL=8,o.Z_MIN_LEVEL=-1,o.Z_MAX_LEVEL=9,o.Z_DEFAULT_LEVEL=o.Z_DEFAULT_COMPRESSION;for(var c=Object.keys(o),l=0;l<c.length;l++){var f=c[l];f.match(/^Z/)&&Object.defineProperty(t,f,{enumerable:!0,value:o[f],writable:!1})}for(var p={Z_OK:o.Z_OK,Z_STREAM_END:o.Z_STREAM_END,Z_NEED_DICT:o.Z_NEED_DICT,Z_ERRNO:o.Z_ERRNO,Z_STREAM_ERROR:o.Z_STREAM_ERROR,Z_DATA_ERROR:o.Z_DATA_ERROR,Z_MEM_ERROR:o.Z_MEM_ERROR,Z_BUF_ERROR:o.Z_BUF_ERROR,Z_VERSION_ERROR:o.Z_VERSION_ERROR},h=Object.keys(p),g=0;g<h.length;g++){var m=h[g];p[p[m]]=m}function _(e,t,n){var r=[],o=0;function a(){for(var t;null!==(t=e.read());)r.push(t),o+=t.length;e.once("readable",a)}function s(){var t,a=null;o>=d?a=new RangeError(u):t=i.concat(r,o),r=[],e.close(),n(a,t)}e.on("error",function(t){e.removeListener("end",s),e.removeListener("readable",a),n(t)}),e.on("end",s),e.end(t),a()}function v(e,t){if("string"==typeof t&&(t=i.from(t)),!i.isBuffer(t))throw new TypeError("Not a string or buffer");return e._processChunk(t,e._finishFlushFlag)}function y(e){if(!(this instanceof y))return new y(e);A.call(this,e,o.DEFLATE)}function S(e){if(!(this instanceof S))return new S(e);A.call(this,e,o.INFLATE)}function b(e){if(!(this instanceof b))return new b(e);A.call(this,e,o.GZIP)}function E(e){if(!(this instanceof E))return new E(e);A.call(this,e,o.GUNZIP)}function w(e){if(!(this instanceof w))return new w(e);A.call(this,e,o.DEFLATERAW)}function I(e){if(!(this instanceof I))return new I(e);A.call(this,e,o.INFLATERAW)}function R(e){if(!(this instanceof R))return new R(e);A.call(this,e,o.UNZIP)}function T(e){return e===o.Z_NO_FLUSH||e===o.Z_PARTIAL_FLUSH||e===o.Z_SYNC_FLUSH||e===o.Z_FULL_FLUSH||e===o.Z_FINISH||e===o.Z_BLOCK}function A(e,n){var a=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,r.call(this,e),e.flush&&!T(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!T(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||o.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:o.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!i.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new o.Zlib(n);var s=this;this._hadError=!1,this._handle.onerror=function(e,n){C(s),s._hadError=!0;var i=new Error(e);i.errno=n,i.code=t.codes[n],s.emit("error",i)};var d=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(d=e.level);var u=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(u=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,d,e.memLevel||t.Z_DEFAULT_MEMLEVEL,u,e.dictionary),this._buffer=i.allocUnsafe(this._chunkSize),this._offset=0,this._level=d,this._strategy=u,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!a._handle},configurable:!0,enumerable:!0})}function C(t,n){n&&e.nextTick(n),t._handle&&(t._handle.close(),t._handle=null)}function O(e){e.emit("close")}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(p),writable:!1}),t.Deflate=y,t.Inflate=S,t.Gzip=b,t.Gunzip=E,t.DeflateRaw=w,t.InflateRaw=I,t.Unzip=R,t.createDeflate=function(e){return new y(e)},t.createInflate=function(e){return new S(e)},t.createDeflateRaw=function(e){return new w(e)},t.createInflateRaw=function(e){return new I(e)},t.createGzip=function(e){return new b(e)},t.createGunzip=function(e){return new E(e)},t.createUnzip=function(e){return new R(e)},t.deflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),_(new y(t),e,n)},t.deflateSync=function(e,t){return v(new y(t),e)},t.gzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),_(new b(t),e,n)},t.gzipSync=function(e,t){return v(new b(t),e)},t.deflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),_(new w(t),e,n)},t.deflateRawSync=function(e,t){return v(new w(t),e)},t.unzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),_(new R(t),e,n)},t.unzipSync=function(e,t){return v(new R(t),e)},t.inflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),_(new S(t),e,n)},t.inflateSync=function(e,t){return v(new S(t),e)},t.gunzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),_(new E(t),e,n)},t.gunzipSync=function(e,t){return v(new E(t),e)},t.inflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),_(new I(t),e,n)},t.inflateRawSync=function(e,t){return v(new I(t),e)},a.inherits(A,r),A.prototype.params=function(n,i,r){if(n<t.Z_MIN_LEVEL||n>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+n);if(i!=t.Z_FILTERED&&i!=t.Z_HUFFMAN_ONLY&&i!=t.Z_RLE&&i!=t.Z_FIXED&&i!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+i);if(this._level!==n||this._strategy!==i){var a=this;this.flush(o.Z_SYNC_FLUSH,function(){s(a._handle,"zlib binding closed"),a._handle.params(n,i),a._hadError||(a._level=n,a._strategy=i,r&&r())})}else e.nextTick(r)},A.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},A.prototype._flush=function(e){this._transform(i.alloc(0),"",e)},A.prototype.flush=function(t,n){var r=this,a=this._writableState;("function"==typeof t||void 0===t&&!n)&&(n=t,t=o.Z_FULL_FLUSH),a.ended?n&&e.nextTick(n):a.ending?n&&this.once("end",n):a.needDrain?n&&this.once("drain",function(){return r.flush(t,n)}):(this._flushFlag=t,this.write(i.alloc(0),"",n))},A.prototype.close=function(t){C(this,t),e.nextTick(O,this)},A.prototype._transform=function(e,t,n){var r,a=this._writableState,s=(a.ending||a.ended)&&(!e||a.length===e.length);return null===e||i.isBuffer(e)?this._handle?(s?r=this._finishFlushFlag:(r=this._flushFlag,e.length>=a.length&&(this._flushFlag=this._opts.flush||o.Z_NO_FLUSH)),void this._processChunk(e,r,n)):n(new Error("zlib binding closed")):n(new Error("invalid input"))},A.prototype._processChunk=function(e,t,n){var r=e&&e.length,o=this._chunkSize-this._offset,a=0,c=this,l="function"==typeof n;if(!l){var f,p=[],h=0;this.on("error",function(e){f=e}),s(this._handle,"zlib binding closed");do{var g=this._handle.writeSync(t,e,a,r,this._buffer,this._offset,o)}while(!this._hadError&&v(g[0],g[1]));if(this._hadError)throw f;if(h>=d)throw C(this),new RangeError(u);var m=i.concat(p,h);return C(this),m}s(this._handle,"zlib binding closed");var _=this._handle.write(t,e,a,r,this._buffer,this._offset,o);function v(d,u){if(this&&(this.buffer=null,this.callback=null),!c._hadError){var f=o-u;if(s(f>=0,"have should not go down"),f>0){var g=c._buffer.slice(c._offset,c._offset+f);c._offset+=f,l?c.push(g):(p.push(g),h+=g.length)}if((0===u||c._offset>=c._chunkSize)&&(o=c._chunkSize,c._offset=0,c._buffer=i.allocUnsafe(c._chunkSize)),0===u){if(a+=r-d,r=d,!l)return!0;var m=c._handle.write(t,e,a,r,c._buffer,c._offset,c._chunkSize);return m.callback=v,void(m.buffer=e)}if(!l)return!1;n()}}_.buffer=e,_.callback=v},a.inherits(y,A),a.inherits(S,A),a.inherits(b,A),a.inherits(E,A),a.inherits(w,A),a.inherits(I,A),a.inherits(R,A)}).call(this,n(1))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[1];return 3*(t[0]+n)/4-n},t.toByteArray=function(e){for(var t,n=u(e),i=n[0],a=n[1],s=new o(3*(i+a)/4-a),d=0,c=a>0?i-4:i,l=0;l<c;l+=4)t=r[e.charCodeAt(l)]<<18|r[e.charCodeAt(l+1)]<<12|r[e.charCodeAt(l+2)]<<6|r[e.charCodeAt(l+3)],s[d++]=t>>16&255,s[d++]=t>>8&255,s[d++]=255&t;return 2===a&&(t=r[e.charCodeAt(l)]<<2|r[e.charCodeAt(l+1)]>>4,s[d++]=255&t),1===a&&(t=r[e.charCodeAt(l)]<<10|r[e.charCodeAt(l+1)]<<4|r[e.charCodeAt(l+2)]>>2,s[d++]=t>>8&255,s[d++]=255&t),s},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,o=[],a=0,s=n-r;a<s;a+=16383)o.push(l(e,a,a+16383>s?s:a+16383));return 1===r?o.push(i[(t=e[n-1])>>2]+i[t<<4&63]+"=="):2===r&&o.push(i[(t=(e[n-2]<<8)+e[n-1])>>10]+i[t>>4&63]+i[t<<2&63]+"="),o.join("")};for(var i=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,d=a.length;s<d;++s)i[s]=a[s],r[a.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e){return i[e>>18&63]+i[e>>12&63]+i[e>>6&63]+i[63&e]}function l(e,t,n){for(var i=[],r=t;r<n;r+=3)i.push(c((e[r]<<16&16711680)+(e[r+1]<<8&65280)+(255&e[r+2])));return i.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,r){var o,a,s=8*r-i-1,d=(1<<s)-1,u=d>>1,c=-7,l=n?r-1:0,f=n?-1:1,p=e[t+l];for(l+=f,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+l],l+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+e[t+l],l+=f,c-=8);if(0===o)o=1-u;else{if(o===d)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),o-=u}return(p?-1:1)*a*Math.pow(2,o-i)},t.write=function(e,t,n,i,r,o){var a,s,d,u=8*o-r-1,c=(1<<u)-1,l=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,h=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(d=Math.pow(2,-a))<1&&(a--,d*=2),(t+=a+l>=1?f/d:f*Math.pow(2,1-l))*d>=2&&(a++,d/=2),a+l>=c?(s=0,a=c):a+l>=1?(s=(t*d-1)*Math.pow(2,r),a+=l):(s=t*Math.pow(2,l-1)*Math.pow(2,r),a=0));r>=8;e[n+p]=255&s,p+=h,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[n+p]=255&a,p+=h,a/=256,u-=8);e[n+p-h]|=128*g}},function(e,t,n){e.exports=r;var i=n(9).EventEmitter;function r(){i.call(this)}n(2)(r,i),r.Readable=n(10),r.Writable=n(33),r.Duplex=n(34),r.Transform=n(35),r.PassThrough=n(36),r.Stream=r,r.prototype.pipe=function(e,t){var n=this;function r(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",r),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",d));var a=!1;function s(){a||(a=!0,e.end())}function d(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===i.listenerCount(this,"error"))throw e}function c(){n.removeListener("data",r),e.removeListener("drain",o),n.removeListener("end",s),n.removeListener("close",d),n.removeListener("error",u),e.removeListener("error",u),n.removeListener("end",c),n.removeListener("close",c),e.removeListener("close",c)}return n.on("error",u),e.on("error",u),n.on("end",c),n.on("close",c),e.on("close",c),e.emit("pipe",n),e}},function(e,t){},function(e,t,n){"use strict";var i=n(7).Buffer,r=n(28);function o(e,t,n){e.copy(t,n)}e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,r=0;n;)o(n.data,t,r),r+=n.data.length,n=n.next;return t},e}(),r&&r.inspect&&r.inspect.custom&&(e.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(30),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r=1,o={},a=!1,s=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){c(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&c(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),i=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){c(e.data)},i=function(t){e.port2.postMessage(t)}}():s&&"onreadystatechange"in s.createElement("script")?function(){var e=s.documentElement;i=function(t){var n=s.createElement("script");n.onreadystatechange=function(){c(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():i=function(e){setTimeout(c,0,e)},d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return o[r]={callback:e,args:t},i(r),r++},d.clearImmediate=u}function u(e){delete o[e]}function c(e){if(a)setTimeout(c,0,e);else{var t=o[e];if(t){a=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}(t)}finally{u(e),a=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(1))},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var i=!1;return function(){if(!i){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){"use strict";e.exports=o;var i=n(17),r=n(5);function o(e){if(!(this instanceof o))return new o(e);i.call(this,e)}r.inherits=n(2),r.inherits(o,i),o.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){e.exports=n(11)},function(e,t,n){e.exports=n(3)},function(e,t,n){e.exports=n(10).Transform},function(e,t,n){e.exports=n(10).PassThrough},function(e,t,n){"use strict";(function(e,i){var r=n(18),o=n(39),a=n(40),s=n(43),d=n(46);for(var u in d)t[u]=d[u];function c(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7,c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,r(this.init_done,"close before init"),r(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?a.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},c.prototype.write=function(e,t,n,i,r,o,a){return this._write(!0,e,t,n,i,r,o,a)},c.prototype.writeSync=function(e,t,n,i,r,o,a){return this._write(!1,e,t,n,i,r,o,a)},c.prototype._write=function(n,o,a,s,d,u,c,l){if(r.equal(arguments.length,8),r(this.init_done,"write before init"),r(this.mode!==t.NONE,"already finalized"),r.equal(!1,this.write_in_progress,"write already in progress"),r.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,r.equal(!1,void 0===o,"must provide flush value"),this.write_in_progress=!0,o!==t.Z_NO_FLUSH&&o!==t.Z_PARTIAL_FLUSH&&o!==t.Z_SYNC_FLUSH&&o!==t.Z_FULL_FLUSH&&o!==t.Z_FINISH&&o!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==a&&(a=e.alloc(0),d=0,s=0),this.strm.avail_in=d,this.strm.input=a,this.strm.next_in=s,this.strm.avail_out=l,this.strm.output=u,this.strm.next_out=c,this.flush=o,!n)return this._process(),this._checkError()?this._afterSync():void 0;var f=this;return i.nextTick(function(){f._process(),f._after()}),this},c.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},c.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=a.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return this._error(null==this.dictionary?"Missing dictionary":"Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},c.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(e,n,i,o,a){r(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),r(e>=8&&e<=15,"invalid windowBits"),r(n>=-1&&n<=9,"invalid compression level"),r(i>=1&&i<=9,"invalid memlevel"),r(o===t.Z_FILTERED||o===t.Z_HUFFMAN_ONLY||o===t.Z_RLE||o===t.Z_FIXED||o===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(n,e,i,o,a),this._setDictionary()},c.prototype.params=function(){throw new Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(e,n,i,r,d){switch(this.level=e,this.windowBits=n,this.memLevel=i,this.strategy=r,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new o,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=a.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=d,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=a.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=a.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=c}).call(this,n(4).Buffer,n(1))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";var i,r=n(8),o=n(41),a=n(20),s=n(21),d=n(42),u=0,c=4,l=0,f=-2,p=-1,h=1,g=4,m=2,_=8,v=9,y=286,S=30,b=19,E=2*y+1,w=15,I=3,R=258,T=R+I+1,A=42,C=103,O=113,N=666,k=1,M=2,D=3,L=4;function x(e,t){return e.msg=d[t],t}function P(e){return(e<<1)-(e>4?9:0)}function U(e){for(var t=e.length;--t>=0;)e[t]=0}function V(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function B(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,V(e.strm)}function F(e,t){e.pending_buf[e.pending++]=t}function j(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function W(e,t,n,i){var o=e.avail_in;return o>i&&(o=i),0===o?0:(e.avail_in-=o,r.arraySet(t,e.input,e.next_in,o,n),1===e.state.wrap?e.adler=a(e.adler,t,o,n):2===e.state.wrap&&(e.adler=s(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)}function H(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,d=e.strstart>e.w_size-T?e.strstart-(e.w_size-T):0,u=e.window,c=e.w_mask,l=e.prev,f=e.strstart+R,p=u[o+a-1],h=u[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+a]===h&&u[n+a-1]===p&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<f);if(i=R-(f-o),o=f-R,i>a){if(e.match_start=t,a=i,i>=s)break;p=u[o+a-1],h=u[o+a]}}}while((t=l[t&c])>d&&0!=--r);return a<=e.lookahead?a:e.lookahead}function z(e){var t,n,i,o,a,s=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-T)){r.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=n=e.hash_size;do{i=e.head[--t],e.head[t]=i>=s?i-s:0}while(--n);t=n=s;do{i=e.prev[--t],e.prev[t]=i>=s?i-s:0}while(--n);o+=s}if(0===e.strm.avail_in)break;if(n=W(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=n,e.lookahead+e.insert>=I)for(e.ins_h=e.window[a=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+I-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<I)););}while(e.lookahead<T&&0!==e.strm.avail_in)}function G(e,t){for(var n,i;;){if(e.lookahead<T){if(z(e),e.lookahead<T&&t===u)return k;if(0===e.lookahead)break}if(n=0,e.lookahead>=I&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-T&&(e.match_length=H(e,n)),e.match_length>=I)if(i=o._tr_tally(e,e.strstart-e.match_start,e.match_length-I),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=I){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(B(e,!1),0===e.strm.avail_out))return k}return e.insert=e.strstart<I-1?e.strstart:I-1,t===c?(B(e,!0),0===e.strm.avail_out?D:L):e.last_lit&&(B(e,!1),0===e.strm.avail_out)?k:M}function Y(e,t){for(var n,i,r;;){if(e.lookahead<T){if(z(e),e.lookahead<T&&t===u)return k;if(0===e.lookahead)break}if(n=0,e.lookahead>=I&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=I-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-T&&(e.match_length=H(e,n),e.match_length<=5&&(e.strategy===h||e.match_length===I&&e.strstart-e.match_start>4096)&&(e.match_length=I-1)),e.prev_length>=I&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-I,i=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-I),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=I-1,e.strstart++,i&&(B(e,!1),0===e.strm.avail_out))return k}else if(e.match_available){if((i=o._tr_tally(e,0,e.window[e.strstart-1]))&&B(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return k}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<I-1?e.strstart:I-1,t===c?(B(e,!0),0===e.strm.avail_out?D:L):e.last_lit&&(B(e,!1),0===e.strm.avail_out)?k:M}function Z(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function K(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=m,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?A:O,e.adler=2===t.wrap?0:1,t.last_flush=u,o._tr_init(t),l):x(e,f)}function q(e){var t=K(e);return t===l&&function(e){e.window_size=2*e.w_size,U(e.head),e.max_lazy_match=i[e.level].max_lazy,e.good_match=i[e.level].good_length,e.nice_match=i[e.level].nice_length,e.max_chain_length=i[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=I-1,e.match_available=0,e.ins_h=0}(e.state),t}function J(e,t,n,i,o,a){if(!e)return f;var s=1;if(t===p&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),o<1||o>v||n!==_||i<8||i>15||t<0||t>9||a<0||a>g)return x(e,f);8===i&&(i=9);var d=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*E),this.dyn_dtree=new r.Buf16(2*(2*S+1)),this.bl_tree=new r.Buf16(2*(2*b+1)),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(w+1),this.heap=new r.Buf16(2*y+1),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*y+1),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=d,d.strm=e,d.wrap=s,d.gzhead=null,d.w_bits=i,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=o+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+I-1)/I),d.window=new r.Buf8(2*d.w_size),d.head=new r.Buf16(d.hash_size),d.prev=new r.Buf16(d.w_size),d.lit_bufsize=1<<o+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new r.Buf8(d.pending_buf_size),d.d_buf=1*d.lit_bufsize,d.l_buf=3*d.lit_bufsize,d.level=t,d.strategy=a,d.method=n,q(e)}i=[new Z(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(z(e),0===e.lookahead&&t===u)return k;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,B(e,!1),0===e.strm.avail_out))return k;if(e.strstart-e.block_start>=e.w_size-T&&(B(e,!1),0===e.strm.avail_out))return k}return e.insert=0,t===c?(B(e,!0),0===e.strm.avail_out?D:L):(e.strstart>e.block_start&&B(e,!1),k)}),new Z(4,4,8,4,G),new Z(4,5,16,8,G),new Z(4,6,32,32,G),new Z(4,4,16,16,Y),new Z(8,16,32,32,Y),new Z(8,16,128,128,Y),new Z(8,32,128,256,Y),new Z(32,128,258,1024,Y),new Z(32,258,258,4096,Y)],t.deflateInit=function(e,t){return J(e,t,_,15,8,0)},t.deflateInit2=J,t.deflateReset=q,t.deflateResetKeep=K,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?f:(e.state.gzhead=t,l):f},t.deflate=function(e,t){var n,r,a,d;if(!e||!e.state||t>5||t<0)return e?x(e,f):f;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===N&&t!==c)return x(e,0===e.avail_out?-5:f);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===A)if(2===r.wrap)e.adler=0,F(r,31),F(r,139),F(r,8),r.gzhead?(F(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),F(r,255&r.gzhead.time),F(r,r.gzhead.time>>8&255),F(r,r.gzhead.time>>16&255),F(r,r.gzhead.time>>24&255),F(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),F(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(F(r,255&r.gzhead.extra.length),F(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=s(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(F(r,0),F(r,0),F(r,0),F(r,0),F(r,0),F(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),F(r,3),r.status=O);else{var p=_+(r.w_bits-8<<4)<<8;p|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(p|=32),p+=31-p%31,r.status=O,j(r,p),0!==r.strstart&&(j(r,e.adler>>>16),j(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),V(e),a=r.pending,r.pending!==r.pending_buf_size));)F(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),V(e),a=r.pending,r.pending===r.pending_buf_size)){d=1;break}d=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,F(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===d&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),V(e),a=r.pending,r.pending===r.pending_buf_size)){d=1;break}d=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,F(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>a&&(e.adler=s(e.adler,r.pending_buf,r.pending-a,a)),0===d&&(r.status=C)}else r.status=C;if(r.status===C&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&V(e),r.pending+2<=r.pending_buf_size&&(F(r,255&e.adler),F(r,e.adler>>8&255),e.adler=0,r.status=O)):r.status=O),0!==r.pending){if(V(e),0===e.avail_out)return r.last_flush=-1,l}else if(0===e.avail_in&&P(t)<=P(n)&&t!==c)return x(e,-5);if(r.status===N&&0!==e.avail_in)return x(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==u&&r.status!==N){var h=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(z(e),0===e.lookahead)){if(t===u)return k;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(B(e,!1),0===e.strm.avail_out))return k}return e.insert=0,t===c?(B(e,!0),0===e.strm.avail_out?D:L):e.last_lit&&(B(e,!1),0===e.strm.avail_out)?k:M}(r,t):3===r.strategy?function(e,t){for(var n,i,r,a,s=e.window;;){if(e.lookahead<=R){if(z(e),e.lookahead<=R&&t===u)return k;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=I&&e.strstart>0&&(i=s[r=e.strstart-1])===s[++r]&&i===s[++r]&&i===s[++r]){a=e.strstart+R;do{}while(i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&r<a);e.match_length=R-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=I?(n=o._tr_tally(e,1,e.match_length-I),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(B(e,!1),0===e.strm.avail_out))return k}return e.insert=0,t===c?(B(e,!0),0===e.strm.avail_out?D:L):e.last_lit&&(B(e,!1),0===e.strm.avail_out)?k:M}(r,t):i[r.level].func(r,t);if(h!==D&&h!==L||(r.status=N),h===k||h===D)return 0===e.avail_out&&(r.last_flush=-1),l;if(h===M&&(1===t?o._tr_align(r):5!==t&&(o._tr_stored_block(r,0,0,!1),3===t&&(U(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),V(e),0===e.avail_out))return r.last_flush=-1,l}return t!==c?l:r.wrap<=0?1:(2===r.wrap?(F(r,255&e.adler),F(r,e.adler>>8&255),F(r,e.adler>>16&255),F(r,e.adler>>24&255),F(r,255&e.total_in),F(r,e.total_in>>8&255),F(r,e.total_in>>16&255),F(r,e.total_in>>24&255)):(j(r,e.adler>>>16),j(r,65535&e.adler)),V(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?l:1)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==A&&69!==t&&73!==t&&91!==t&&t!==C&&t!==O&&t!==N?x(e,f):(e.state=null,t===O?x(e,-3):l):f},t.deflateSetDictionary=function(e,t){var n,i,o,s,d,u,c,p,h=t.length;if(!e||!e.state)return f;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==A||n.lookahead)return f;for(1===s&&(e.adler=a(e.adler,t,h,0)),n.wrap=0,h>=n.w_size&&(0===s&&(U(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new r.Buf8(n.w_size),r.arraySet(p,t,h-n.w_size,n.w_size,0),t=p,h=n.w_size),d=e.avail_in,u=e.next_in,c=e.input,e.avail_in=h,e.next_in=0,e.input=t,z(n);n.lookahead>=I;){i=n.strstart,o=n.lookahead-(I-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+I-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++}while(--o);n.strstart=i,n.lookahead=I-1,z(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=I-1,n.match_available=0,e.next_in=u,e.input=c,e.avail_in=d,n.wrap=s,l},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var i=n(8);function r(e){for(var t=e.length;--t>=0;)e[t]=0}var o=0,a=256,s=a+1+29,d=30,u=19,c=2*s+1,l=15,f=16,p=256,h=16,g=17,m=18,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],b=new Array(2*(s+2));r(b);var E=new Array(2*d);r(E);var w=new Array(512);r(w);var I=new Array(256);r(I);var R=new Array(29);r(R);var T,A,C,O=new Array(d);function N(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function k(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function M(e){return e<256?w[e]:w[256+(e>>>7)]}function D(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function L(e,t,n){e.bi_valid>f-n?(e.bi_buf|=t<<e.bi_valid&65535,D(e,e.bi_buf),e.bi_buf=t>>f-e.bi_valid,e.bi_valid+=n-f):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function x(e,t,n){L(e,n[2*t],n[2*t+1])}function P(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function U(e,t,n){var i,r,o=new Array(l+1),a=0;for(i=1;i<=l;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=P(o[s]++,s))}}function V(e){var t;for(t=0;t<s;t++)e.dyn_ltree[2*t]=0;for(t=0;t<d;t++)e.dyn_dtree[2*t]=0;for(t=0;t<u;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*p]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function B(e){e.bi_valid>8?D(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function F(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function j(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&F(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!F(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function W(e,t,n){var i,r,o,s,d=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*d]<<8|e.pending_buf[e.d_buf+2*d+1],r=e.pending_buf[e.l_buf+d],d++,0===i?x(e,r,t):(x(e,(o=I[r])+a+1,t),0!==(s=_[o])&&L(e,r-=R[o],s),x(e,o=M(--i),n),0!==(s=v[o])&&L(e,i-=O[o],s))}while(d<e.last_lit);x(e,p,t)}function H(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,d=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=c,n=0;n<d;n++)0!==o[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)j(e,o,n);r=d;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],j(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,j(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,o,a,s,d=t.dyn_tree,u=t.max_code,f=t.stat_desc.static_tree,p=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,g=t.stat_desc.extra_base,m=t.stat_desc.max_length,_=0;for(o=0;o<=l;o++)e.bl_count[o]=0;for(d[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<c;n++)(o=d[2*d[2*(i=e.heap[n])+1]+1]+1)>m&&(o=m,_++),d[2*i+1]=o,i>u||(e.bl_count[o]++,a=0,i>=g&&(a=h[i-g]),e.opt_len+=(s=d[2*i])*(o+a),p&&(e.static_len+=s*(f[2*i+1]+a)));if(0!==_){do{for(o=m-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[m]--,_-=2}while(_>0);for(o=m;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>u||(d[2*r+1]!==o&&(e.opt_len+=(o-d[2*r+1])*d[2*r],d[2*r+1]=o),i--)}}(e,t),U(o,u,e.bl_count)}function z(e,t,n){var i,r,o=-1,a=t[1],s=0,d=7,u=4;for(0===a&&(d=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<d&&r===a||(s<u?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*h]++):s<=10?e.bl_tree[2*g]++:e.bl_tree[2*m]++,s=0,o=r,0===a?(d=138,u=3):r===a?(d=6,u=3):(d=7,u=4))}function G(e,t,n){var i,r,o=-1,a=t[1],s=0,d=7,u=4;for(0===a&&(d=138,u=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<d&&r===a)){if(s<u)do{x(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(x(e,r,e.bl_tree),s--),x(e,h,e.bl_tree),L(e,s-3,2)):s<=10?(x(e,g,e.bl_tree),L(e,s-3,3)):(x(e,m,e.bl_tree),L(e,s-11,7));s=0,o=r,0===a?(d=138,u=3):r===a?(d=6,u=3):(d=7,u=4)}}r(O);var Y=!1;function Z(e,t,n,r){L(e,(o<<1)+(r?1:0),3),function(e,t,n,r){B(e),D(e,n),D(e,~n),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){Y||(function(){var e,t,n,i,r,o=new Array(l+1);for(n=0,i=0;i<28;i++)for(R[i]=n,e=0;e<1<<_[i];e++)I[n++]=i;for(I[n-1]=i,r=0,i=0;i<16;i++)for(O[i]=r,e=0;e<1<<v[i];e++)w[r++]=i;for(r>>=7;i<d;i++)for(O[i]=r<<7,e=0;e<1<<v[i]-7;e++)w[256+r++]=i;for(t=0;t<=l;t++)o[t]=0;for(e=0;e<=143;)b[2*e+1]=8,e++,o[8]++;for(;e<=255;)b[2*e+1]=9,e++,o[9]++;for(;e<=279;)b[2*e+1]=7,e++,o[7]++;for(;e<=287;)b[2*e+1]=8,e++,o[8]++;for(U(b,s+1,o),e=0;e<d;e++)E[2*e+1]=5,E[2*e]=P(e,5);T=new N(b,_,a+1,s,l),A=new N(E,v,0,d,l),C=new N(new Array(0),y,0,u,7)}(),Y=!0),e.l_desc=new k(e.dyn_ltree,T),e.d_desc=new k(e.dyn_dtree,A),e.bl_desc=new k(e.bl_tree,C),e.bi_buf=0,e.bi_valid=0,V(e)},t._tr_stored_block=Z,t._tr_flush_block=function(e,t,n,i){var r,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<a;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),H(e,e.l_desc),H(e,e.d_desc),s=function(e){var t;for(z(e,e.dyn_ltree,e.l_desc.max_code),z(e,e.dyn_dtree,e.d_desc.max_code),H(e,e.bl_desc),t=u-1;t>=3&&0===e.bl_tree[2*S[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(o=e.static_len+3+7>>>3)<=(r=e.opt_len+3+7>>>3)&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?Z(e,t,n,i):4===e.strategy||o===r?(L(e,2+(i?1:0),3),W(e,b,E)):(L(e,4+(i?1:0),3),function(e,t,n,i){var r;for(L(e,t-257,5),L(e,n-1,5),L(e,i-4,4),r=0;r<i;r++)L(e,e.bl_tree[2*S[r]+1],3);G(e,e.dyn_ltree,t-1),G(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),W(e,e.dyn_ltree,e.dyn_dtree)),V(e),i&&B(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(I[n]+a+1)]++,e.dyn_dtree[2*M(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){L(e,2,3),x(e,p,b),function(e){16===e.bi_valid?(D(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var i=n(8),r=n(20),o=n(21),a=n(44),s=n(45),d=1,u=2,c=0,l=-2,f=1,p=12,h=30,g=852,m=592;function _(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function v(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=f,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(g),t.distcode=t.distdyn=new i.Buf32(m),t.sane=1,t.back=-1,c):l}function y(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,v(e)):l}function S(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?l:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,y(e))):l}function b(e,t){var n,r;return e?(r=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=r,r.window=null,(n=S(e,t))!==c&&(e.state=null),n):l}var E,w,I=!0;function R(e){if(I){var t;for(E=new i.Buf32(512),w=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(d,e.lens,0,288,E,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,w,0,e.work,{bits:5}),I=!1}e.lencode=E,e.lenbits=9,e.distcode=w,e.distbits=5}function T(e,t,n,r){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),r>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>r&&(o=r),i.arraySet(a.window,t,n-r,o,a.wnext),(r-=o)?(i.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=y,t.inflateReset2=S,t.inflateResetKeep=v,t.inflateInit=function(e){return b(e,15)},t.inflateInit2=b,t.inflate=function(e,t){var n,g,m,v,y,S,b,E,w,I,A,C,O,N,k,M,D,L,x,P,U,V,B,F,j=0,W=new i.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;(n=e.state).mode===p&&(n.mode=13),y=e.next_out,m=e.output,v=e.next_in,g=e.input,E=n.hold,w=n.bits,I=S=e.avail_in,A=b=e.avail_out,V=c;e:for(;;)switch(n.mode){case f:if(0===n.wrap){n.mode=13;break}for(;w<16;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(2&n.wrap&&35615===E){n.check=0,W[0]=255&E,W[1]=E>>>8&255,n.check=o(n.check,W,2,0),E=0,w=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",n.mode=h;break}if(8!=(15&E)){e.msg="unknown compression method",n.mode=h;break}if(w-=4,U=8+(15&(E>>>=4)),0===n.wbits)n.wbits=U;else if(U>n.wbits){e.msg="invalid window size",n.mode=h;break}n.dmax=1<<U,e.adler=n.check=1,n.mode=512&E?10:p,E=0,w=0;break;case 2:for(;w<16;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(n.flags=E,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=h;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=h;break}n.head&&(n.head.text=E>>8&1),512&n.flags&&(W[0]=255&E,W[1]=E>>>8&255,n.check=o(n.check,W,2,0)),E=0,w=0,n.mode=3;case 3:for(;w<32;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}n.head&&(n.head.time=E),512&n.flags&&(W[0]=255&E,W[1]=E>>>8&255,W[2]=E>>>16&255,W[3]=E>>>24&255,n.check=o(n.check,W,4,0)),E=0,w=0,n.mode=4;case 4:for(;w<16;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}n.head&&(n.head.xflags=255&E,n.head.os=E>>8),512&n.flags&&(W[0]=255&E,W[1]=E>>>8&255,n.check=o(n.check,W,2,0)),E=0,w=0,n.mode=5;case 5:if(1024&n.flags){for(;w<16;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}n.length=E,n.head&&(n.head.extra_len=E),512&n.flags&&(W[0]=255&E,W[1]=E>>>8&255,n.check=o(n.check,W,2,0)),E=0,w=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((C=n.length)>S&&(C=S),C&&(n.head&&(U=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,g,v,C,U)),512&n.flags&&(n.check=o(n.check,g,C,v)),S-=C,v+=C,n.length-=C),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===S)break e;C=0;do{U=g[v+C++],n.head&&U&&n.length<65536&&(n.head.name+=String.fromCharCode(U))}while(U&&C<S);if(512&n.flags&&(n.check=o(n.check,g,C,v)),S-=C,v+=C,U)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===S)break e;C=0;do{U=g[v+C++],n.head&&U&&n.length<65536&&(n.head.comment+=String.fromCharCode(U))}while(U&&C<S);if(512&n.flags&&(n.check=o(n.check,g,C,v)),S-=C,v+=C,U)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;w<16;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(E!==(65535&n.check)){e.msg="header crc mismatch",n.mode=h;break}E=0,w=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=p;break;case 10:for(;w<32;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}e.adler=n.check=_(E),E=0,w=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=y,e.avail_out=b,e.next_in=v,e.avail_in=S,n.hold=E,n.bits=w,2;e.adler=n.check=1,n.mode=p;case p:if(5===t||6===t)break e;case 13:if(n.last){E>>>=7&w,w-=7&w,n.mode=27;break}for(;w<3;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}switch(n.last=1&E,w-=1,3&(E>>>=1)){case 0:n.mode=14;break;case 1:if(R(n),n.mode=20,6===t){E>>>=2,w-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=h}E>>>=2,w-=2;break;case 14:for(E>>>=7&w,w-=7&w;w<32;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",n.mode=h;break}if(n.length=65535&E,E=0,w=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(C=n.length){if(C>S&&(C=S),C>b&&(C=b),0===C)break e;i.arraySet(m,g,v,C,y),S-=C,v+=C,b-=C,y+=C,n.length-=C;break}n.mode=p;break;case 17:for(;w<14;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(n.nlen=257+(31&E),w-=5,n.ndist=1+(31&(E>>>=5)),w-=5,n.ncode=4+(15&(E>>>=5)),E>>>=4,w-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=h;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;w<3;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}n.lens[H[n.have++]]=7&E,E>>>=3,w-=3}for(;n.have<19;)n.lens[H[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,V=s(0,n.lens,0,19,n.lencode,0,n.work,B={bits:n.lenbits}),n.lenbits=B.bits,V){e.msg="invalid code lengths set",n.mode=h;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=(j=n.lencode[E&(1<<n.lenbits)-1])>>>16&255,D=65535&j,!((k=j>>>24)<=w);){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(D<16)E>>>=k,w-=k,n.lens[n.have++]=D;else{if(16===D){for(F=k+2;w<F;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(E>>>=k,w-=k,0===n.have){e.msg="invalid bit length repeat",n.mode=h;break}U=n.lens[n.have-1],C=3+(3&E),E>>>=2,w-=2}else if(17===D){for(F=k+3;w<F;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}w-=k,U=0,C=3+(7&(E>>>=k)),E>>>=3,w-=3}else{for(F=k+7;w<F;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}w-=k,U=0,C=11+(127&(E>>>=k)),E>>>=7,w-=7}if(n.have+C>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=h;break}for(;C--;)n.lens[n.have++]=U}}if(n.mode===h)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=h;break}if(n.lenbits=9,V=s(d,n.lens,0,n.nlen,n.lencode,0,n.work,B={bits:n.lenbits}),n.lenbits=B.bits,V){e.msg="invalid literal/lengths set",n.mode=h;break}if(n.distbits=6,n.distcode=n.distdyn,V=s(u,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,B={bits:n.distbits}),n.distbits=B.bits,V){e.msg="invalid distances set",n.mode=h;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(S>=6&&b>=258){e.next_out=y,e.avail_out=b,e.next_in=v,e.avail_in=S,n.hold=E,n.bits=w,a(e,A),y=e.next_out,m=e.output,b=e.avail_out,v=e.next_in,g=e.input,S=e.avail_in,E=n.hold,w=n.bits,n.mode===p&&(n.back=-1);break}for(n.back=0;M=(j=n.lencode[E&(1<<n.lenbits)-1])>>>16&255,D=65535&j,!((k=j>>>24)<=w);){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(M&&0==(240&M)){for(L=k,x=M,P=D;M=(j=n.lencode[P+((E&(1<<L+x)-1)>>L)])>>>16&255,D=65535&j,!(L+(k=j>>>24)<=w);){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}E>>>=L,w-=L,n.back+=L}if(E>>>=k,w-=k,n.back+=k,n.length=D,0===M){n.mode=26;break}if(32&M){n.back=-1,n.mode=p;break}if(64&M){e.msg="invalid literal/length code",n.mode=h;break}n.extra=15&M,n.mode=22;case 22:if(n.extra){for(F=n.extra;w<F;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}n.length+=E&(1<<n.extra)-1,E>>>=n.extra,w-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=(j=n.distcode[E&(1<<n.distbits)-1])>>>16&255,D=65535&j,!((k=j>>>24)<=w);){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(0==(240&M)){for(L=k,x=M,P=D;M=(j=n.distcode[P+((E&(1<<L+x)-1)>>L)])>>>16&255,D=65535&j,!(L+(k=j>>>24)<=w);){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}E>>>=L,w-=L,n.back+=L}if(E>>>=k,w-=k,n.back+=k,64&M){e.msg="invalid distance code",n.mode=h;break}n.offset=D,n.extra=15&M,n.mode=24;case 24:if(n.extra){for(F=n.extra;w<F;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}n.offset+=E&(1<<n.extra)-1,E>>>=n.extra,w-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=h;break}n.mode=25;case 25:if(0===b)break e;if(n.offset>(C=A-b)){if((C=n.offset-C)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=h;break}O=C>n.wnext?n.wsize-(C-=n.wnext):n.wnext-C,C>n.length&&(C=n.length),N=n.window}else N=m,O=y-n.offset,C=n.length;C>b&&(C=b),b-=C,n.length-=C;do{m[y++]=N[O++]}while(--C);0===n.length&&(n.mode=21);break;case 26:if(0===b)break e;m[y++]=n.length,b--,n.mode=21;break;case 27:if(n.wrap){for(;w<32;){if(0===S)break e;S--,E|=g[v++]<<w,w+=8}if(e.total_out+=A-=b,n.total+=A,A&&(e.adler=n.check=n.flags?o(n.check,m,A,y-A):r(n.check,m,A,y-A)),A=b,(n.flags?E:_(E))!==n.check){e.msg="incorrect data check",n.mode=h;break}E=0,w=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;w<32;){if(0===S)break e;S--,E+=g[v++]<<w,w+=8}if(E!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=h;break}E=0,w=0}n.mode=29;case 29:V=1;break e;case h:V=-3;break e;case 31:return-4;case 32:default:return l}return e.next_out=y,e.avail_out=b,e.next_in=v,e.avail_in=S,n.hold=E,n.bits=w,(n.wsize||A!==e.avail_out&&n.mode<h&&(n.mode<27||4!==t))&&T(e,e.output,e.next_out,A-e.avail_out)?(n.mode=31,-4):(A-=e.avail_out,e.total_in+=I-=e.avail_in,e.total_out+=A,n.total+=A,n.wrap&&A&&(e.adler=n.check=n.flags?o(n.check,m,A,e.next_out-A):r(n.check,m,A,e.next_out-A)),e.data_type=n.bits+(n.last?64:0)+(n.mode===p?128:0)+(20===n.mode||15===n.mode?256:0),(0===I&&0===A||4===t)&&V===c&&(V=-5),V)},t.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,c},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?l:(n.head=t,t.done=!1,c):l},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?l:11===n.mode&&r(1,t,i,0)!==n.check?-3:T(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,c):l},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,i,r,o,a,s,d,u,c,l,f,p,h,g,m,_,v,y,S,b,E,w,I,R,T;R=e.input,r=(i=e.next_in)+(e.avail_in-5),T=e.output,a=(o=e.next_out)-(t-e.avail_out),s=o+(e.avail_out-257),d=(n=e.state).dmax,u=n.wsize,c=n.whave,l=n.wnext,f=n.window,p=n.hold,h=n.bits,g=n.lencode,m=n.distcode,_=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{h<15&&(p+=R[i++]<<h,p+=R[i++]<<(h+=8),h+=8),y=g[p&_];t:for(;;){if(p>>>=S=y>>>24,h-=S,0==(S=y>>>16&255))T[o++]=65535&y;else{if(!(16&S)){if(0==(64&S)){y=g[(65535&y)+(p&(1<<S)-1)];continue t}if(32&S){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}b=65535&y,(S&=15)&&(h<S&&(p+=R[i++]<<h,h+=8),b+=p&(1<<S)-1,p>>>=S,h-=S),h<15&&(p+=R[i++]<<h,p+=R[i++]<<(h+=8),h+=8),y=m[p&v];n:for(;;){if(p>>>=S=y>>>24,h-=S,!(16&(S=y>>>16&255))){if(0==(64&S)){y=m[(65535&y)+(p&(1<<S)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(E=65535&y,h<(S&=15)&&(p+=R[i++]<<h,(h+=8)<S&&(p+=R[i++]<<h,h+=8)),(E+=p&(1<<S)-1)>d){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=S,h-=S,E>(S=o-a)){if((S=E-S)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(w=0,I=f,0===l){if(w+=u-S,S<b){b-=S;do{T[o++]=f[w++]}while(--S);w=o-E,I=T}}else if(l<S){if(w+=u+l-S,(S-=l)<b){b-=S;do{T[o++]=f[w++]}while(--S);if(w=0,l<b){b-=S=l;do{T[o++]=f[w++]}while(--S);w=o-E,I=T}}}else if(w+=l-S,S<b){b-=S;do{T[o++]=f[w++]}while(--S);w=o-E,I=T}for(;b>2;)T[o++]=I[w++],T[o++]=I[w++],T[o++]=I[w++],b-=3;b&&(T[o++]=I[w++],b>1&&(T[o++]=I[w++]))}else{w=o-E;do{T[o++]=T[w++],T[o++]=T[w++],T[o++]=T[w++],b-=3}while(b>2);b&&(T[o++]=T[w++],b>1&&(T[o++]=T[w++]))}break}}break}}while(i<r&&o<s);i-=b=h>>3,p&=(1<<(h-=b<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=p,n.bits=h}},function(e,t,n){"use strict";var i=n(8),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,d,u,c,l,f){var p,h,g,m,_,v,y,S,b,E=f.bits,w=0,I=0,R=0,T=0,A=0,C=0,O=0,N=0,k=0,M=0,D=null,L=0,x=new i.Buf16(16),P=new i.Buf16(16),U=null,V=0;for(w=0;w<=15;w++)x[w]=0;for(I=0;I<d;I++)x[t[n+I]]++;for(A=E,T=15;T>=1&&0===x[T];T--);if(A>T&&(A=T),0===T)return u[c++]=20971520,u[c++]=20971520,f.bits=1,0;for(R=1;R<T&&0===x[R];R++);for(A<R&&(A=R),N=1,w=1;w<=15;w++)if(N<<=1,(N-=x[w])<0)return-1;if(N>0&&(0===e||1!==T))return-1;for(P[1]=0,w=1;w<15;w++)P[w+1]=P[w]+x[w];for(I=0;I<d;I++)0!==t[n+I]&&(l[P[t[n+I]]++]=I);if(0===e?(D=U=l,v=19):1===e?(D=r,L-=257,U=o,V-=257,v=256):(D=a,U=s,v=-1),M=0,I=0,w=R,_=c,C=A,O=0,g=-1,m=(k=1<<A)-1,1===e&&k>852||2===e&&k>592)return 1;for(;;){y=w-O,l[I]<v?(S=0,b=l[I]):l[I]>v?(S=U[V+l[I]],b=D[L+l[I]]):(S=96,b=0),p=1<<w-O,R=h=1<<C;do{u[_+(M>>O)+(h-=p)]=y<<24|S<<16|b|0}while(0!==h);for(p=1<<w-1;M&p;)p>>=1;if(0!==p?(M&=p-1,M+=p):M=0,I++,0==--x[w]){if(w===T)break;w=t[n+l[I]]}if(w>A&&(M&m)!==g){for(0===O&&(O=A),_+=R,N=1<<(C=w-O);C+O<T&&!((N-=x[C+O])<=0);)C++,N<<=1;if(k+=1<<C,1===e&&k>852||2===e&&k>592)return 1;u[g=M&m]=A<<24|C<<16|_-c|0}}return 0!==M&&(u[_+M]=w-O<<24|64<<16|0),f.bits=A,0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";n.r(t);var i=n(22),r=function(e){var t="browser";function n(e){var t,n,i;for(i=e.length;i;i--)t=Math.floor(Math.random()*i),n=e[i-1],e[i-1]=e[t],e[t]=n}function r(e,n){if("wechat"!==t){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.send(JSON.stringify(n))}}function o(e){return e._isBuffer=!0,function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}(Object(i.inflateSync)(e))}!function(){if("undefined"!=typeof navigator)try{"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)&&(console.log("Current env is wechat."),t="wechat")}catch(e){console.error(e)}else"undefined"!=typeof wx&&void 0!==wx.connectSocket&&(t="wechat")}(),this.getSDKVersion=function(){return"1.4.0"},this.getSDKVersion_int=function(){return 10104e5},this.lbs_url1=["https://lbs-1-sig.agora.io","https://lbs-2-sig.agora.io"],this.lbs_url2=["https://lbs-3-sig.agora.io","https://lbs-4-sig.agora.io"],this.lbs_wx=["https://lbs-wx.agora.io"],this.rp_url="https:///wsrp-sig.agora.io/",this.vid=e,this.appid=e;var a=this;function s(e,t,n){var i=e.split(t,n),r=0;for(var o in i)r+=t.length+i[o].length;return i.push(e.substr(r)),i}a.server_urls=[],a.setup_debugging=function(e,t){if("ap"===e)a.server_urls.push([t,8001]),a.debugging=!0;else if("ap_url"===e)a.server_urls.push(t),a.debugging=!0;else{if("env"!==e)return;"lbs100"===t&&(a.lbs_url1=["https://lbs100-1-sig.agora.io","https://lbs100-2-sig.agora.io"],a.lbs_url2=["https://lbs100-3-sig.agora.io","https://lbs100-4-sig.agora.io"])}},a.setUpDebugging=a.setup_debugging;var d=function(i,d,u,c){this.onLoginSuccess="",this.onLoginFailed="",this.onLogout="",this.onInviteReceived="",this.onMessageInstantReceive="";try{"string"!=typeof i&&(i=JSON.stringify(i))}catch(e){return console.error("Invalid account type, should be a string."),void console.error(e)}this.m_retry_max_time=c||3e5,this.m_retry_max_count=u||10,this.m_retry_count=0,this.m_retry_time_start=Date.now(),this.m_retry_delay=200,this.m_retry_delay_min=200,this.m_retry_delay_max=2e3,this.account=i,this.config_msg_set=0,this.config_inst_msg_with_msgid=0,this.debugging=a.debugging,this.m_msgid=0,this.state=1,this.line="",this.uid=0,this.dbg=!1,this.alive_conn=2;var l=this;l.lbs_state="requesting",l.lbs_state1="requesting",l.lbs_state2="requesting";var f=a.server_urls.slice();n(f),l.idx=0,this.login_start_time=null,this.login_end_time=null,this.lbs_start_time=null,this.lbs_end_time=null,this.ap_start_time=null,this.ap_end_time=null,l.browser="unknown";try{l.browser=navigator.userAgent}catch(e){a.isLogging&&(a.loggingLevel<2&&console.warn(e),console.log("This browser does not support navigator.userAgent"))}l.login_data={event:"login",now:"",time:"",duration:"",key:"",seq:"",result:"",account:"",browser:l.browser,sdk_version:a.getSDKVersion_int(),rmc:"",rmt:"",h1i1:"",h1t1:"",i2:"",i3:"",i3_0:"",i3_0_ip:"",i3_0_port:"",i3_1_ip:"",step:"",t2:"",t4:""},l.v3_msg_set=new Map,setTimeout(function(){var e=Date.now();for(var t of l.v3_msg_set.keys())if(l.v3_msg_set[t]){if(!(e-l.v3_msg_set[t]>3e5))break;l.v3_msg_set.delete(t)}},2e3),l.socket=null;var p=function(){if(a.isLogging&&0===a.loggingLevel){var e=[];for(var t in arguments)e.push(arguments[t]);console.log.apply(null,["Agora sig dbg :"].concat(e))}},h=function(e){p("Updating the session state to "+e),l.state=e},g=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,m=function(e){return g.test(e[0])?"wss://"+e[0].replace(/\./g,"-")+"-sig-web.agora.io:"+(e[1]+1)+"/":e};l.logout=function(){2===l.state&&l.onLogout?l.call2("user_logout",{line:l.line},function(e,t){l.fire_logout(101),l.socket.close()}):1===l.state&&(h(0),l.fire_logout(101))},l.fire_login_failed=function(e){try{1===l.state&&l.onLoginFailed&&l.onLoginFailed(e)}catch(e){console.error(e)}finally{h(0)}},l.fire_logout=function(e){e||(e=0);try{2!==l.state&&3!==l.state||l.onLogout&&l.onLogout(e)}catch(e){console.error(e)}finally{h(0)}},l.getStatus=function(){return l.state};var _=function(n,i,r){if("requesting"==l.lbs_state){var o=i[r];"wechat"===t?function(e,t,n){var i,r=!1;const o=wx.request({url:e,method:"GET",header:{"content-type":"application/json"},success:function(e){r||(clearTimeout(i),n("",e.data))},fail:function(){n("request failure")}});i=setTimeout(function(){r=!0,o.abort(),n("timeout","")},5e3)}(o+"/getaddr?vid="+e,0,function(e,t){if("request failure"!==e)if(!t.wx_web||t.wx_web&&0===t.wx_web.length)l.fire_login_failed(100);else if(e)n-1>0?_(n-1,i,(r+1)%i.length):l.fire_login_failed(201);else{if("requesting"!=l.lbs_state)return;l.lbs_state="completed",f.push("wss://"+t.wx_web[0]),y()}else l.fire_login_failed(201)}):function(e,t,n){var i=new XMLHttpRequest,r=!1,o=setTimeout(function(){r=!0,i.abort(),n("timeout","")},5e3);i.open("GET",e),i.onerror=function(e){n("GET request error",e)},i.onreadystatechange=function(){4===i.readyState&&(r||(clearTimeout(o),200===i.status&&n("",i.responseText)))},i.send(null)}(o+"/getaddr?vid="+e,0,function(e,t){if(e)n-1>0?_(n-1,i,(r+1)%i.length):(a.lbs_url1===i?l.lbs_state1="completed":a.lbs_url2===i&&(l.lbs_state2="completed"),"completed"===l.lbs_state1&&"completed"===l.lbs_state2&&l.fire_login_failed(201));else{if("requesting"!=l.lbs_state)return;l.lbs_state="completed",f=JSON.parse(t).web,y(),y()}})}},v=function(){if(p("reconnecting...."),Date.now()-l.m_retry_time_start<l.m_retry_max_time&&l.m_retry_count<l.m_retry_max_count)l.m_retry_count++,setTimeout(function(){l.m_retry_delay=Math.min(l.m_retry_delay_max,2*l.m_retry_delay),y()},l.m_retry_delay);else if(1===l.state)l.fire_login_failed(201);else{if(3!==l.state)return;l.fire_logout(102)}},y=function(){if("wechat"===t){if(1===l.state||3===l.state)var n=new function(){var e=m(f[l.idx]);l.idx=(l.idx+1)%f.length;var t=new wx.connectSocket({url:e});t.state="CONNECTING",setTimeout(function(){if("CONNECTING"===t.state)try{return void t.close()}catch(e){console.error(e)}finally{l.fire_login_failed(201)}},6e3),t.onOpen(function(e){if(0===l.state)t.close();else if(1===l.state&&null===l.socket||3===l.state)for(var i in l.socket=n,t.state="OPEN",p("on conn open"),l.go_login(),a)t.send({datd:JSON.stringify(a[i])});else t.close()}),t.onClose(function(e){"OPEN"===t.state&&2===l.state?(p("on conn close"),h(3),l.line&&(l.line=""),l.m_retry_count=0,l.m_retry_delay=l.m_retry_delay_min,l.m_retry_time_start=Date.now(),v()):1===l.state?l.fire_login_failed(201):"CONNECTING"===t.state&&y()}),t.onMessage(function(e){var t;if(e.data instanceof ArrayBuffer)try{t=o(new Uint8Array(e.data))}catch(e){console.error(e)}else t=e.data;p("Received message ",t);var n=JSON.parse(t),i=n[0];if("close"===i&&1===l.state)l.fire_login_failed(201);else if("multi"==i)for(var a=0;a<n[1].length;a++){var s=n[1][a];r(s[0],s[1])}else r(n[0],n[1])}),t.onError(function(e){p("on conn error"),t.state="CLOSED",2===l.state&&l.socket===n?l.fire_logout(102):1===l.state?l.fire_login_failed(201):3===l.state&&(l.line&&(l.line=""),console.log("On error, going to reconnect"),0===l.m_retry_count&&(l.m_retry_delay=l.m_retry_delay_min),l.m_retry_time_start=Date.now(),v())});var i={},r=function(e,t){e in i&&i[e](t)},a=[];this.on=function(e,t){i[e]=t},this.emit=function(e,n){"OPEN"===t.state?(p("Sending ",[e,n]),t.send({data:JSON.stringify([e,n])})):a.push([e,n])},this.close=function(){t.close()}}}else 1!==l.state&&3!==l.state||(n=new function(){var e=m(f[l.idx]);console.log(e),l.idx=(l.idx+1)%f.length;try{var t=new WebSocket(e);t.binaryType="arraybuffer",t.state="CONNECTING",setTimeout(function(){t.readyState!==t.CONNECTING||t.close()},6e3),t.onopen=function(e){if(0===l.state)t.close();else if(1===l.state&&null===l.socket||3===l.state)for(var i in l.socket=n,t.state="OPEN",p("on conn open"),l.go_login(),a)t.send(JSON.stringify(a[i]));else t.close()},t.onclose=function(e){"OPEN"===t.state&&2===l.state?(p("on conn close"),h(3),l.line&&(l.line=""),l.m_retry_count=0,l.m_retry_delay=l.m_retry_delay_min,l.m_retry_time_start=Date.now(),v()):1===l.state?2===l.alive_conn?l.alive_conn-=1:1===l.alive_conn&&l.onLoginFailed&&l.fire_login_failed(201):"CONNECTING"===t.state&&y()},t.onmessage=function(e){var t;if(e.data instanceof ArrayBuffer)try{t=o(new Uint8Array(e.data))}catch(e){console.error(e)}else t=e.data;p("Received message ",t);var n=JSON.parse(t),i=n[0];if("close"===i&&1===l.state)l.onLoginFailed&&l.fire_login_failed(201);else if("multi"==i)for(var a=0;a<n[1].length;a++){var s=n[1][a];r(s[0],s[1])}else r(n[0],n[1])},t.onerror=function(e){t.state="CLOSED",p("on conn error"),navigator.userAgent.match(/(iPad|iPhone|iPod|Edge)/g)&&(2===l.state&&h(3),l.line&&(l.line="")),2===l.state&&l.socket===n?l.fire_logout(102):1===l.state?l.fire_login_failed(201):3===l.state&&(console.log("On error, going to reconnect"),0===l.m_retry_count&&(l.m_retry_delay=l.m_retry_delay_min),l.m_retry_time_start=Date.now(),v())};var i={},r=function(e,t){e in i&&i[e](t)},a=[];this.on=function(e,t){i[e]=t},this.emit=function(e,n){0!==t.readyState?(p("Sending ",[e,n]),t.send(JSON.stringify([e,n]))):a.push([e,n])},this.close=function(){t.close()}}catch(e){3===l.state&&(console.log("caught an error"),l.m_retry_count+=1,v())}});var u=0,c=function(){setTimeout(function(){2==l.state&&(p("send ping",++u),l.socket.emit("ping",u),c())},1e4)};l.go_login=function(){""===l.line?(l.socket.emit("login",{vid:e,account:i,uid:0,token:d,device:"websdk",ip:""}),l.login_data.account=i,l.login_data.vid=e,l.login_data.key=d,l.socket.on("login_ret",function(e){var n=e[0],i=JSON.parse(e[1]);if(l.login_data.duration=Date.now()-l.login_data.time,p("login ret",n,i),n||"ok"!==i.result){""===n&&(n=i.reason),l.login_data.now=Date.now(),l.login_data.result="failed";try{if(l.onLoginFailed){var o="kick"===n?207:"TokenErrorExpired"===n?204:n.startsWith("TokenError")?206:n.startsWith("wrong account")?209:201;l.fire_login_failed(o)}}catch(e){console.error(e)}finally{r(a.rp_url,l.login_data)}}else{l.config_msg_set=i.config_msg_set||0,l.config_inst_msg_with_msgid=i.config_inst_msg_with_msgid||0,l.uid=i.uid,l.line=i.line,h(2),"wechat"!==t&&l.socket.emit("set_flag",{binary:1}),p("send ping",++u),l.socket.emit("ping",u),c(),O();try{l.login_data.now=Date.now(),l.login_data.result="success",l.onLoginSuccess&&l.onLoginSuccess(l.uid)}catch(o){console.error(o)}finally{r(a.rp_url,l.login_data),A()}}})):l.socket.emit("line_login",{line:l.line});var n=0,o={},f={};l.call2=function(e,t,i){o[++n]=[e,t,i],p("call ",[e,n,t]),l.socket.emit("call2",[e,n,t])},l.socket.on("call2-ret",function(e){var t=e[0],n=e[1],i=e[2];if(t in o){var r=o[t][2];if(""===n)try{"ok"!=(i=JSON.parse(i)).result&&(n=i.data.result)}catch(e){n="wrong resp:"+i}r&&r(n,i)}});var g,m=function(e,t){return""===e},_=function(e){if(e.startsWith("msg-v2 ")){if(7===(t=s(e," ",6)).length)return[t[1],t[4],t[6]]}else if(e.startsWith("msg-v3 ")){var t;if(8===(t=s(e," ",7)).length)return l.v3_msg_set.get(t[1])?null:(l.v3_msg_set.set(t[1],Date.now()),[t[2],t[5],t[7]])}return null};l.socket.on("pong",function(e){p("recv pong")}),l.socket.on("close",function(e){l.fire_logout(102),l.socket.close()}),l.socket.on("_close",function(e){l.fire_logout(102)}),l.socket.on("kick",function(e){l.fire_logout(103)});var v=function(e){if(e){var t=e[0],n=e[1],i=e[2];if("instant"===n)try{l.onMessageInstantReceive&&l.onMessageInstantReceive(t,0,i)}catch(e){console.error(e)}if(n.startsWith("voip_")){var r,o=JSON.parse(i),a=o.channel,s=o.peer,d=o.extra;if("voip_invite"===n)r=new N(a,s,d),l.call2("voip_invite_ack",{line:l.line,channelName:a,peer:s,extra:""});else if(!(r=f[a+s]))return;if("voip_invite"===n)try{l.onInviteReceived&&l.onInviteReceived(r)}catch(e){console.error(e)}if("voip_invite_ack"===n)try{r.onInviteReceivedByPeer&&r.onInviteReceivedByPeer(d)}catch(e){console.error(e)}if("voip_invite_accept"===n)try{r.onInviteAcceptedByPeer&&r.onInviteAcceptedByPeer(d)}catch(e){console.error(e)}if("voip_invite_refuse"===n)try{r.onInviteRefusedByPeer&&r.onInviteRefusedByPeer(d)}catch(e){console.error(e)}if("voip_invite_failed"===n)try{r.onInviteFailed&&r.onInviteFailed(d)}catch(e){console.error(e)}if("voip_invite_bye"===n)try{r.onInviteEndByPeer&&r.onInviteEndByPeer(d)}catch(e){console.error(e)}if("voip_invite_msg"===n)try{r.onInviteMsg&&r.onInviteMsg(d)}catch(e){console.error(e)}}}},y=function(){return Date.now()},S=0,b=0,E=0,w=0,I=!1,R=[],T=0,A=function(){I||(I=!0,T=0,0===l.config_msg_set?l.call2("user_getmsg",{line:l.line,ver_clear:S,max:30},function(e,t){if(""===e){var n=t,i=S;for(var r in E=parseInt(n.ver_clear),S=Math.max(E,i),n.msgs){var o=n.msgs[r][0];o>=S+1&&(v(_(n.msgs[r][1])),S=o)}(30===n.msgs.length||S<b)&&A(),y()}I=!1,w=y()}):1===l.config_msg_set&&l.call2("user_getmsg2",{line:l.line,clear_msgs:R,max:30},function(e,t){if(""===e){for(var n in R=[],t.msgs)v(_(t.msgs[n][1]));t.msgs.length>=30&&A(),y()}I=!1,w=y()}))},C=function(){0===l.config_msg_set?w=y():1===l.config_msg_set&&0===T&&(T=y()+500)},O=function(){setTimeout(function(){if(0!==l.state){if(2===l.state){var e=y();0===l.config_msg_set?E<S&&e-w>1e3?A():e-w>=6e4&&A():1===l.config_msg_set&&R.length>0&&e>T&&T>0&&A()}O()}},100)};l.socket.on("notify",function(e){p("recv notify ",e),"string"==typeof e&&(e=(e=s(e," ",2)).slice(1));var t=e[0];if("channel2"===t){var n=e[2];if(0===l.config_msg_set&&0!==g.m_channel_msgid&&g.m_channel_msgid+1>n)return void p("ignore channel msg",e[1],n,g.m_channel_msgid);g.m_channel_msgid=n;var i=_(e[3]);if(i){var r=i[1],o=JSON.parse(i[2]);if("channel_msg"===r)try{g.onMessageChannelReceive&&g.onMessageChannelReceive(o.account,o.uid,o.msg)}catch(e){console.error(e)}if("channel_user_join"===r)try{g.onChannelUserJoined&&g.onChannelUserJoined(o.account,o.uid)}catch(e){console.error(e)}if("channel_user_leave"===r)try{g.onChannelUserLeaved&&g.onChannelUserLeaved(o.account,o.uid)}catch(e){console.error(e)}if("channel_attr_update"===r)try{g.onChannelAttrUpdated&&g.onChannelAttrUpdated(o.name,o.value,o.type)}catch(e){console.error(e)}}}if("msg"===t&&(b=e[1],A()),"recvmsg"===t){var a=JSON.parse(e[1]),d=a[0];d===S+1?(v(_(a[1])),S=d,C()):(b=d,A())}"recvmsg_by_msgid"===t&&(n=s(e[1]," ",7)[1],R.push(n),v(_(e[1])),C())}),l.messageInstantSend=function(e,t,n){var i={line:l.line,peer:e,flag:"v1:E:3600",t:"instant",content:t};if(1===l.config_inst_msg_with_msgid){var r=null;"string"==typeof t&&(r=JSON.parse(t).msgid),i.messageID=r||y()%1e6+l.m_msgid++%1e6}l.call2("user_sendmsg",i,function(e,t){n&&n(!m(e))})},l.invoke=function(e,t,n){if(e.startsWith("io.agora.signal.")){var i=e.split(".")[3];t.line=l.line,l.call2(i,t,function(e,t){n&&n(e,t)})}};var N=function(e,t,n){this.onInviteReceivedByPeer="",this.onInviteAcceptedByPeer="",this.onInviteRefusedByPeer="",this.onInviteFailed="",this.onInviteEndByPeer="",this.onInviteEndByMyself="",this.onInviteMsg="";var i=this;this.channelName=e,this.peer=t,this.extra=n,f[e+t]=i,this.channelInviteUser2=function(){l.call2("voip_invite",{line:l.line,channelName:e,peer:t,extra:n=n||""},function(e,t){if(m(e));else try{i.onInviteFailed(e)}catch(e){console.error(e)}})},this.channelInviteAccept=function(n){l.call2("voip_invite_accept",{line:l.line,channelName:e,peer:t,extra:n=n||""})},this.channelInviteRefuse=function(n){l.call2("voip_invite_refuse",{line:l.line,channelName:e,peer:t,extra:n=n||""})},this.channelInviteDTMF=function(n){l.call2("voip_invite_msg",{line:l.line,channelName:e,peer:t,extra:JSON.stringify({msgtype:"dtmf",msgdata:n})})},this.channelInviteEnd=function(n){l.call2("voip_invite_bye",{line:l.line,channelName:e,peer:t,extra:n=n||""});try{i.onInviteEndByMyself&&i.onInviteEndByMyself("")}catch(e){console.error(e)}}};l.channelInviteUser2=function(e,t,n){var i=new N(e,t,n);return i.channelInviteUser2(),i},l.channelJoin=function(e){try{"string"!=typeof e&&(e=JSON.stringify(e))}catch(e){return console.error("Invalid channel name type, should be a string."),void console.error(e)}if(2==l.state)return g=new function(){this.onChannelJoined="",this.onChannelJoinFailed="",this.onChannelLeaved="",this.onChannelUserList="",this.onChannelUserJoined="",this.onChannelUserLeaved="",this.onChannelUserList="",this.onChannelAttrUpdated="",this.onMessageChannelReceive="",this.name=e,this.state="joining",this.m_channel_msgid=0,this.messageChannelSend=function(t,n){var i={line:l.line,name:e,msg:t};if(1===l.config_inst_msg_with_msgid){var r=null;"string"==typeof t&&(r=JSON.parse(t).msgid),i.msgID=r||y()%1e6+l.m_msgid++%1e6}l.call2("channel_sendmsg",i,function(e,t){n&&n()})},this.channelLeave=function(t){l.call2("channel_leave",{line:l.line,name:e},function(e,n){if(g.state="leaved",t)t();else try{g.onChannelLeaved&&g.onChannelLeaved(0)}catch(e){console.error(e)}})},this.channelSetAttr=function(t,n,i){l.call2("channel_set_attr",{line:l.line,channel:e,name:t,value:n},function(e,t){i&&i()})},this.channelDelAttr=function(t,n){l.call2("channel_del_attr",{line:l.line,channel:e,name:t},function(e,t){n&&n()})},this.channelClearAttr=function(t){l.call2("channel_clear_attr",{line:l.line,channel:e},function(e,n){t&&t()})}},l.call2("channel_join",{line:l.line,name:e},function(e,t){if(""===e){g.state="joined";try{g.onChannelJoined&&g.onChannelJoined()}catch(e){console.error(e)}var n=t;try{g.onChannelUserList&&g.onChannelUserList(n.list)}catch(e){console.error(e)}try{if(g.onChannelAttrUpdated)for(var i in n.attrs)g.onChannelAttrUpdated(i,n.attrs[i],"update")}catch(e){console.error(e)}}else try{g.onChannelJoinFailed&&g.onChannelJoinFailed(e)}catch(e){console.error(e)}}),g;p("You should log in first.")}}};l.socket=null,l.debugging?(l.lbs_state="completed",l.login_data.time=Date.now(),y()):"wechat"===t?_(2,a.lbs_wx,0):(n(a.lbs_url1),n(a.lbs_url2),_(2,a.lbs_url1,0),_(2,a.lbs_url2,0))};this.login=function(e,t,n,i){return new d(e,t,n,i)};var u={DEBUG:0,WARNING:1,INFO:2};this.setDoLog=function(e=!1,t="DEBUG"){t&&"DEBUG"!==t&&"WARNING"!==t&&"INFO"!==t?console.log("Only accept DEBUG / WARNING / INFO as logging level values. The default level is INFO"):(a.isLogging=e,a.loggingLevel=u[t])}};function o(e){return new r(e)}n.d(t,"default",function(){return o})}]).default});